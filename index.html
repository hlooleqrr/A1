<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù…Ù†ØµØ© FINO - ØªØ±Ø´ÙŠØ­ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Tajawal', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f3f4f6;
      margin: 0;
      text-align: center;
      font-size: 18px; /* ØªØµØºÙŠØ± Ø·ÙÙŠÙ Ù„ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
      direction: rtl;
      color: #111827;
    }
    header {
      background: linear-gradient(135deg, #0f172a, #1e3a8a);
      color: #fff;
      padding: 14px 10px;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    header h1 { margin: 0; font-size: 22px; font-weight: 700; }
    header p { margin: 4px 0 0; font-size: 14px; opacity: 0.95; }
    
    .container { max-width: 600px; margin: 20px auto; padding: 0 15px; }
    
    /* Card Styles */
    .card {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
      padding: 20px;
      margin-bottom: 20px;
      transition: transform 0.2s;
    }
    
    .btn {
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      color: #fff;
      border: none;
      padding: 12px 24px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
      margin-top: 10px;
      font-weight: 600;
      transition: opacity 0.2s;
    }
    .btn:active { opacity: 0.8; }
    .btn-secondary { background: #e5e7eb; color: #1f2937; }
    .btn-success { background: linear-gradient(135deg, #10b981, #059669); }
    .btn-danger { background: #ef4444; }
    .btn-whatsapp { background: #25D366; color: white; margin-bottom: 5px; } /* ÙˆØ§ØªØ³Ø§Ø¨ */

    .form-group { margin-bottom: 15px; text-align: right; }
    .form-group label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 14px; color: #374151; }
    .form-group input, .form-group select {
      width: 100%; padding: 12px;
      border: 1px solid #d1d5db; border-radius: 10px;
      font-size: 16px; background: #f9fafb;
    }
    
    /* Result Cards */
    .result-card {
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      background: #fff;
      position: relative;
    }
    .bank-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 10px; border-bottom: 1px solid #f3f4f6; padding-bottom: 8px;
    }
    .bank-name { font-weight: 800; color: #1e3a8a; font-size: 18px; }
    .bank-rate { background: #dbeafe; color: #1e40af; padding: 4px 10px; border-radius: 20px; font-size: 14px; font-weight: 700; }
    .rate-note { font-size: 12px; color: #d97706; margin-right: 5px; display: block; margin-top: 2px;} /* Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ø¹Ø±Ø¶ */
    
    .result-row { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 15px; }
    .val { font-weight: 700; }
    
    /* Admin Styles */
    .admin-login { max-width: 400px; margin: 40px auto; }
    .admin-panel table { width: 100%; border-collapse: collapse; font-size: 14px; margin-top: 10px; }
    .admin-panel th, .admin-panel td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    .admin-panel th { background: #f3f4f6; }
    .admin-panel input { width: 100%; padding: 4px; box-sizing: border-box; text-align: center;}
    .rate-note-input { font-size: 11px; margin-top: 2px; border: 1px dashed #ccc; } /* Ù…Ø¯Ø®Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ */

    .hidden { display: none; }
    .retirement-info {
        background-color: #f0fdf4;
        border: 1px solid #bbf7d0;
        padding: 10px;
        border-radius: 8px;
        margin-top: 10px;
        font-size: 14px;
        color: #166534;
        text-align: right;
    }
    .admin-badge {
        background: #ef4444; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; vertical-align: middle; margin-right: 4px;
    }
  </style>
</head>
<body>

<header>
  <h1>FINO Platform</h1>
  <p>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ - Ù…Ù‚Ø§Ø±Ù†Ø© Ø´Ø§Ù…Ù„Ø©</p>
</header>

<div id="landing-page" class="container">
  <div class="card">
    <h2 style="color:#1e3a8a;">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</h2>
    <p>Ø§Ø®ØªØ± ÙˆØ¬Ù‡ØªÙƒ:</p>
    <button class="btn" onclick="showPage('calculator')">Ø¯Ø®ÙˆÙ„ ÙƒØ¹Ù…ÙŠÙ„ (Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„)</button>
    <button class="btn btn-secondary" onclick="showPage('admin-login')">Ø¯Ø®ÙˆÙ„ Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø¨Ù†ÙˆÙƒ</button>
  </div>
</div>

<div id="calculator-page" class="container hidden">
  <div class="card">
    <h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ…ÙˆÙŠÙ„</h3>
    
    <div class="form-group">
      <label>Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„</label>
      <select id="financeType" onchange="toggleRealEstateFields()"></select>
    </div>

    <div class="form-group">
      <label>Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù…Ù„</label>
      <select id="sector" onchange="toggleMilitaryFields()">
        <option value="govt">Ø­ÙƒÙˆÙ…ÙŠ Ù…Ø¯Ù†ÙŠ</option>
        <option value="military">Ø¹Ø³ÙƒØ±ÙŠ</option>
        <option value="private">Ù‚Ø·Ø§Ø¹ Ø®Ø§Øµ</option>
        <option value="retired">Ù…ØªÙ‚Ø§Ø¹Ø¯</option>
      </select>
    </div>

    <div id="military-fields" class="hidden" style="background: #f8fafc; padding: 10px; border-radius: 8px; border: 1px solid #e2e8f0;">
        <div class="form-group">
            <label style="display:flex; align-items:center;">
                <input type="checkbox" id="isExtended" onchange="toggleExtendedInputs()" style="width:auto; margin-left:8px;">
                Ø±ØºØ¨Ø© ÙÙŠ Ø§Ù„Ø§Ø­ØªØ³Ø§Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù…ØªØ¯ (Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯)ØŸ
            </label>
        </div>
        
        <div id="extended-inputs" class="hidden">
            <div class="form-group">
                <label>Ø§Ù„Ø±ØªØ¨Ø© Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
                <select id="militaryRank">
                    <option value="mllzm">Ù…Ù„Ø§Ø²Ù…</option>
                    <option value="mllzm1">Ù…Ù„Ø§Ø²Ù… Ø£ÙˆÙ„</option>
                    <option value="nqyb">Ù†Ù‚ÙŠØ¨</option>
                    <option value="ra'id">Ø±Ø§Ø¦Ø¯</option>
                    <option value="mqdm">Ù…Ù‚Ø¯Ù…</option>
                    <option value="aqyd">Ø¹Ù‚ÙŠØ¯</option>
                    <option value="amyd">Ø¹Ù…ÙŠØ¯</option>
                    <option value="lwa">Ù„ÙˆØ§Ø¡</option>
                    <option value="jndy">Ø¬Ù†Ø¯ÙŠ</option>
                    <option value="jndy1">Ø¬Ù†Ø¯ÙŠ Ø£ÙˆÙ„</option>
                    <option value="aryf">Ø¹Ø±ÙŠÙ</option>
                    <option value="wkyl">ÙˆÙƒÙŠÙ„ Ø±Ù‚ÙŠØ¨</option>
                    <option value="rqyb">Ø±Ù‚ÙŠØ¨</option>
                    <option value="rqyb1">Ø±Ù‚ÙŠØ¨ Ø£ÙˆÙ„</option>
                    <option value="ra'ys">Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡</option>
                </select>
            </div>
            <div class="form-group">
                <label>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø¨Ø¯ÙˆÙ† Ø¨Ø¯Ù„Ø§Øª)</label>
                <input type="number" id="currentBasicSalary" placeholder="Ù…Ø«Ù„Ø§Ù‹: 10000">
            </div>
            <div class="form-group">
                <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ† (Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø®Ø¯Ù…Ø©)</label>
                <input type="date" id="appointmentDate">
            </div>
        </div>
    </div>

    <div class="form-group">
      <label>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØµØ§ÙÙŠ (ÙŠÙ†Ø²Ù„ Ø¨Ø§Ù„ØµØ±Ø§Ù)</label>
      <input type="number" id="salary" placeholder="Ù…Ø«Ù„Ø§Ù‹: 12000" />
    </div>

    <div class="form-group">
      <label>Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
      <input type="number" id="liabilities" value="0" />
    </div>

    <div class="form-group">
      <label>Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ (Ø³Ù†ÙˆØ§Øª)</label>
      <input type="number" id="years" value="5" />
    </div>

    <div id="real-estate-fields" class="hidden">
      <div class="form-group">
        <label>Ø³Ø¹Ø± Ø§Ù„Ø¹Ù‚Ø§Ø±</label>
        <input type="number" id="propertyPrice" value="0" />
      </div>
      <div class="form-group">
        <label>Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø³ÙƒÙ†ÙŠ (Ø¥Ù† ÙˆØ¬Ø¯)</label>
        <input type="number" id="sakaniSupport" value="0" />
      </div>
    </div>

    <button class="btn" onclick="calculate()">Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø±ÙˆØ¶</button>
    <button class="btn btn-secondary" onclick="showPage('landing')">Ø±Ø¬ÙˆØ¹</button>
  </div>
</div>

<div id="results-page" class="container hidden">
  <div id="results-container"></div> <div class="card no-print">
    <button class="btn" onclick="shareAsImage()">Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙƒØµÙˆØ±Ø©</button>
    <button class="btn btn-secondary" onclick="showPage('calculator')">Ø¨Ø­Ø« Ø¬Ø¯ÙŠØ¯</button>
  </div>
</div>

<div id="admin-login" class="container hidden">
  <div class="card admin-login">
    <h3>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h3>
    <div class="form-group">
      <input type="password" id="adminPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
    </div>
    <button class="btn" onclick="adminLogin()">Ø¯Ø®ÙˆÙ„</button>
    <button class="btn btn-secondary" onclick="showPage('landing')">Ø±Ø¬ÙˆØ¹</button>
  </div>
</div>

<div id="admin-panel" class="container hidden" style="max-width:800px;">
  <div class="card">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ù†ÙˆÙƒ ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
        <button class="btn btn-success" style="width:auto; padding:5px 10px; font-size:14px;" onclick="addNewProduct()">+ Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</button>
    </div>
    <div id="admin-banks-list" class="admin-panel"></div>
    <br>
    <button class="btn" onclick="saveBankSettings()">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
    <button class="btn btn-secondary" onclick="showPage('landing')">Ø®Ø±ÙˆØ¬</button>
  </div>
</div>

<script>
  // ============ 1. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø«ÙˆØ§Ø¨Øª ============
  
  // Ø¬Ø¯ÙˆÙ„ Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠÙŠÙ† (Ø­Ø³Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø²ÙˆØ¯Ø©)
  const MILITARY_SALARY_TABLE = {
      // Ø§Ù„Ø¶Ø¨Ø§Ø·
      "mllzm":  { inc: 380, steps: [7590,7970,8350,8730,9110,9490,9870,10250,10630,11010,11390,11770,12150,12530,12910] }, // Ù…Ù„Ø§Ø²Ù…
      "mllzm1": { inc: 440, steps: [8835,9275,9715,10155,10595,11035,11475,11915,12355,12795,13235,13675,14115,14555,14995] }, // Ù…Ù„Ø§Ø²Ù… Ø£ÙˆÙ„
      "nqyb":   { inc: 495, steps: [10600,11095,11590,12085,12580,13075,13570,13835,14100,14365,14630,14895,15160,15425,15690] }, // Ù†Ù‚ÙŠØ¨
      "ra'id":  { inc: 265, steps: [13515,13780,14045,14310,14575,14840,15105,15370,15635,15900,16165,16430,16695,16960,17225] }, // Ø±Ø§Ø¦Ø¯
      "mqdm":   { inc: 470, steps: [14645,15115,15585,16055,16525,16995,17465,17935,18405,18875,19345,19815,20285,20755] }, // Ù…Ù‚Ø¯Ù… (Ù†Ø§Ù‚Øµ Ø³Ù†Ø© ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„ÙƒÙ† Ù…Ù‚Ø¨ÙˆÙ„)
      "aqyd":   { inc: 590, steps: [16520,17110,17700,18290,18880,19470,20060,20650,21240,21830,22420,23010,23600] }, // Ø¹Ù‚ÙŠØ¯
      "amyd":   { inc: 650, steps: [18800,19450,20100,20750,21400,22050,22700,23350,24000,24650,25300,25950] }, // Ø¹Ù…ÙŠØ¯
      "lwa":    { inc: 730, steps: [21390,22120,22850,23580,24310,25040,25770,26500,27230,27960,28690] }, // Ù„ÙˆØ§Ø¡

      // Ø§Ù„Ø£ÙØ±Ø§Ø¯
      "jndy":   { inc: 130, steps: [3220,3350,3480,3610,3740,3870,4000,4130,4260,4390,4520,4650,4780,4910,5040] }, // Ø¬Ù†Ø¯ÙŠ
      "jndy1":  { inc: 145, steps: [3395,3540,3685,3830,3975,4120,4265,4410,4555,4700,4845,4990,5135,5280,5425] }, // Ø¬Ù†Ø¯ÙŠ Ø£ÙˆÙ„
      "aryf":   { inc: 175, steps: [3765,3940,4115,4290,4465,4640,4815,4990,5165,5340,5515,5690,5865,6040,6215] }, // Ø¹Ø±ÙŠÙ
      "wkyl":   { inc: 210, steps: [4455,4665,4875,5085,5295,5505,5715,5925,6135,6345,6555,6765,6975,7185,7395] }, // ÙˆÙƒÙŠÙ„ Ø±Ù‚ÙŠØ¨
      "rqyb":   { inc: 250, steps: [5260,5510,5760,6010,6260,6510,6760,7010,7260,7510,7760,8010,8260,8510,8760] }, // Ø±Ù‚ÙŠØ¨
      "rqyb1":  { inc: 300, steps: [6180,6480,6780,7080,7380,7680,7980,8280,8580,8880,9180,9480,9780,10080,10380] }, // Ø±Ù‚ÙŠØ¨ Ø£ÙˆÙ„
      "ra'ys":  { inc: 360, steps: [7215,7575,7935,8295,8655,9015,9375,9735,10095,10455,10815,11175,11535,11895,12255] } // Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡
  };

  // Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (ØªÙ… Ø¥Ø¶Ø§ÙØ© deductionRatio)
  let financeProducts = [
    { id: 'personal', name: 'ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ', deductionRatio: 0.33 },
    { id: 'real_estate', name: 'ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ', deductionRatio: 0.60 },
    { id: 'auto', name: 'ØªÙ…ÙˆÙŠÙ„ Ø³ÙŠØ§Ø±Ø§Øª', deductionRatio: 0.33 }
  ];

  // Ø§Ù„Ø¨Ù†ÙˆÙƒ
  // rates: Ø§Ù„Ù†Ø³Ø¨, notes: Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø³Ø¨Ø©
  let banks = [
    { id: 1, name: 'Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ', rates: { personal: 3.10, real_estate: 4.5, auto: 3.5 }, notes: {} },
    { id: 2, name: 'Ø§Ù„Ø£Ù‡Ù„ÙŠ', rates: { personal: 2.95, real_estate: 4.2, auto: 3.4 }, notes: {} },
    { id: 3, name: 'Ø§Ù„Ø¥Ù†Ù…Ø§Ø¡', rates: { personal: 2.80, real_estate: 4.0, auto: 3.2 }, notes: {} },
    { id: 4, name: 'Ø§Ù„Ø±ÙŠØ§Ø¶', rates: { personal: 3.20, real_estate: 4.6, auto: 3.6 }, notes: {} },
    { id: 5, name: 'Ø§Ù„Ø¨Ù„Ø§Ø¯', rates: { personal: 3.00, real_estate: 4.3, auto: 3.3 }, notes: {} }
  ];

  // ============ 2. Ø§Ù„ØªÙ†Ù‚Ù„ ÙˆØ§Ù„ÙˆØ§Ø¬Ù‡Ø© ============
  function showPage(pageId) {
    document.querySelectorAll('.container').forEach(d => d.classList.add('hidden'));
    document.getElementById(pageId === 'landing' ? 'landing-page' :
                            pageId === 'calculator' ? 'calculator-page' :
                            pageId === 'results' ? 'results-page' :
                            pageId === 'admin-login' ? 'admin-login' :
                            pageId === 'admin-panel' ? 'admin-panel' : 'landing-page').classList.remove('hidden');
    if(pageId === 'calculator') loadFinanceProducts();
  }

  function loadFinanceProducts() {
    const sel = document.getElementById('financeType');
    sel.innerHTML = '';
    financeProducts.forEach(p => {
      const opt = document.createElement('option');
      opt.value = p.id;
      opt.textContent = p.name;
      sel.appendChild(opt);
    });
    toggleRealEstateFields();
  }

  function toggleRealEstateFields() {
    const type = document.getElementById('financeType').value;
    const isRE = (type === 'real_estate');
    const fields = document.getElementById('real-estate-fields');
    if(isRE) fields.classList.remove('hidden'); else fields.classList.add('hidden');
  }

  function toggleMilitaryFields() {
      const sector = document.getElementById('sector').value;
      const milFields = document.getElementById('military-fields');
      if (sector === 'military') {
          milFields.classList.remove('hidden');
      } else {
          milFields.classList.add('hidden');
          // Reset internal checks if switched away
          document.getElementById('isExtended').checked = false;
          toggleExtendedInputs();
      }
  }

  function toggleExtendedInputs() {
      const isExtended = document.getElementById('isExtended').checked;
      const extInputs = document.getElementById('extended-inputs');
      if (isExtended) {
          extInputs.classList.remove('hidden');
      } else {
          extInputs.classList.add('hidden');
      }
  }

  // ============ 3. Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ============
  
  // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠ
  function calculateProjectedRetirement(rank, currentBasic, appointDate, yearsToRetire) {
      const rankData = MILITARY_SALARY_TABLE[rank];
      if (!rankData) return { salary: 0, serviceMonths: 0 };

      // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
      // Ù†Ø¨Ø­Ø« Ø¹Ù† Ø£Ù‚Ø±Ø¨ Ù‚ÙŠÙ…Ø© ØªØ³Ø§ÙˆÙŠ Ø£Ùˆ ØªÙ‚Ù„ Ø¹Ù† Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ù…ØµÙÙˆÙØ© Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
      // Ø£Ùˆ Ù†ÙØªØ±Ø¶ Ø£Ù†Ù‡ ÙÙŠ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„ØªÙŠ ØªØ·Ø§Ø¨Ù‚ Ø±Ø§ØªØ¨Ù‡
      let currentStepIndex = rankData.steps.findIndex(s => s >= currentBasic);
      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø±Ø§ØªØ¨Ù‡ Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ØŒ Ù†Ø£Ø®Ø° Ø¢Ø®Ø± Ø¯Ø±Ø¬Ø©
      if (currentStepIndex === -1 && currentBasic > rankData.steps[0]) {
          currentStepIndex = rankData.steps.length - 1;
      } else if (currentStepIndex === -1) {
          currentStepIndex = 0; // Ø§ÙØªØ±Ø§Ø¶ÙŠ
      }

      // Ø¨Ø¹Ø¯ Ø¹Ø¯Ø¯ Ø³Ù†ÙˆØ§Øª Ø§Ù„ØªÙ…ÙˆÙŠÙ„ (yearsToRetire)ØŒ ÙƒÙ… Ø³ØªÙƒÙˆÙ† Ø§Ù„Ø¯Ø±Ø¬Ø©ØŸ
      let futureStepIndex = currentStepIndex + yearsToRetire;
      if (futureStepIndex >= rankData.steps.length) futureStepIndex = rankData.steps.length - 1;
      
      const futureBasicSalary = rankData.steps[futureStepIndex];

      // Ø­Ø³Ø§Ø¨ Ù…Ø¯Ø© Ø§Ù„Ø®Ø¯Ù…Ø© Ø¨Ø§Ù„Ø£Ø´Ù‡Ø±
      const appDateObj = new Date(appointDate);
      const now = new Date();
      // Ù†Ø¶ÙŠÙ Ø³Ù†ÙˆØ§Øª Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… Ù„Ù†Ø¹Ø±Ù ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
      const retireDateObj = new Date();
      retireDateObj.setFullYear(now.getFullYear() + yearsToRetire);

      // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ±Ù‚ Ø¨Ø§Ù„Ø£Ø´Ù‡Ø±
      let monthsOfService = (retireDateObj.getFullYear() - appDateObj.getFullYear()) * 12;
      monthsOfService -= appDateObj.getMonth();
      monthsOfService += retireDateObj.getMonth();

      // Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯: (Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø§Ù„Ø£Ø®ÙŠØ± Ã— Ø£Ø´Ù‡Ø± Ø§Ù„Ø®Ø¯Ù…Ø©) Ã· 420
      // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù…Ø¹Ø§Ø´ Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø§Ù„Ø£Ø®ÙŠØ±
      let retirementSalary = (futureBasicSalary * monthsOfService) / 420;
      if (retirementSalary > futureBasicSalary) retirementSalary = futureBasicSalary;

      return {
          salary: Math.round(retirementSalary),
          serviceMonths: monthsOfService,
          futureBasic: futureBasicSalary
      };
  }

  function calculate() {
    // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
    const salary = parseFloat(document.getElementById('salary').value);
    const liabilities = parseFloat(document.getElementById('liabilities').value);
    const years = parseFloat(document.getElementById('years').value);
    const financeType = document.getElementById('financeType').value;
    const sector = document.getElementById('sector').value;
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
    if (!salary || !years) { alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ø§ØªØ¨ ÙˆÙ…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„'); return; }

    // ØªØ­Ø¯ÙŠØ¯ Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªÙ‚Ø·Ø§Ø¹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬
    const selectedProduct = financeProducts.find(p => p.id === financeType);
    let deductionRatio = selectedProduct ? selectedProduct.deductionRatio : 0.33; // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ 33% Ø§Ø°Ø§ Ù„Ù… ÙŠØ­Ø¯Ø¯

    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù‚Ø³Ø·
    const maxInstallment = (salary * deductionRatio) - liabilities;

    if (maxInstallment <= 0) {
      alert('Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹ØŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙØ§Ø¦Ø¶ Ù„Ù„Ù‚Ø³Ø·.');
      return;
    }

    // Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ Ø§Ù„Ù…Ù…ØªØ¯
    let retirementInfo = null;
    const isMilitary = (sector === 'military');
    const isExtended = document.getElementById('isExtended').checked;

    if (isMilitary && isExtended) {
        const rank = document.getElementById('militaryRank').value;
        const currentBasic = parseFloat(document.getElementById('currentBasicSalary').value);
        const appointDate = document.getElementById('appointmentDate').value;

        if (!currentBasic || !appointDate) {
            alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ù…ØªØ¯');
            return;
        }

        // Ù†Ù‚ÙˆÙ… Ø¨Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ø§ÙØªØ±Ø§Ø¶ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø³ÙŠÙƒÙˆÙ† Ø¨Ù†Ù‡Ø§ÙŠØ© ÙØªØ±Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ (Ø£Ùˆ Ø¨Ø¹Ø¯Ù‡Ø§ Ø¨Ù‚Ù„ÙŠÙ„)
        // Ù‡Ù†Ø§ Ø³Ù†ÙØªØ±Ø¶ Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø³ÙŠØªÙ‚Ø§Ø¹Ø¯ Ø¨Ø¹Ø¯ Ø¹Ø¯Ø¯ Ø³Ù†ÙˆØ§Øª Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¯Ø®Ù„Ø© (ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„Ù…Ø«Ø§Ù„: ÙŠØ±ÙŠØ¯ ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ ÙˆÙŠØªÙ‚Ø§Ø¹Ø¯ Ø¨Ø¹Ø¯ Ø³Ù†ØªÙŠÙ†)
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªÙ…ÙˆÙŠÙ„ 5 Ø³Ù†ÙˆØ§ØªØŒ Ù†Ø­Ø³Ø¨ Ø±Ø§ØªØ¨Ù‡ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ÙŠ Ø¨Ø¹Ø¯ 5 Ø³Ù†ÙˆØ§Øª
        retirementInfo = calculateProjectedRetirement(rank, currentBasic, appointDate, parseInt(years));
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
    const resultsContainer = document.getElementById('results-container');
    resultsContainer.innerHTML = `
        <div class="card result-card" style="background:#f0f9ff; text-align:center;">
            <h3>Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨</h3>
            <p>Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„: ${selectedProduct.name}</p>
            <p>Ø§Ù„Ø±Ø§ØªØ¨: ${salary} Ø±ÙŠØ§Ù„ | Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª: ${liabilities} Ø±ÙŠØ§Ù„</p>
            <p>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù‚Ø³Ø· Ø§Ù„Ù†Ø¸Ø§Ù…ÙŠ: ${Math.round(maxInstallment)} Ø±ÙŠØ§Ù„</p>
            ${retirementInfo ? `
            <div class="retirement-info">
                <strong>Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø§Ù„Ù…Ù…ØªØ¯:</strong><br>
                Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ Ø¹Ù†Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯: ${retirementInfo.futureBasic} Ø±ÙŠØ§Ù„<br>
                Ù…Ø¯Ø© Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ø­ØªØ³Ø¨Ø©: ${Math.floor(retirementInfo.serviceMonths/12)} Ø³Ù†Ø© Ùˆ ${retirementInfo.serviceMonths%12} Ø´Ù‡Ø±<br>
                <strong>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ÙŠ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ ÙÙŠ Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${retirementInfo.salary} Ø±ÙŠØ§Ù„</strong>
            </div>` : ''}
        </div>
    `;

    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ù„ÙƒÙ„ Ø¨Ù†Ùƒ
    // Ù…Ø¹Ø§Ø¯Ù„Ø© Ø¨Ø³ÙŠØ·Ø©: Ø§Ù„Ù‚Ø±Ø¶ = Ø§Ù„Ù‚Ø³Ø· * Ø§Ù„Ø£Ø´Ù‡Ø± / (1 + (Ø§Ù„Ù†Ø³Ø¨Ø© * Ø§Ù„Ø³Ù†ÙˆØ§Øª)) ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹
    // Ø£Ùˆ: TotalCost = Loan * (1 + Rate*Years). Installment = TotalCost / Months.
    // Loan = (Installment * Months) / (1 + Rate*Years)
    
    // Ø§Ù„ÙØ±Ø²: Ø§Ù„Ø£Ù‚Ù„ Ù†Ø³Ø¨Ø© Ø£ÙˆÙ„Ø§Ù‹
    const sortedBanks = [...banks].sort((a,b) => {
      let rA = a.rates[financeType] || 100;
      let rB = b.rates[financeType] || 100;
      return rA - rB;
    });

    sortedBanks.forEach(bank => {
      let rate = bank.rates[financeType];
      if (!rate) return; // Ø§Ù„Ø¨Ù†Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬

      // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©
      // Ø§Ù„ÙØ§Ø¦Ø¯Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ© = Ø§Ù„Ù…Ø¨Ù„Øº * (Ø§Ù„Ù†Ø³Ø¨Ø©/100)
      // Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ = Ø§Ù„Ù…Ø¨Ù„Øº + (Ø§Ù„ÙØ§Ø¦Ø¯Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ© * Ø§Ù„Ø³Ù†ÙˆØ§Øª)
      // Ø§Ù„Ù‚Ø³Ø· = Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ / (Ø§Ù„Ø³Ù†ÙˆØ§Øª * 12)
      // Ø¹ÙƒØ³ÙŠØ§Ù‹: Ø§Ù„Ù…Ø¨Ù„Øº = (Ø§Ù„Ù‚Ø³Ø· * 12 * Ø§Ù„Ø³Ù†ÙˆØ§Øª) / (1 + (Ø§Ù„Ù†Ø³Ø¨Ø©/100 * Ø§Ù„Ø³Ù†ÙˆØ§Øª))
      
      const months = years * 12;
      const profitMargin = (rate / 100) * years;
      const loanAmount = (maxInstallment * months) / (1 + profitMargin);
      const totalCost = loanAmount * (1 + profitMargin); // Ø£Ùˆ maxInstallment * months
      const profitAmount = totalCost - loanAmount;

      // Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ø¹Ø±Ø¶
      const note = bank.notes && bank.notes[financeType] ? bank.notes[financeType] : '';

      // Ù†Øµ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨
      const shareText = `Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…ØŒ Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ù† Ù…Ù†ØµØ© FINO:\n` +
                        `Ø§Ù„Ø¨Ù†Ùƒ: ${bank.name}\n` +
                        `Ø§Ù„ØªÙ…ÙˆÙŠÙ„: ${selectedProduct.name}\n` +
                        `Ø§Ù„Ù‚Ø³Ø·: ${Math.round(maxInstallment)} Ø±ÙŠØ§Ù„\n` +
                        `Ø§Ù„Ù†Ø³Ø¨Ø©: ${rate}%\n` +
                        `Ù…Ø¨Ù„Øº Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: ${Math.round(loanAmount).toLocaleString()} Ø±ÙŠØ§Ù„\n` +
                        (note ? `Ù…Ù„Ø§Ø­Ø¸Ø©: ${note}` : '');

      const div = document.createElement('div');
      div.className = 'result-card card';
      div.innerHTML = `
        <div class="bank-header">
          <span class="bank-name">${bank.name}</span>
          <div style="text-align:left;">
             <span class="bank-rate">${rate}%</span>
             ${note ? `<span class="rate-note">${note}</span>` : ''}
          </div>
        </div>
        <div class="result-row"><span>Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ:</span> <span class="val">${Math.round(maxInstallment)} Ø±ÙŠØ§Ù„</span></div>
        <div class="result-row"><span>Ù…Ø¨Ù„Øº Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ:</span> <span class="val" style="color:#059669; font-size:18px;">${Math.round(loanAmount).toLocaleString()} Ø±ÙŠØ§Ù„</span></div>
        <div class="result-row"><span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­:</span> <span class="val">${Math.round(profitAmount).toLocaleString()} Ø±ÙŠØ§Ù„</span></div>
        <div class="result-row"><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù„Ù„Ø³Ø¯Ø§Ø¯:</span> <span class="val">${Math.round(totalCost).toLocaleString()} Ø±ÙŠØ§Ù„</span></div>
        
        <div style="margin-top:15px; display:flex; gap:5px; flex-wrap:wrap;">
            <button class="btn btn-whatsapp" style="flex:1; font-size:14px;" onclick="window.open('https://api.whatsapp.com/send?text=${encodeURIComponent(shareText)}', '_blank')">
                Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù†ØµØ§Ù‹ ğŸ“±
            </button>
            <button class="btn btn-whatsapp" style="flex:1; background:#128C7E; font-size:14px;" onclick="contactBank('${bank.name}', '${shareText}')">
                 ØªÙˆØ§ØµÙ„ ÙˆØ§ØªØ³Ø§Ø¨
            </button>
        </div>
      `;
      resultsContainer.appendChild(div);
    });

    showPage('results');
  }

  // Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙˆØ§ØµÙ„ (ÙŠÙ…ÙƒÙ† ÙˆØ¶Ø¹ Ø±Ù‚Ù… Ø­Ù‚ÙŠÙ‚ÙŠ Ù‡Ù†Ø§)
  function contactBank(bankName, msgDetails) {
      // Ø±Ù‚Ù… Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ù…Ù†ØµØ© Ø£Ùˆ Ø§Ù„Ù…ÙˆØ¸ÙØŒ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡
      const phone = "966500000000"; 
      const msg = `Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… Ù…ÙˆØ¬Ù‡ Ù…Ù† Ø§Ù„Ù…Ù†ØµØ©\nÙ…Ø´Ø§Ø±Ùƒ Ø¨Ø§Ù„Ù†ØªÙŠØ¬Ø©:\n${msgDetails}`;
      window.open(`https://api.whatsapp.com/send?phone=${phone}&text=${encodeURIComponent(msg)}`, '_blank');
  }

  // ØªØµÙˆÙŠØ± Ø§Ù„Ø´Ø§Ø´Ø©
  function shareAsImage() {
    const element = document.getElementById('results-container');
    html2canvas(element, { scale: 2, backgroundColor:'#ffffff' }).then(canvas => {
      const link = document.createElement('a');
      link.download = 'fino-result.jpg';
      link.href = canvas.toDataURL('image/jpeg', 0.9);
      link.click();
    });
  }

  // ============ 4. Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ ============
  function adminLogin() {
    const p = document.getElementById('adminPass').value;
    if(p === '123') { // ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¨Ø³ÙŠØ·Ø©
      renderAdminBanks();
      showPage('admin-panel');
    } else {
      alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©');
    }
  }

  function renderAdminBanks() {
    const list = document.getElementById('admin-banks-list');
    list.innerHTML = '';

    // Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
    let tableHtml = `<table><thead><tr><th>Ø§Ù„Ø¨Ù†Ùƒ</th>`;
    financeProducts.forEach(fp => {
        tableHtml += `<th>${fp.name}<br><span style="font-size:10px; font-weight:normal; color:#555;">(Ø§Ø³ØªÙ‚Ø·Ø§Ø¹ ${Math.round(fp.deductionRatio*100)}%)</span></th>`;
    });
    tableHtml += `</tr></thead><tbody>`;

    banks.forEach((bank, bIndex) => {
      tableHtml += `<tr><td><strong>${bank.name}</strong></td>`;
      
      financeProducts.forEach(fp => {
        const rateVal = bank.rates[fp.id] || 0;
        const noteVal = (bank.notes && bank.notes[fp.id]) ? bank.notes[fp.id] : '';
        
        tableHtml += `
          <td>
            <input type="number" step="0.01" value="${rateVal}" id="rate-${bIndex}-${fp.id}" placeholder="%">
            <input type="text" class="rate-note-input" value="${noteVal}" id="note-${bIndex}-${fp.id}" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ø¹Ø±Ø¶">
          </td>
        `;
      });
      
      tableHtml += `</tr>`;
    });

    tableHtml += `</tbody></table>`;
    list.innerHTML = tableHtml;
  }

  function addNewProduct() {
      const name = prompt("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ù…Ù†ØªØ¬ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯:");
      if(!name) return;
      const id = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¹Ø±Ù (ID) Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© (Ù…Ø«Ø§Ù„: personal_loan_2):");
      if(!id) return;
      
      // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ ÙˆØ·Ù„Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªÙ‚Ø·Ø§Ø¹
      let ded = prompt("Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªÙ‚Ø·Ø§Ø¹ Ù…Ù† Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØµØ§ÙÙŠØŸ\n(Ù…Ø«Ø§Ù„: Ø£Ø¯Ø®Ù„ 33 Ù„Ù€ 33%ØŒ Ø£Ùˆ 60 Ù„Ù€ 60%)", "33");
      if(!ded) return;
      
      let deductionRatio = parseFloat(ded) / 100;
      if(isNaN(deductionRatio)) deductionRatio = 0.33;

      financeProducts.push({ id: id, name: name, deductionRatio: deductionRatio });
      alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ¹Ø¯ÙŠÙ„ Ù†Ø³Ø¨ Ø§Ù„Ø¨Ù†ÙˆÙƒ Ù„Ù‡.");
      renderAdminBanks(); // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„
  }

  function saveBankSettings() {
    banks.forEach((bank, bIndex) => {
      financeProducts.forEach(fp => {
        // Ø­ÙØ¸ Ø§Ù„Ù†Ø³Ø¨Ø©
        const rateInput = document.getElementById(`rate-${bIndex}-${fp.id}`);
        if(rateInput) {
           bank.rates[fp.id] = parseFloat(rateInput.value);
        }
        
        // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©
        const noteInput = document.getElementById(`note-${bIndex}-${fp.id}`);
        if(noteInput) {
            if(!bank.notes) bank.notes = {};
            bank.notes[fp.id] = noteInput.value;
        }
      });
    });
    alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
  }

  // ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ
  document.addEventListener('DOMContentLoaded', () => {
    showPage('landing');
  });

</script>
</body>
</html>