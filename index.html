<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù…ÙƒØªØ¨ Ø§Ù„Ù…ÙˆØ¸Ù - Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø±</title>

  <!-- Ø®Ø· Tajawal -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800;900&display=swap" rel="stylesheet">

  <!-- Ù…ÙƒØªØ¨Ø© QR -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  <!-- Ù…ÙƒØªØ¨Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù†ØµØ± Ù„ØµÙˆØ±Ø© -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <style>
    *{box-sizing:border-box}
    :root{
      --bg:#020617;
      --card:rgba(249,250,251,.97);
      --text:#0f172a;
      --muted:#6b7280;
      --line:#e5e7eb;
      --blue:#1d4ed8;
      --blue2:#2563eb;
      --okbg:#ecfdf5;--okbd:#a7f3d0;--oktx:#065f46;
      --wrbg:#fef2f2;--wrbd:#fecaca;--wrtx:#991b1b;
    }
    body{
      margin:0;
      font-family:"Tajawal",system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
      background:
        radial-gradient(1200px 700px at 70% -10%, rgba(37,99,235,.35), transparent 60%),
        radial-gradient(1000px 700px at 15% 15%, rgba(16,185,129,.18), transparent 55%),
        var(--bg);
      color:var(--text);
      direction:rtl;
      text-align:center;
      -webkit-font-smoothing:antialiased;
    }
    .app{min-height:100vh;display:flex;flex-direction:column}
    header{
      position:sticky;top:0;z-index:50;
      padding:14px 12px;
      background:linear-gradient(135deg,#0b1224,var(--blue));
      box-shadow:0 14px 40px rgba(0,0,0,.45);
      color:#e5e7eb;
    }
    .top{
      max-width:1024px;margin:0 auto;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
    }
    .brand{display:flex;align-items:center;gap:10px;text-align:right;}
    .brand img{
      width:44px;height:44px;border-radius:14px;
      object-fit:contain;background:#fff;padding:5px;
      border:1px solid rgba(255,255,255,.28);
      box-shadow:0 10px 30px rgba(0,0,0,.35);
    }
    .brand .name{font-weight:900;font-size:18px;letter-spacing:.02em}
    .brand .tag{font-size:11px;color:#bfdbfe}
    .dt{font-size:12px;text-align:left;opacity:.95}

    main{flex:1;padding:18px 10px 26px;display:flex;justify-content:center}
    .screen{display:none;width:100%;max-width:980px;margin:0 auto}
    .screen.active{display:block}

    .card{
      background:var(--card);
      border-radius:20px;
      padding:20px 14px;
      border:1px solid rgba(229,231,235,.98);
      box-shadow:0 22px 60px rgba(2,6,23,.40);
      backdrop-filter:blur(8px);
    }
    @media(min-width:768px){.card{padding:26px 22px}}

    .title{font-size:26px;font-weight:900;color:var(--text);margin:0 0 6px}
    .sub{margin:0 0 18px;font-size:15px;color:var(--muted);line-height:1.7}

    .warn{
      text-align:right;
      background:var(--wrbg);border:1px solid var(--wrbd);
      color:var(--wrtx);
      padding:9px 11px;border-radius:14px;
      font-size:13px;margin-bottom:10px;line-height:1.7;font-weight:900;
    }
    .ok{
      text-align:right;
      background:var(--okbg);border:1px solid var(--okbd);
      color:var(--oktx);
      padding:9px 11px;border-radius:14px;
      font-size:13px;margin-bottom:10px;line-height:1.7;font-weight:900;
    }

    label{display:block;text-align:right;margin:0 0 5px;font-weight:900;color:#374151;font-size:14px}
    input,select,textarea{
      width:100%;border-radius:14px;
      border:1px solid #d1d5db;
      padding:11px 11px;font-size:16px;font-family:inherit;
      outline:none;background:#fff;transition:.12s;
    }
    input:focus,select:focus,textarea:focus{
      border-color:var(--blue2);
      box-shadow:0 0 0 2px rgba(37,99,235,.22);
      background:#f9fafb;
    }
    textarea{min-height:130px;resize:vertical}
    .field{margin-bottom:13px;text-align:right}
    .hint{font-size:12px;color:var(--muted);text-align:right;margin-top:4px}

    .actions{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:12px}
    .btn{
      border:none;cursor:pointer;border-radius:999px;
      padding:10px 18px;font-weight:900;font-size:15px;
      font-family:inherit;display:inline-flex;align-items:center;justify-content:center;gap:6px;
      transition:.08s transform,.12s box-shadow,.12s filter;
    }
    .btn:active{transform:scale(.97)}
    .primary{
      color:#fff;
      background:linear-gradient(135deg,var(--blue2),var(--blue));
      box-shadow:0 18px 36px rgba(37,99,235,.40);
    }
    .secondary{background:#e5e7eb;color:#111827}
    .ghost{background:transparent;color:#6b7280}
    .danger{background:#dc2626;color:#fff}

    .grid{
      display:grid;gap:14px;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      margin-top:10px;
    }
    .tile{
      background:#fff;border-radius:22px;padding:15px 13px;
      border:1px solid var(--line);
      box-shadow:0 14px 30px rgba(2,6,23,.12);
      text-align:right;cursor:pointer;transition:.12s;
    }
    .tile:hover{
      transform:translateY(-3px);
      border-color:#bfdbfe;
      box-shadow:0 22px 44px rgba(2,6,23,.18);
    }
    .tile .ico{font-size:28px;margin-bottom:5px}
    .tile .t{font-weight:900;font-size:16px;margin-bottom:4px}
    .tile .d{font-size:13px;color:var(--muted);line-height:1.6}

    .searchBar{
      display:flex;gap:10px;flex-wrap:wrap;
      align-items:center;justify-content:space-between;
      margin-bottom:12px;background:#fff;border-radius:18px;
      padding:9px 10px;
      border:1px solid var(--line);
      box-shadow:0 10px 22px rgba(2,6,23,.10);
      text-align:right;
    }
    .searchBar .right{flex:1;min-width:220px}
    .searchBar .left{display:flex;gap:8px;flex-wrap:wrap}
    .small{font-size:12px;color:var(--muted)}

    .bankCard{
      background:#fff;border-radius:18px;padding:11px 11px;
      border:1px solid var(--line);
      box-shadow:0 10px 22px rgba(2,6,23,.10);
      text-align:right;margin-bottom:10px;
    }
    .bankTop{display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding-bottom:7px;margin-bottom:7px;border-bottom:1px dashed var(--line);}
    .chip{
      display:inline-flex;align-items:center;gap:6px;
      border-radius:999px;padding:4px 10px;
      background:#eff6ff;color:var(--blue);
      font-weight:900;font-size:12px;
    }

    .row2{display:grid;grid-template-columns:1fr 1fr;gap:9px}
    @media(max-width:520px){.row2{grid-template-columns:1fr}}

    .inlineBtns{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-start;margin-top:7px}

    .paperWrap{
      background:linear-gradient(135deg,rgba(219,234,254,.95),rgba(248,250,252,.97));
      border-radius:18px;padding:10px;border:1px solid rgba(191,219,254,.95);
    }
    .paper{
      background:#fff;border-radius:20px;
      border:1px solid var(--line);
      overflow:hidden;
      max-width:820px;margin:0 auto;
      box-shadow:0 22px 60px rgba(2,6,23,.20);
      text-align:right;
      direction:rtl;unicode-bidi:plaintext;
    }
    .paperHeader{
      padding:13px 13px;
      background:linear-gradient(135deg,#0b1224,var(--blue));
      color:#fff;
      display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;
    }
    .pBrand{display:flex;align-items:center;gap:9px}
    .pBrand img{width:40px;height:40px;border-radius:14px;background:#fff;padding:4px;object-fit:contain}
    .pName{font-weight:900;font-size:16px}
    .pTag{font-size:11px;color:#bfdbfe}
    .pMeta{font-size:12px;opacity:.95;text-align:left}

    .paperBody{padding:14px 13px}
    .pillNote{
      display:inline-flex;align-items:center;gap:6px;
      background:#ecfeff;color:#0f766e;border-radius:999px;
      border:1px solid #a7f3d0;padding:4px 10px;
      font-size:12px;font-weight:900;margin-bottom:10px;
    }
    .infoGrid{
      display:grid;gap:6px 12px;
      grid-template-columns:1fr 1fr;
      font-size:14px;margin-bottom:10px;
    }
    @media(max-width:520px){.infoGrid{grid-template-columns:1fr}}
    .k{color:var(--muted);font-weight:900}
    .v{color:#111827;font-weight:900}
    .hr{height:1px;background:var(--line);margin:8px 0}

    table{width:100%;border-collapse:collapse;font-size:13px;margin-top:7px}
    th,td{border:1px solid var(--line);padding:6px 5px;text-align:center}
    th{background:#eff6ff;font-weight:900;color:#111827}

    .sectionBox{
      border-radius:16px;padding:10px 10px;
      border:1px solid var(--line);
      background:#fff;
      box-shadow:0 10px 20px rgba(2,6,23,.06);
      margin-top:10px;
    }
    .sectionTitle{
      display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap;
      font-weight:900;color:#111827;
    }
    .badge{
      display:inline-flex;align-items:center;gap:5px;
      border-radius:999px;padding:4px 9px;
      background:#f1f5f9;color:#0f172a;
      font-weight:900;font-size:11px;
    }

    .strongWarn{
      margin-top:9px;
      background:#fff7ed;border:1px solid #fed7aa;
      color:#9a3412;padding:8px 10px;border-radius:14px;
      font-size:12px;line-height:1.8;text-align:right;font-weight:900;
    }
    .disclaimer{font-size:11px;color:#9ca3af;line-height:1.7;text-align:right;margin-top:8px}

    .foot{
      padding:10px 13px;
      border-top:1px dashed var(--line);
      display:flex;align-items:flex-end;justify-content:space-between;gap:8px;flex-wrap:wrap;
      color:var(--muted);font-size:11px;
    }
    .qrBox{display:flex;flex-direction:column;align-items:center;gap:4px}
    .qrBox small{font-size:9px;color:#9ca3af;text-align:center}

    .listItem{
      text-align:right;background:#fff;border-radius:16px;
      padding:11px 11px;margin-bottom:9px;
      border:1px solid var(--line);box-shadow:0 10px 20px rgba(2,6,23,.10);
    }
    .listItem .line1{font-weight:900;color:#111827}
    .listItem .line2{font-size:12px;color:var(--muted);margin-top:3px}
    .listItem .line3{font-size:11px;color:#9ca3af;margin-top:2px}

    footer{padding:8px 12px 13px;font-size:11px;color:#94a3b8;text-align:center;}
  </style>
</head>
<body>
<div class="app">
  <header>
    <div class="top">
      <div class="brand">
        <img src="logo.png" alt="logo" onerror="this.style.display='none';">
        <div>
          <div class="name">Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø±</div>
          <div class="tag">Ø­Ù„ÙˆÙ„ ØªÙ…ÙˆÙŠÙ„ÙŠØ© Ø¨Ø¯ÙˆÙ† ØªØ¹Ù‚ÙŠØ¯Ø§Øª</div>
        </div>
      </div>
      <div class="dt">
        <div id="hdrDate">--/--/----</div>
        <div id="hdrTime">--:--:--</div>
      </div>
    </div>
  </header>

  <main>
    <!-- ØªØ±Ø­ÙŠØ¨ -->
    <section id="welcome" class="screen active">
      <div class="card">
        <div class="title">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</div>
        <p class="sub">
          Ù…ÙƒØªØ¨ Ø§Ù„Ù…ÙˆØ¸Ù â€” ØªØ­ÙˆÙŠÙ„ Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¥Ù„Ù‰ Ù…Ø·Ø¨ÙˆØ¹Ø§Øª Ø±Ø³Ù…ÙŠØ© ÙƒØµÙˆØ±Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ©ØŒ
          Ù…Ø¹ Ø³Ø¬Ù„ Ø¯Ø§Ø®Ù„ÙŠ Ù„Ù„Ù…Ø°ÙƒØ±Ø§Øª ÙˆØ§Ù„ÙˆØ«Ø§Ø¦Ù‚.
        </p>
        <div class="actions">
          <button class="btn primary" onclick="show('login')">Ø§Ø¨Ø¯Ø£</button>
        </div>
      </div>
    </section>

    <!-- Ø¯Ø®ÙˆÙ„ -->
    <section id="login" class="screen">
      <div class="card">
        <div class="title" style="font-size:22px">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù…ÙƒØªØ¨ Ø§Ù„Ù…ÙˆØ¸Ù</div>
        <p class="sub">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ù„Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…ØµØ±Ù‘Ø­ Ù„Ù‡ ÙÙ‚Ø·.</p>

        <div class="warn">
âš ï¸ ØªØ­Ø°ÙŠØ±: Ù‡Ø°Ø§ Ø§Ù„Ù†Ø¸Ø§Ù… Ø®Ø§Øµ Ø¨Ù…ÙƒØªØ¨ Ø§Ù„Ø´Ø±ÙƒØ©. Ø£ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¯Ø®ÙˆÙ„ Ù„ØºÙŠØ± Ø§Ù„Ù…ØµØ±Ø­ Ù„Ù‡Ù… ØªØ¹ØªØ¨Ø± Ù…Ø®Ø§Ù„ÙØ©.
        </div>

        <form onsubmit="login(event)">
          <div class="field">
            <label>Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ</label>
            <input id="pass" type="password" autocomplete="off" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
          </div>
          <div class="actions">
            <button type="submit" class="btn primary">Ø¯Ø®ÙˆÙ„</button>
            <button type="button" class="btn ghost" onclick="show('welcome')">Ø±Ø¬ÙˆØ¹</button>
          </div>
        </form>

        <div id="loginErr" class="warn" style="display:none;margin-top:10px">
          Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­. ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©.
        </div>
      </div>
    </section>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
    <section id="dash" class="screen">
      <div class="card">
        <div class="searchBar">
          <div class="right">
            <div style="font-weight:900;color:#111827;margin-bottom:4px">
              Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„ Ø¨Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„
            </div>
            <input id="dashSearchMobile" type="tel" placeholder="Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ø«Ù… Ø§Ø¶ØºØ· Ø¨Ø­Ø«">
            <div class="small" style="margin-top:5px">
              ÙŠØ¹Ø±Ø¶ Ø£Ø­Ø¯Ø« Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© ÙˆØªÙ‚Ø¯Ø± ØªÙØªØ­Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©.
            </div>
          </div>
          <div class="left">
            <button class="btn secondary" onclick="dashSearch()">Ø¨Ø­Ø«</button>
            <button class="btn ghost" onclick="openRecords()">Ø§Ù„Ø³Ø¬Ù„</button>
          </div>
        </div>

        <div class="grid">
          <div class="tile" onclick="openMemoCenter()">
            <div class="ico">ğŸ“</div>
            <div class="t">Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø°ÙƒØ±Ø§Øª</div>
            <div class="d">Ø§Ø­ÙØ¸ Ù…Ø°ÙƒØ±Ø§Øª Ø¯Ø§Ø®Ù„ÙŠØ© ÙˆØ§Ø¨Ø­Ø« Ø¨Ø£ÙŠ ÙƒÙ„Ù…Ø©ØŒ ÙˆØ§Ø·Ø¨Ø¹Ù‡Ø§ Ø¹Ù„Ù‰ Ù…Ø·Ø¨ÙˆØ¹Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©.</div>
          </div>

          <div class="tile" onclick="startClientFlow()">
            <div class="ico">ğŸ“Š</div>
            <div class="t">ÙˆØ«ÙŠÙ‚Ø© Ø¹Ù…ÙŠÙ„ (Ø¹Ø¯Ø© ØªÙ…ÙˆÙŠÙ„Ø§Øª)</div>
            <div class="d">Ø¥Ø¯Ø®Ø§Ù„ Ø£ÙƒØ«Ø± Ù…Ù† ØªÙ…ÙˆÙŠÙ„ ÙˆØ¨Ù†ÙˆÙƒ Ù„ÙƒÙ„ ØªÙ…ÙˆÙŠÙ„ØŒ Ù…Ø¹ Ù‚Ø³Ø· Ø«Ø§Ø¨Øª Ø£Ùˆ Ù…ØªØºÙŠÙ‘Ø±.</div>
          </div>

          <div class="tile" onclick="openRecords()">
            <div class="ico">ğŸ—‚ï¸</div>
            <div class="t">Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù„Ù„ÙˆØ«Ø§Ø¦Ù‚</div>
            <div class="d">Ø±Ø¬ÙˆØ¹ Ù„Ø£ÙŠ ÙˆØ«ÙŠÙ‚Ø© Ù…Ø­ÙÙˆØ¸Ø© Ø­Ø³Ø¨ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„.</div>
          </div>
        </div>

        <div id="dashQuickResults" style="margin-top:12px;text-align:right"></div>

        <div class="actions" style="margin-top:16px">
          <button class="btn ghost" onclick="show('welcome')">Ø®Ø±ÙˆØ¬</button>
        </div>
      </div>
    </section>

    <!-- Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø°ÙƒØ±Ø§Øª -->
    <section id="memoCenter" class="screen">
      <div class="card">
        <div class="title" style="font-size:22px">Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø°ÙƒØ±Ø§Øª</div>
        <p class="sub">Ø­ÙØ¸ Ù…Ø°ÙƒØ±Ø§Øª Ø¯Ø§Ø®Ù„ÙŠØ© ÙˆØ§Ù„Ø¨Ø­Ø« ÙÙŠÙ‡Ø§ ÙˆØ·Ø¨Ø§Ø¹Ø© Ù…Ø°ÙƒÙ‘Ø±Ø© Ø¹Ù„Ù‰ Ù…Ø·Ø¨ÙˆØ¹Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©.</p>

        <div class="searchBar">
          <div class="right">
            <div style="font-weight:900;color:#111827;margin-bottom:4px">Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø°ÙƒØ±Ø§Øª</div>
            <input id="memoSearch" type="text" placeholder="Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© (Ù…Ø«Ø§Ù„: Ù…Ø±Ù† / Ø±Ø§Ø¬Ø­ÙŠ / Ø³ÙƒÙ†ÙŠ)">
          </div>
          <div class="left">
            <button class="btn secondary" onclick="searchMemos()">Ø¨Ø­Ø«</button>
            <button class="btn primary" onclick="newMemo()">Ù…Ø°ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
            <button class="btn ghost" onclick="show('dash')">Ø±Ø¬ÙˆØ¹</button>
          </div>
        </div>

        <div id="memoList" style="margin-top:12px;text-align:right"></div>
      </div>
    </section>

    <!-- Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø°ÙƒØ±Ø© -->
    <section id="memoIn" class="screen">
      <div class="card">
        <div class="title" style="font-size:22px">Ù…Ø°ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</div>

        <div class="field">
          <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø°ÙƒØ±Ø©</label>
          <input id="memoTitle" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ù…ÙŠÙ„ / Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ù†Ùƒ">
        </div>

        <div class="field">
          <label>Ù†Øµ Ø§Ù„Ù…Ø°ÙƒØ±Ø©</label>
          <textarea id="memoText" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§â€¦"></textarea>
        </div>

        <div class="actions">
          <button class="btn primary" onclick="saveMemo()">Ø­ÙØ¸</button>
          <button class="btn secondary" onclick="memoPreview()">Ù…Ø¹Ø§ÙŠÙ†Ø© ÙƒÙ…Ø·Ø¨ÙˆØ¹Ø§Øª</button>
          <button class="btn ghost" onclick="show('memoCenter')">Ø±Ø¬ÙˆØ¹</button>
        </div>
      </div>
    </section>

    <!-- Ù…Ø¹Ø§ÙŠÙ†Ø© Ù…Ø°ÙƒØ±Ø© -->
    <section id="memoPrev" class="screen">
      <div class="card">
        <div class="title" style="font-size:22px">Ù…Ø°ÙƒØ±Ø© Ø¹Ù„Ù‰ Ù…Ø·Ø¨ÙˆØ¹Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©</div>

        <div class="paperWrap">
          <div id="paperMemo" class="paper"></div>
        </div>

        <div class="actions">
          <button class="btn primary" onclick="downloadPaperImage('paperMemo')">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©</button>
          <button class="btn secondary" onclick="sharePaperImage('paperMemo')">Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØµÙˆØ±Ø©</button>
          <button class="btn ghost" onclick="show('memoIn')">ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="btn ghost" onclick="show('memoCenter')">Ø±Ø¬ÙˆØ¹</button>
        </div>
      </div>
    </section>

    <!-- Ø¹Ù…ÙŠÙ„: Ø¨ÙŠØ§Ù†Ø§Øª -->
    <section id="c1" class="screen">
      <div class="card">
        <div class="title" style="font-size:22px">ÙˆØ«ÙŠÙ‚Ø© Ø¹Ù…ÙŠÙ„</div>
        <p class="sub">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆÙ…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©.</p>

        <div class="field">
          <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
          <input id="cName" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡">
        </div>

        <div class="field">
          <label>Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
          <input id="cMobile" type="tel" placeholder="05xxxxxxxx">
        </div>

        <div class="field">
          <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <textarea id="cEmpNotes" placeholder="Ø£ÙŠ Ù†Ù‚Ø§Ø· ØªØ­Ø¨ ØªØ¯ÙˆÙŠÙ†Ù‡Ø§â€¦"></textarea>
        </div>

        <div class="actions">
          <button class="btn primary" onclick="startNewSection()">Ø§Ù„ØªØ§Ù„ÙŠ: Ø£Ø¶Ù ØªÙ…ÙˆÙŠÙ„</button>
          <button class="btn ghost" onclick="show('dash')">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
      </div>
    </section>

    <!-- ØªÙ…ÙˆÙŠÙ„: Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ -->
    <section id="s1" class="screen">
      <div class="card">
        <div class="title" style="font-size:22px">Ø¥Ø¶Ø§ÙØ© ØªÙ…ÙˆÙŠÙ„ Ù„Ù„Ø¹Ù…ÙŠÙ„</div>
        <p class="sub">Ø­Ø¯Ø¯ Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ ÙˆÙ…Ø¹Ù„ÙˆÙ…Ø§ØªÙ‡ Ø§Ù„Ø¹Ø§Ù…Ø©.</p>

        <div class="field">
          <label>Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„</label>
          <input id="sType" type="text" placeholder="ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ / ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ / Ù…Ø±Ù† / Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©â€¦">
        </div>

        <div class="row2">
          <div class="field">
            <label>Ø§Ù„Ù†Ø³Ø¨Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <input id="sRate" type="text" placeholder="Ù…Ø«Ø§Ù„: 3.85%">
          </div>
          <div class="field">
            <label>Ø§Ù„Ø£Ø±Ø¨Ø§Ø­/Ø§Ù„Ø±Ø³ÙˆÙ… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <input id="sProfit" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø±Ø¨Ø­ 8,882 Ø±ÙŠØ§Ù„">
          </div>
        </div>

        <div class="field">
          <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­ÙˆÙ„ Ù‡Ø°Ø§ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <textarea id="sNotes" placeholder="Ø£ÙŠ ØªÙØ§ØµÙŠÙ„ Ù…Ù‡Ù…Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø£Ùˆ Ù„Ù„Ù…ÙˆØ¸Ùâ€¦"></textarea>
        </div>

        <div class="actions">
          <button class="btn primary" onclick="toSectionBanks()">Ø§Ù„ØªØ§Ù„ÙŠ: Ø§Ù„Ø¨Ù†ÙˆÙƒ</button>
          <button class="btn ghost" onclick="show('c1')">Ø±Ø¬ÙˆØ¹</button>
        </div>
      </div>
    </section>

    <!-- ØªÙ…ÙˆÙŠÙ„: Ø§Ù„Ø¨Ù†ÙˆÙƒ -->
    <section id="s2" class="screen">
      <div class="card">
        <div class="title" style="font-size:22px">Ø¨Ù†ÙˆÙƒ Ù‡Ø°Ø§ Ø§Ù„ØªÙ…ÙˆÙŠÙ„</div>
        <p class="sub">
          Ø£Ø¶Ù Ø¨Ù†ÙƒÙ‹Ø§ Ø£Ùˆ Ø£ÙƒØ«Ø±: Ù…Ø¨Ù„Øº Ø§Ù„ØªÙ…ÙˆÙŠÙ„ØŒ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø± (Ù¡â€“Ù£Ù©Ù©)ØŒ ÙˆÙ‡Ù„ Ø§Ù„Ù‚Ø³Ø· Ø«Ø§Ø¨Øª Ø£Ùˆ Ù…ØªØºÙŠÙ‘Ø±.
          Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØºÙŠÙ‘Ø± ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ (Ù‚Ø³Ø· + Ù…Ø¯Ø©) ÙˆÙŠØ¹ÙˆØ¯ Ù„Ùƒ Ø³Ø¤Ø§Ù„ â€œØ¨Ø§Ù‚ÙŠ Ù‚Ø³Ø·ØŸâ€.
        </p>

        <div id="banksWrap"></div>

        <div class="field" style="margin-top:10px">
          <label>Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ùƒ Ø¢Ø®Ø±ØŸ</label>
          <div class="inlineBtns">
            <button class="btn secondary" type="button" onclick="addBank()">Ù†Ø¹Ù…ØŒ Ø£Ø¶Ù Ø¨Ù†Ùƒ</button>
            <button class="btn primary" type="button" onclick="finishSection()">Ø¥Ù†Ù‡Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ…ÙˆÙŠÙ„</button>
          </div>
          <div class="hint">Ø³ÙŠØªÙ… ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¨Ù†ÙˆÙƒ Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ…ÙˆÙŠÙ„Ù‹Ø§ Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.</div>
        </div>

        <div class="actions">
          <button class="btn ghost" onclick="show('s1')">Ø±Ø¬ÙˆØ¹</button>
        </div>
      </div>
    </section>

    <!-- ØªÙ…ÙˆÙŠÙ„ Ø¢Ø®Ø±ØŸ -->
    <section id="s3" class="screen">
      <div class="card">
        <div class="title" style="font-size:22px">Ø¥Ø¶Ø§ÙØ© ØªÙ…ÙˆÙŠÙ„ Ø¢Ø®Ø±ØŸ</div>
        <p class="sub">Ù‡Ù„ Ù„Ù„Ø¹Ù…ÙŠÙ„ ØªÙ…ÙˆÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠ Ø¯Ø§Ø®Ù„ Ù†ÙØ³ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©ØŸ</p>

        <div class="actions">
          <button class="btn secondary" onclick="startAnotherSection()">Ù†Ø¹Ù…ØŒ Ø£Ø¶Ù ØªÙ…ÙˆÙŠÙ„</button>
          <button class="btn primary" onclick="buildFinalDocument()">Ù„Ø§ØŒ Ø§Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©</button>
        </div>

        <div class="actions">
          <button class="btn ghost" onclick="show('s2')">Ø±Ø¬ÙˆØ¹</button>
        </div>

        <div id="docErrBox" class="warn" style="display:none;margin-top:10px"></div>
      </div>
    </section>

    <!-- Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
    <section id="result" class="screen">
      <div class="card">
        <div class="title" style="font-size:22px">Ù…Ø·Ø¨ÙˆØ¹Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
        <p class="sub">ÙˆØ«ÙŠÙ‚Ø© Ù…ÙˆØ­Ø¯Ø© ØªØ´Ù…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„Ø§ØªØŒ ÙˆÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„Ù‡Ø§ Ø£Ùˆ Ù…Ø´Ø§Ø±ÙƒØªÙ‡Ø§ ÙƒØµÙˆØ±Ø© ÙˆØ§Ø¶Ø­Ø©.</p>

        <div class="ok">
          Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© ÙŠÙØªØ­ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø´Ø±ÙƒØ© Ù„Ù„Ø­ÙØ¸ ÙÙ‚Ø·ØŒ
          ÙˆÙ„Ø§ ÙŠØ¹ØªØ¨Ø± Ø­Ù…Ø§ÙŠØ© ÙƒØ§Ù…Ù„Ø© Ù„Ù„ÙˆØ«ÙŠÙ‚Ø©.
        </div>

        <div class="paperWrap">
          <div id="paperResult" class="paper"></div>
        </div>

        <div class="actions">
          <button class="btn primary" onclick="saveAndDownload()">Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„ + ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©</button>
          <button class="btn secondary" onclick="sharePaperImage('paperResult')">Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØµÙˆØ±Ø©</button>
          <button class="btn ghost" onclick="show('dash')">Ø±Ø¬ÙˆØ¹</button>
        </div>
      </div>
    </section>

    <!-- Ø§Ù„Ø³Ø¬Ù„ -->
    <section id="records" class="screen">
      <div class="card">
        <div class="title" style="font-size:22px">Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù„Ù„ÙˆØ«Ø§Ø¦Ù‚</div>
        <p class="sub">Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ø£Ùˆ Ø¹Ø±Ø¶ Ø¢Ø®Ø± Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø².</p>

        <div class="field">
          <label>Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
          <input id="recSearch" type="tel" placeholder="05xxxxxxxx">
        </div>

        <div class="actions">
          <button class="btn primary" onclick="doRecordsSearch()">Ø¨Ø­Ø«</button>
          <button class="btn secondary" onclick="renderRecords()">Ø¹Ø±Ø¶ Ø¢Ø®Ø± Ø§Ù„Ø³Ø¬Ù„</button>
          <button class="btn danger" onclick="clearRecords()">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ (Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²)</button>
          <button class="btn ghost" onclick="show('dash')">Ø±Ø¬ÙˆØ¹</button>
        </div>

        <div id="recordsList" style="margin-top:12px;text-align:right"></div>
      </div>
    </section>

  </main>

  <footer>
    Â© <span id="yr"></span> Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø© â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.
  </footer>
</div>

<script>
  const PASSWORD = "11qq11qQ@";
  const DOC_STORE_KEY  = "OFFICE_DOCS_SIMPLE_V1";
  const MEMO_STORE_KEY = "OFFICE_MEMOS_SIMPLE_V1";

  const SA_BANKS = [
    "Ù…ØµØ±Ù Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ",
    "Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ",
    "Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶",
    "Ø¨Ù†Ùƒ Ø§Ù„Ø¥Ù†Ù…Ø§Ø¡",
    "Ø¨Ù†Ùƒ Ø§Ù„Ø¨Ù„Ø§Ø¯",
    "Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„ÙˆØ·Ù†ÙŠ",
    "Ø¨Ù†Ùƒ Ø³Ø§Ø¨",
    "Ø¨Ù†Ùƒ Ø§Ù„Ø¬Ø²ÙŠØ±Ø©",
    "Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ Ù„Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±",
    "Ø¨Ù†Ùƒ Ø§Ù„Ø®Ù„ÙŠØ¬ Ø§Ù„Ø¯ÙˆÙ„ÙŠ",
    "Ø¨Ù†Ùƒ Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª Ø¯Ø¨ÙŠ Ø§Ù„ÙˆØ·Ù†ÙŠ",
    "Ø´Ø±ÙƒØ© ØªÙ…ÙˆÙŠÙ„ / Ø¬Ù‡Ø© Ø£Ø®Ø±Ù‰"
  ];

  let draft = { id:null, name:"", mobile:"", employeeNotes:"", createdAt:null, sections:[] };
  let currentSection = null;
  let bankIndex = 0;

  function show(id){
    document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
    const el = document.getElementById(id);
    if(el) el.classList.add("active");
    window.scrollTo({top:0,behavior:"smooth"});
  }

  function tick(){
    const now = new Date();
    document.getElementById("hdrDate").textContent =
      now.toLocaleDateString("ar-SA",{year:"numeric",month:"2-digit",day:"2-digit"});
    document.getElementById("hdrTime").textContent =
      now.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:false});
  }

  function fmtDateTime(d){
    const od = {year:"numeric",month:"2-digit",day:"2-digit"};
    const ot = {hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:false};
    return d.toLocaleDateString("ar-SA",od)+" - "+d.toLocaleTimeString("ar-SA",ot);
  }

  function escapeHtml(s){
    return (s||"").replace(/[&<>\"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[c]));
  }
  function formatNumber(n){
    if(n===null||n===undefined||n==="")return"";
    const x=Number(n);if(Number.isFinite(x))return x.toLocaleString("ar-SA");return String(n);
  }

  function login(e){
    e.preventDefault();
    const p=document.getElementById("pass").value;
    const err=document.getElementById("loginErr");
    if(p===PASSWORD){
      err.style.display="none";
      document.getElementById("pass").value="";
      show("dash");
    }else{
      err.style.display="block";
    }
  }

  /* ==== Ù…Ø°ÙƒØ±Ø§Øª ==== */
  function readMemos(){
    try{return JSON.parse(localStorage.getItem(MEMO_STORE_KEY)||"[]");}
    catch{return[];}
  }
  function writeMemos(a){localStorage.setItem(MEMO_STORE_KEY,JSON.stringify(a));}

  function openMemoCenter(){
    document.getElementById("memoSearch").value="";
    renderMemos(readMemos());
    show("memoCenter");
  }

  function newMemo(){
    document.getElementById("memoTitle").value="";
    document.getElementById("memoText").value="";
    show("memoIn");
  }

  function saveMemo(){
    const title=(document.getElementById("memoTitle").value||"").trim();
    const text =(document.getElementById("memoText").value||"").trim();
    if(!title && !text){alert("Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ù†Øµ Ù„Ù„Ù…Ø°ÙƒØ±Ø©");return;}
    const memos=readMemos();
    memos.unshift({id:String(Date.now()),title,text,createdAt:new Date().toISOString()});
    writeMemos(memos);
    alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø°ÙƒØ±Ø© âœ…");
    renderMemos(memos);
    show("memoCenter");
  }

  function searchMemos(){
    const q=(document.getElementById("memoSearch").value||"").trim().toLowerCase();
    const memos=readMemos();
    if(!q){renderMemos(memos);return;}
    const f=memos.filter(m=>(m.title||"").toLowerCase().includes(q)||(m.text||"").toLowerCase().includes(q));
    renderMemos(f);
  }

  function renderMemos(list){
    const box=document.getElementById("memoList");
    box.innerHTML="";
    if(!list||list.length===0){
      box.innerHTML=`<div class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø°ÙƒØ±Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©.</div>`;return;
    }
    list.slice(0,80).forEach(m=>{
      const div=document.createElement("div");
      div.className="listItem";
      div.innerHTML=`
        <div class="line1">${escapeHtml(m.title||"Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†")}</div>
        <div class="line2">${escapeHtml((m.text||"").slice(0,140))}${(m.text||"").length>140?"â€¦":""}</div>
        <div class="line3">ØªØ§Ø±ÙŠØ®: ${fmtDateTime(new Date(m.createdAt))}</div>
        <div class="actions" style="justify-content:flex-start">
          <button class="btn secondary" type="button">ÙØªØ­</button>
          <button class="btn secondary" type="button">Ù…Ø·Ø¨ÙˆØ¹Ø§Øª</button>
          <button class="btn danger"    type="button">Ø­Ø°Ù</button>
        </div>
      `;
      const [bOpen,bPrint,bDel]=div.querySelectorAll("button");
      bOpen.onclick=()=>{
        document.getElementById("memoTitle").value=m.title||"";
        document.getElementById("memoText").value=m.text||"";
        show("memoIn");
      };
      bPrint.onclick=()=>{
        document.getElementById("memoTitle").value=m.title||"";
        document.getElementById("memoText").value=m.text||"";
        memoPreview();
      };
      bDel.onclick=()=>{
        if(!confirm("ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø°ÙƒØ±Ø©ØŸ"))return;
        const memos=readMemos().filter(x=>x.id!==m.id);
        writeMemos(memos);renderMemos(memos);
      };
      box.appendChild(div);
    });
  }

  function buildMemoPaperHTML(title,text){
    const now=new Date();
    return `
      <div class="paperHeader">
        <div class="pBrand">
          <img src="logo.png" alt="logo" onerror="this.style.display='none';">
          <div>
            <div class="pName">Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø±</div>
            <div class="pTag">Ø­Ù„ÙˆÙ„ ØªÙ…ÙˆÙŠÙ„ÙŠØ© Ø¨Ø¯ÙˆÙ† ØªØ¹Ù‚ÙŠØ¯Ø§Øª</div>
          </div>
        </div>
        <div class="pMeta">${fmtDateTime(now)}</div>
      </div>
      <div class="paperBody">
        <div class="pillNote">ğŸ“ Ù…Ø°ÙƒØ±Ø© â€” Ù…ÙƒØªØ¨ Ø§Ù„Ù…ÙˆØ¸Ù</div>
        <div style="font-weight:900;color:#111827;margin-bottom:6px">${escapeHtml(title||"Ù…Ø°ÙƒØ±Ø©")}</div>
        <div style="white-space:pre-wrap;line-height:1.9;font-size:15px;color:#111827">
          ${escapeHtml(text||"")}
        </div>
        <div class="strongWarn">ØªÙ†Ø¨ÙŠÙ‡: Ù‡Ø°Ù‡ Ù…Ø°ÙƒØ±Ø© Ø¯Ø§Ø®Ù„ÙŠØ© Ù„Ù„Ø§Ø³ØªØ¦Ù†Ø§Ø³ ÙÙ‚Ø· ÙˆÙ„Ø§ ØªÙ…Ø«Ù„ Ø¹Ø±Ø¶Ù‹Ø§ ØªÙ…ÙˆÙŠÙ„ÙŠÙ‹Ø§.</div>
      </div>
      <div class="foot">
        <span>Ø¬ÙˆØ§Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„: 0506214458 Â· info@hlooleqrr.com</span>
        <div class="qrBox">
          <div id="memoQr"></div>
          <small>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ÙŠÙØªØ­ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø´Ø±ÙƒØ© Ù„Ù„Ø­ÙØ¸ ÙÙ‚Ø·</small>
        </div>
      </div>
    `;
  }

  function memoPreview(){
    const title=(document.getElementById("memoTitle").value||"").trim();
    const text =(document.getElementById("memoText").value||"").trim();
    if(!title && !text){alert("Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ù†Øµ Ù„Ù„Ù…Ø°ÙƒØ±Ø©");return;}
    const box=document.getElementById("paperMemo");
    box.innerHTML=buildMemoPaperHTML(title,text);
    makeQr("memoQr",location.origin+location.pathname);
    show("memoPrev");
  }

  /* ==== ØªØ¯ÙÙ‚ Ø§Ù„Ø¹Ù…ÙŠÙ„ ==== */
  function startClientFlow(){
    draft={id:null,name:"",mobile:"",employeeNotes:"",createdAt:null,sections:[]};
    currentSection=null;bankIndex=0;
    document.getElementById("cName").value="";
    document.getElementById("cMobile").value="";
    document.getElementById("cEmpNotes").value="";
    document.getElementById("sType").value="";
    document.getElementById("sRate").value="";
    document.getElementById("sProfit").value="";
    document.getElementById("sNotes").value="";
    document.getElementById("banksWrap").innerHTML="";
    show("c1");
  }

  function startNewSection(){
    const name=(document.getElementById("cName").value||"").trim();
    const mob =(document.getElementById("cMobile").value||"").trim();
    if(!name || !mob){alert("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ±Ù‚Ù… Ø¬ÙˆØ§Ù„Ù‡");return;}
    draft.name=name;draft.mobile=mob;
    draft.employeeNotes=(document.getElementById("cEmpNotes").value||"").trim();
    currentSection={type:"",rate:"",profit:"",notes:"",banks:[]};
    document.getElementById("sType").value="";
    document.getElementById("sRate").value="";
    document.getElementById("sProfit").value="";
    document.getElementById("sNotes").value="";
    document.getElementById("banksWrap").innerHTML="";
    bankIndex=0;
    show("s1");
  }

  function startAnotherSection(){
    currentSection={type:"",rate:"",profit:"",notes:"",banks:[]};
    document.getElementById("sType").value="";
    document.getElementById("sRate").value="";
    document.getElementById("sProfit").value="";
    document.getElementById("sNotes").value="";
    document.getElementById("banksWrap").innerHTML="";
    bankIndex=0;
    show("s1");
  }

  function toSectionBanks(){
    const t=(document.getElementById("sType").value||"").trim();
    if(!t){alert("Ø£Ø¯Ø®Ù„ Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„");return;}
    currentSection.type=t;
    currentSection.rate  =(document.getElementById("sRate").value||"").trim();
    currentSection.profit=(document.getElementById("sProfit").value||"").trim();
    currentSection.notes =(document.getElementById("sNotes").value||"").trim();
    document.getElementById("banksWrap").innerHTML="";
    bankIndex=0;
    addBank();
    show("s2");
  }

  function addBank(){
    bankIndex++;
    const idx=bankIndex;
    const wrap=document.getElementById("banksWrap");
    const div=document.createElement("div");
    div.className="bankCard";div.dataset.idx=idx;
    div.innerHTML=`
      <div class="bankTop">
        <div class="chip">Ø¨Ù†Ùƒ Ø±Ù‚Ù… ${idx}</div>
        <button class="btn ghost" type="button" style="padding:5px 9px;font-size:12px" onclick="removeBank(${idx})">Ø­Ø°Ù</button>
      </div>
      <div class="field">
        <label>Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù†Ùƒ</label>
        <select id="bank_${idx}">
          <option value="">Ø§Ø®ØªØ±...</option>
          ${SA_BANKS.map(b=>`<option value="${b}">${b}</option>`).join("")}
        </select>
      </div>
      <div class="row2">
        <div class="field">
          <label>Ù…Ø¨Ù„Øº Ø§Ù„ØªÙ…ÙˆÙŠÙ„ (Ø±ÙŠØ§Ù„)</label>
          <input id="amount_${idx}" type="number" min="0" step="1" placeholder="Ù…Ø«Ø§Ù„: 80000">
        </div>
        <div class="field">
          <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø± (1â€“399)</label>
          <input id="months_${idx}" type="number" min="1" max="399" step="1" placeholder="Ù…Ø«Ø§Ù„: 58">
        </div>
      </div>
      <div class="row2">
        <div class="field">
          <label>Ø§Ù„Ù†Ø³Ø¨Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input id="rate_${idx}" type="text" placeholder="Ù…Ø«Ø§Ù„: 3.85%">
        </div>
        <div class="field">
          <label>Ø§Ù„Ø£Ø±Ø¨Ø§Ø­/Ø§Ù„Ø±Ø³ÙˆÙ… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input id="profit_${idx}" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø±Ø¨Ø­ 8,882 Ø±ÙŠØ§Ù„">
        </div>
      </div>
      <div class="field">
        <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¨Ù†Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input id="bnotes_${idx}" type="text" placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø© ØªØ®Øµ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù†Ùƒâ€¦">
      </div>
      <div class="field">
        <label>Ù‡Ù„ Ø§Ù„Ù‚Ø³Ø· Ù…ØªØºÙŠÙ‘Ø±ØŸ</label>
        <select id="mode_${idx}" onchange="toggleMode(${idx})">
          <option value="fixed">Ù„Ø§ØŒ Ø§Ù„Ù‚Ø³Ø· Ø«Ø§Ø¨Øª</option>
          <option value="variable">Ù†Ø¹Ù…ØŒ Ø§Ù„Ù‚Ø³Ø· Ù…ØªØºÙŠÙ‘Ø±</option>
        </select>
      </div>
      <div id="fixedWrap_${idx}" class="field">
        <label>Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„Ø«Ø§Ø¨Øª (Ø±ÙŠØ§Ù„)</label>
        <input id="fixedInst_${idx}" type="number" min="0" step="1" placeholder="Ù…Ø«Ø§Ù„: 1618">
      </div>
      <div id="varWrap_${idx}" class="field" style="display:none">
        <label>Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…ØªØºÙŠÙ‘Ø±Ø© (Ù‚Ø³Ø· + Ù…Ø¯Ø©)</label>
        <div id="varList_${idx}" style="display:flex;flex-direction:column;gap:7px"></div>
        <div class="inlineBtns" style="margin-top:7px">
          <button class="btn secondary" type="button" onclick="addVarRow(${idx},true)">Ø¨Ø§Ù‚ÙŠ Ù‚Ø³Ø·ØŸ Ù†Ø¹Ù… (Ø£Ø¶Ù)</button>
          <button class="btn primary" type="button" onclick="doneVar(${idx})">Ø¨Ø§Ù‚ÙŠ Ù‚Ø³Ø·ØŸ Ù„Ø§ (Ø¥Ù†Ù‡Ø§Ø¡)</button>
        </div>
      </div>
    `;
    wrap.appendChild(div);
    addVarRow(idx,false);
  }

  function removeBank(idx){
    const el=document.querySelector('.bankCard[data-idx="'+idx+'"]');
    if(el)el.remove();
  }
  function toggleMode(idx){
    const m=document.getElementById("mode_"+idx).value;
    document.getElementById("fixedWrap_"+idx).style.display=(m==="fixed")?"block":"none";
    document.getElementById("varWrap_"+idx).style.display =(m==="variable")?"block":"none";
  }

  function addVarRow(idx,focus){
    const list=document.getElementById("varList_"+idx);
    if(!list)return;
    const count=list.children.length+1;
    const row=document.createElement("div");
    row.style.display="grid";
    row.style.gridTemplateColumns="1fr 1fr auto";
    row.style.gap="6px";
    row.style.alignItems="center";
    row.innerHTML=`
      <input id="vInst_${idx}_${count}" type="number" min="0" step="1" placeholder="Ø§Ù„Ù‚Ø³Ø· (Ø±ÙŠØ§Ù„)">
      <input id="vMon_${idx}_${count}" type="number" min="1" max="399" step="1" placeholder="Ø§Ù„Ù…Ø¯Ø© (Ø´Ù‡Ø±)">
      <button class="btn ghost" type="button" style="padding:6px 8px;font-size:12px" onclick="this.parentElement.remove()">Ø­Ø°Ù</button>
    `;
    list.appendChild(row);
    if(focus){
      setTimeout(()=>{
        const i=document.getElementById("vInst_"+idx+"_"+count);
        if(i)i.focus();
      },60);
    }
  }

  function doneVar(idx){
    const list=document.getElementById("varList_"+idx);
    if(!list||list.children.length===0){alert("Ø£Ø¶Ù Ù‚Ø³Ø· + Ù…Ø¯Ø© Ø£ÙˆÙ„Ø§Ù‹");return;}
    alert("ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…ØªØºÙŠÙ‘Ø±Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù†Ùƒ âœ…");
  }

  function finishSection(){
    const cards=Array.from(document.querySelectorAll(".bankCard"));
    const banks=[];
    for(const card of cards){
      const idx=card.dataset.idx;
      const bankName=(document.getElementById("bank_"+idx)?.value||"").trim();
      const amount=parseFloat(document.getElementById("amount_"+idx)?.value||"0");
      const months=parseInt(document.getElementById("months_"+idx)?.value||"0",10);
      const rate=(document.getElementById("rate_"+idx)?.value||"").trim();
      const profit=(document.getElementById("profit_"+idx)?.value||"").trim();
      const notes=(document.getElementById("bnotes_"+idx)?.value||"").trim();
      const mode=document.getElementById("mode_"+idx)?.value||"fixed";
      if(!bankName || !amount || !months)continue;
      if(months<1 || months>399)continue;

      if(mode==="fixed"){
        const fixedInst=parseFloat(document.getElementById("fixedInst_"+idx)?.value||"0");
        if(!fixedInst)continue;
        banks.push({bankName,amount,months,mode:"fixed",fixedInst,schedule:[],rate,profit,notes});
      }else{
        const list=document.getElementById("varList_"+idx);
        const schedule=[];
        if(list){
          const rows=Array.from(list.children);
          rows.forEach((r,k0)=>{
            const k=k0+1;
            const inst=parseFloat(document.getElementById("vInst_"+idx+"_"+k)?.value||"0");
            const m=parseInt(document.getElementById("vMon_"+idx+"_"+k)?.value||"0",10);
            if(inst && m)schedule.push({inst,months:m});
          });
        }
        if(schedule.length===0)continue;
        banks.push({bankName,amount,months,mode:"variable",fixedInst:null,schedule,rate,profit,notes});
      }
    }
    if(banks.length===0){
      alert("Ø£Ø¯Ø®Ù„ Ø¨Ù†Ùƒ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù…ÙƒØªÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.");return;
    }
    banks.sort((a,b)=>b.amount-a.amount);
    currentSection.banks=banks;
    draft.sections.push(currentSection);
    show("s3");
  }

  function buildPaperHTML(d){
    const meta=fmtDateTime(new Date(d.createdAt));
    const sectionsHtml=d.sections.map((s,si)=>{
      const rows=(s.banks||[]).map((b,i)=>{
        const instTxt=(b.mode==="fixed")?formatNumber(b.fixedInst):"Ù…ØªØºÙŠÙ‘Ø±";
        const rateTxt=escapeHtml(b.rate || s.rate || "");
        const profitTxt=escapeHtml(b.profit || s.profit || "");
        return `
          <tr>
            <td>${i+1}</td>
            <td>${escapeHtml(b.bankName)}</td>
            <td>${formatNumber(b.amount)}</td>
            <td>${b.months}</td>
            <td>${instTxt}</td>
            <td>${rateTxt}</td>
            <td>${profitTxt}</td>
          </tr>
        `;
      }).join("");

      let varDetails="";
      (s.banks||[]).forEach(b=>{
        if(b.mode==="variable"){
          varDetails+=`<div style="margin-top:6px"><b>${escapeHtml(b.bankName)}:</b></div>`;
          b.schedule.forEach(x=>{
            varDetails+=`<div style="line-height:1.7">- Ù‚Ø³Ø· ${formatNumber(x.inst)} Ø±ÙŠØ§Ù„ Ù„Ù…Ø¯Ø© ${x.months} Ø´Ù‡Ø±</div>`;
          });
        }
      });

      const secNotes=(s.notes||"").trim()
        ? `<div class="hr"></div><div style="font-weight:900;color:#111827">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØªÙ…ÙˆÙŠÙ„:</div>
           <div style="margin-top:5px;white-space:pre-wrap;line-height:1.8;color:#111827">
            ${escapeHtml(s.notes)}
           </div>`
        : "";

      let bankNotes="";
      (s.banks||[]).forEach(b=>{
        if((b.notes||"").trim()){
          bankNotes+=`<div style="margin-top:4px;line-height:1.7">- <b>${escapeHtml(b.bankName)}:</b> ${escapeHtml(b.notes)}</div>`;
        }
      });
      if(bankNotes){
        bankNotes=`<div class="hr"></div><div style="font-weight:900;color:#111827">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ù†ÙˆÙƒ:</div>
                   <div style="font-size:13px;color:#111827">${bankNotes}</div>`;
      }

      return `
        <div class="sectionBox">
          <div class="sectionTitle">
            <div>ØªÙ…ÙˆÙŠÙ„ ${si+1}: ${escapeHtml(s.type)}</div>
            <span class="badge">Ø§Ù„Ø¨Ù†ÙˆÙƒ Ù…Ø±ØªØ¨Ø© Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ…ÙˆÙŠÙ„Ù‹Ø§ Ù„Ù„Ø£Ù‚Ù„</span>
          </div>
          <div class="infoGrid" style="margin-top:6px">
            <div class="k">Ø§Ù„Ù†Ø³Ø¨Ø©:</div><div class="v">${escapeHtml(s.rate||"â€”")}</div>
            <div class="k">Ø§Ù„Ø£Ø±Ø¨Ø§Ø­/Ø§Ù„Ø±Ø³ÙˆÙ…:</div><div class="v">${escapeHtml(s.profit||"â€”")}</div>
          </div>
          <div style="font-weight:900;color:#111827;margin-top:4px">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ù†ÙˆÙƒ:</div>
          <table>
            <thead>
              <tr>
                <th>Ù…</th>
                <th>Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ</th>
                <th>Ù…Ø¨Ù„Øº Ø§Ù„ØªÙ…ÙˆÙŠÙ„ (Ø±ÙŠØ§Ù„)</th>
                <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø±</th>
                <th>Ø§Ù„Ù‚Ø³Ø·</th>
                <th>Ø§Ù„Ù†Ø³Ø¨Ø©</th>
                <th>Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</th>
              </tr>
            </thead>
            <tbody>${rows}</tbody>
          </table>
          ${varDetails?`<div class="hr"></div>
            <div style="font-weight:900;color:#111827">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ù…ØªØºÙŠÙ‘Ø±:</div>
            <div style="font-size:13px;margin-top:5px">${varDetails}</div>`:""}
          ${secNotes}${bankNotes}
        </div>
      `;
    }).join("");

    const empNotes=(d.employeeNotes||"").trim()
      ? `<div class="sectionBox" style="margin-top:10px">
           <div class="sectionTitle"><div>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù</div><span class="badge">Ø§Ø®ØªÙŠØ§Ø±ÙŠ</span></div>
           <div style="margin-top:6px;white-space:pre-wrap;line-height:1.8;color:#111827">
             ${escapeHtml(d.employeeNotes)}
           </div>
         </div>`
      : "";

    return `
      <div class="paperHeader">
        <div class="pBrand">
          <img src="logo.png" alt="logo" onerror="this.style.display='none';">
          <div>
            <div class="pName">Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø±</div>
            <div class="pTag">Ø­Ù„ÙˆÙ„ ØªÙ…ÙˆÙŠÙ„ÙŠØ© Ø¨Ø¯ÙˆÙ† ØªØ¹Ù‚ÙŠØ¯Ø§Øª</div>
          </div>
        </div>
        <div class="pMeta">${meta}</div>
      </div>
      <div class="paperBody">
        <div class="pillNote">ğŸ“„ Ù…Ø·Ø¨ÙˆØ¹Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
        <div class="infoGrid">
          <div class="k">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</div><div class="v">${escapeHtml(d.name)}</div>
          <div class="k">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„:</div><div class="v">${escapeHtml(d.mobile)}</div>
          <div class="k">Ø±Ù‚Ù… Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©:</div><div class="v">${escapeHtml(d.id)}</div>
          <div class="k">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±:</div><div class="v">${fmtDateTime(new Date(d.createdAt))}</div>
        </div>
        ${sectionsHtml}
        ${empNotes}
        <div class="strongWarn">
          Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø³Ø¨Ø© Ù…Ø¨Ø¯Ø¦ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆÙ‚Ø¯ ØªØªØºÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.
          Ù†Ø­Ù† Ù„Ø³Ù†Ø§ Ø¬Ù‡Ø© ØªÙ…ÙˆÙŠÙ„ÙŠØ©ØŒ ÙˆÙ„Ø§ ÙŠØ¹ØªØ¨Ø± Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø¹Ø±Ø¶Ù‹Ø§ ØªÙ…ÙˆÙŠÙ„ÙŠÙ‹Ø§ Ù…Ù„Ø²Ù…Ù‹Ø§.
        </div>
        <div class="disclaimer">
          Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø© ÙŠÙØªØ­ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø´Ø±ÙƒØ© ÙÙ‚Ø· Ù„Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ø±Ø¬ÙˆØ¹ØŒ ÙˆÙ„Ø§ ÙŠÙ…Ø«Ù„ Ø­Ù…Ø§ÙŠØ© ÙƒØ§Ù…Ù„Ø© Ù„Ù„ÙˆØ«ÙŠÙ‚Ø©.
        </div>
      </div>
      <div class="foot">
        <span>ØµØ§Ø¯Ø± Ù…Ù† Ù…ÙƒØªØ¨ Ø§Ù„Ù…ÙˆØ¸Ù â€” Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø±</span>
        <div class="qrBox">
          <div id="docQr"></div>
          <small>Ø§Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù„ÙØªØ­ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø´Ø±ÙƒØ©</small>
        </div>
      </div>
    `;
  }

  function buildFinalDocument(){
    const err=document.getElementById("docErrBox");
    err.style.display="none";err.textContent="";
    try{
      if(draft.sections.length===0){alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙ…ÙˆÙŠÙ„ Ù…Ø¶Ø§Ù Ù„Ù„ÙˆØ«ÙŠÙ‚Ø©.");return;}
      draft.createdAt=new Date().toISOString();
      draft.id=String(Date.now());
      const box=document.getElementById("paperResult");
      box.innerHTML=buildPaperHTML(draft);
      makeQr("docQr",location.origin+location.pathname);
      show("result");
    }catch(e){
      console.error(e);
      err.style.display="block";
      err.textContent="ØµØ§Ø± Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©. Ø¬Ø±Ù‘Ø¨ ØªÙ‚ÙÙ„ Ø§Ù„ØµÙØ­Ø© ÙˆØªÙØªØ­Ù‡Ø§ Ù…Ù† Ø¬Ø¯ÙŠØ¯.";
    }
  }

  /* ==== Ø§Ù„Ø³Ø¬Ù„ ==== */
  function readDocs(){try{return JSON.parse(localStorage.getItem(DOC_STORE_KEY)||"[]");}catch{return[];}}
  function writeDocs(a){localStorage.setItem(DOC_STORE_KEY,JSON.stringify(a));}

  async function saveAndDownload(){
    const rec={...draft};
    const docs=readDocs().filter(x=>x.id!==rec.id);
    docs.unshift(rec);writeDocs(docs);
    await downloadPaperImage("paperResult");
  }

  function openRecords(){
    document.getElementById("recSearch").value="";
    renderRecords();
    show("records");
  }

  async function renderRecords(list){
    const docs=list||readDocs();
    const box=document.getElementById("recordsList");
    box.innerHTML="";
    if(!docs||docs.length===0){
      box.innerHTML=`<div class="small">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØ«Ø§Ø¦Ù‚ Ù…Ø­ÙÙˆØ¸Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø².</div>`;return;
    }
    docs.slice(0,40).forEach(d=>{
      const div=document.createElement("div");
      div.className="listItem";
      div.innerHTML=`
        <div class="line1">${escapeHtml(d.name)} â€” ${escapeHtml(d.mobile)}</div>
        <div class="line2">Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ…ÙˆÙŠÙ„Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©: ${(d.sections||[]).length}</div>
        <div class="line3">ØªØ§Ø±ÙŠØ®: ${fmtDateTime(new Date(d.createdAt))}</div>
        <div class="actions" style="justify-content:flex-start">
          <button class="btn secondary" type="button">ÙØªØ­</button>
        </div>
      `;
      div.querySelector("button").onclick=()=>{
        draft={...d};
        document.getElementById("paperResult").innerHTML=buildPaperHTML(draft);
        makeQr("docQr",location.origin+location.pathname);
        show("result");
      };
      box.appendChild(div);
    });
  }

  function doRecordsSearch(){
    const q=(document.getElementById("recSearch").value||"").trim();
    const docs=readDocs();
    const f=q?docs.filter(d=>(d.mobile||"").includes(q)):docs;
    renderRecords(f);
  }

  function clearRecords(){
    if(!confirm("ØªØ£ÙƒÙŠØ¯ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ (Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² ÙÙ‚Ø·)ØŸ"))return;
    localStorage.removeItem(DOC_STORE_KEY);
    renderRecords([]);
  }

  /* ==== Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ==== */
  async function dashSearch(){
    const q=(document.getElementById("dashSearchMobile").value||"").trim();
    const docs=readDocs();
    const box=document.getElementById("dashQuickResults");
    box.innerHTML="";
    if(!q){box.innerHTML=`<div class="small">Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ø«Ù… Ø§Ø¶ØºØ· Ø¨Ø­Ø«.</div>`;return;}
    const matches=docs.filter(d=>(d.mobile||"").includes(q));
    if(matches.length===0){
      box.innerHTML=`<div class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©.</div>`;return;
    }
    matches.slice(0,6).forEach(d=>{
      const div=document.createElement("div");
      div.className="listItem";
      div.innerHTML=`
        <div class="line1">${escapeHtml(d.name)} â€” ${escapeHtml(d.mobile)}</div>
        <div class="line2">Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ…ÙˆÙŠÙ„Ø§Øª: ${(d.sections||[]).length}</div>
        <div class="line3">ØªØ§Ø±ÙŠØ®: ${fmtDateTime(new Date(d.createdAt))}</div>
        <div class="actions" style="justify-content:flex-start">
          <button class="btn secondary" type="button">ÙØªØ­</button>
        </div>
      `;
      div.querySelector("button").onclick=()=>{
        draft={...d};
        document.getElementById("paperResult").innerHTML=buildPaperHTML(draft);
        makeQr("docQr",location.origin+location.pathname);
        show("result");
      };
      box.appendChild(div);
    });
  }

  /* ==== QR + ØµÙˆØ±Ø© ==== */
  function makeQr(containerId,text){
    const el=document.getElementById(containerId);
    if(!el)return;
    el.innerHTML="";
    if(!window.QRCode){el.textContent="QR";return;}
    QRCode.toDataURL(text,{width:180,margin:1},(err,url)=>{
      if(err){console.error(err);el.textContent="QR";return;}
      const img=new Image();img.src=url;img.alt="QR";
      img.style.width="90px";img.style.height="90px";
      img.style.borderRadius="14px";
      img.style.border="1px solid #e5e7eb";
      img.style.background="#fff";
      img.style.padding="6px";
      el.appendChild(img);
    });
  }

  async function waitFontsReady(){
    if(document.fonts && document.fonts.ready)await document.fonts.ready;
    await new Promise(r=>setTimeout(r,180));
  }
  async function waitImagesReady(root){
    const imgs=Array.from(root.querySelectorAll("img"));
    await Promise.all(imgs.map(img=>new Promise(res=>{
      if(img.complete && img.naturalWidth>0)return res();
      const done=()=>res();
      img.addEventListener("load",done,{once:true});
      img.addEventListener("error",done,{once:true});
      setTimeout(done,1200);
    })));
  }

  async function makeBlobFromNode(elementId){
    await waitFontsReady();
    const node=document.getElementById(elementId);
    if(!node)throw new Error("Ø¹Ù†ØµØ± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
    await waitImagesReady(node);
    const dpr=window.devicePixelRatio||2;
    const scale=Math.min(4,Math.max(2.5,dpr*1.3));
    const canvas=await html2canvas(node,{backgroundColor:"#ffffff",scale,useCORS:true,allowTaint:true,logging:false});
    return await new Promise(res=>canvas.toBlob(b=>res(b),"image/png",1));
  }

  async function downloadPaperImage(elementId){
    try{
      const blob=await makeBlobFromNode(elementId);
      if(!blob)throw new Error("ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ±Ø©");
      const url=URL.createObjectURL(blob);
      const a=document.createElement("a");
      a.href=url;a.download="document.png";a.click();
      setTimeout(()=>URL.revokeObjectURL(url),1500);
    }catch(e){
      console.error(e);
      alert("ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©. ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø«Ù… Ø¬Ø±Ù‘Ø¨ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©.");
    }
  }

  async function sharePaperImage(elementId){
    try{
      const blob=await makeBlobFromNode(elementId);
      if(!blob)throw new Error("ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ±Ø©");
      const file=new File([blob],"document.png",{type:"image/png"});
      if(navigator.canShare && navigator.canShare({files:[file]})){
        await navigator.share({files:[file],title:"Ù…Ø·Ø¨ÙˆØ¹Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„"});
      }else{
        await downloadPaperImage(elementId);
      }
    }catch(e){
      console.error(e);
      await downloadPaperImage(elementId);
    }
  }

  document.addEventListener("DOMContentLoaded",()=>{
    document.getElementById("yr").textContent=new Date().getFullYear();
    tick();setInterval(tick,1000);
  });
</script>
</body>
</html>