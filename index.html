<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù…Ù†ØµØ© FINO -ØªØ±Ø´ÙŠØ­ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠFINO â€” Smart Finance Match </title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    
    /* Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
    body {
      font-family: 'Tajawal', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(-45deg, #0f172a, #1e3a8a, #1e40af, #3b82f6);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      margin: 0;
      text-align: center;
      font-size: 20px;
      direction: rtl;
      color: #111827;
      min-height: 100vh;
    }
    
    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    /* Ø§Ù„Ø¬Ø²ÙŠØ¦Ø§Øª Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
    #particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }
    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: rgba(255,255,255,0.3);
      border-radius: 50%;
      animation: float 20s infinite;
    }
    @keyframes float {
      0%, 100% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; }
    }
    
    /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
    #splashScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #0f172a, #1e3a8a);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }
    #splashScreen.hidden {
      opacity: 0;
      visibility: hidden;
      display: none;
    }
    .splash-logo {
      font-size: 60px;
      font-weight: 900;
      color: #fff;
      text-shadow: 0 0 30px rgba(59, 130, 246, 0.8);
      animation: pulse 2s ease-in-out infinite;
    }
    .splash-text {
      color: rgba(255,255,255,0.8);
      font-size: 18px;
      margin-top: 20px;
    }
    .splash-loader {
      width: 200px;
      height: 4px;
      background: rgba(255,255,255,0.2);
      border-radius: 4px;
      margin-top: 30px;
      overflow: hidden;
    }
    .splash-loader-bar {
      width: 0%;
      height: 100%;
      background: linear-gradient(90deg, #f59e0b, #fbbf24);
      border-radius: 4px;
      animation: loading 2s ease-in-out forwards;
    }
    @keyframes loading {
      0% { width: 0%; }
      100% { width: 100%; }
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    /* Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ‚Øª */
    .time-greeting {
      font-size: 16px;
      color: rgba(255,255,255,0.9);
      margin-bottom: 5px;
    }
    
    header {
      background: transparent;
      color: #fff;
      padding: 14px 10px;
      position: relative;
      z-index: 10;
    }
    header h1 {
      margin: 0;
      font-size: 28px;
      font-weight: 900;
      letter-spacing: 0.03em;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    header p {
      margin: 4px 0 0;
      font-size: 16px;
      opacity: 0.95;
    }
    .top-bar {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      max-width: 900px;
      margin: 0 auto;
    }

    .page-container {
      max-width: 900px;
      margin: 16px auto 32px;
      padding: 0 10px;
    }
    .card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: 24px;
      padding: 24px 20px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      margin-bottom: 14px;
      text-align: center;
      width: 100%;
      border: 1px solid rgba(255,255,255,0.3);
      position: relative;
      z-index: 1;
    }

    button, .btn {
      border-radius: 999px;
      border: none;
      padding: 14px 22px;
      font-size: 19px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: transform .12s ease, box-shadow .12s ease, background .12s ease, opacity .12s ease;
    }
    button.primary, .btn.primary {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      color: #ffffff;
      box-shadow: 0 8px 20px rgba(245, 158, 11, 0.4);
      font-weight: 700;
    }
    button.primary:hover, .btn.primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 28px rgba(245, 158, 11, 0.5);
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
    }
    button.secondary, .btn.secondary {
      background: #e0f2fe;
      color: #1d4ed8;
    }
    button.secondary:hover, .btn.secondary:hover {
      background: #dbeafe;
    }
    button.small, .btn.small {
      padding: 12px 20px;
      font-size: 18px;
    }

    input, select, textarea {
      width: 100%;
      padding: 11px 12px;
      margin: 8px 0 2px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      text-align: right;
      background: #f9fafb;
      color: #111827;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.35);
      background: #ffffff;
    }
    label {
      display: block;
      text-align: right;
      font-size: 17px;
      margin-top: 8px;
      margin-bottom: 2px;
      color: #374151;
    }

    .fade-in {
      animation: fadeInMove .3s ease-out forwards;
      opacity: 0;
      transform: translateY(10px);
    }
    @keyframes fadeInMove {
      to { opacity: 1; transform: translateY(0); }
    }

    .page { display: none; }
    .page.active { display: block; }

    .welcome-title {
      font-size: 23px;
      margin-bottom: 6px;
      color: #111827;
    }
    .welcome-sub {
      font-size: 15px;
      color: #6b7280;
      margin-bottom: 18px;
    }

    .steps-badge {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 6px;
      text-align: right;
    }

    .result-header {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 6px;
    }
    .client-chip {
      background: #e0f2fe;
      color: #1d4ed8;
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 14px;
      border: 1px solid #bfdbfe;
    }
    .badge-mode {
      background: #eff6ff;
      color: #1d4ed8;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 12px;
      display: inline-block;
    }
    .badge-duration {
      background: #e0f2fe;
      color: #1e3a8a;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 12px;
      display: inline-block;
      margin-top: 3px;
    }

    .bank-card {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px 18px;
      border-radius: 20px;
      background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
      border: 2px solid #93c5fd;
      margin: 12px 0 16px;
      text-align: right;
      box-shadow: 0 4px 16px rgba(59, 130, 246, 0.15);
    }
    .bank-logo {
      width: 56px;
      height: 56px;
      border-radius: 16px;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      flex-shrink: 0;
      border: 2px solid #bfdbfe;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .bank-logo img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }
    .bank-text-main {
      font-size: 18px;
      font-weight: 800;
      color: #1e40af;
      margin-bottom: 4px;
    }
    .bank-text-sub {
      font-size: 14px;
      color: #3b82f6;
      line-height: 1.6;
      font-weight: 500;
    }

    /* ====== ØªØ­Ø³ÙŠÙ† Ø´ÙƒÙ„ Ø§Ù„Ù†ØªÙŠØ¬Ø© - ØªØµÙ…ÙŠÙ… Ø¹ØµØ±ÙŠ ====== */
    .result-main-block {
      background: linear-gradient(135deg, #f0f9ff 0%, #ffffff 50%, #ecfeff 100%);
      border-radius: 24px;
      padding: 20px 18px;
      margin-top: 8px;
      text-align: right;
      border: 2px solid #bae6fd;
      box-shadow: 0 8px 32px rgba(14, 165, 233, 0.15);
    }
    .result-main-title {
      font-size: 18px;
      color: #0369a1;
      margin-bottom: 6px;
      display:flex;
      align-items:center;
      gap:10px;
      font-weight: 800;
      letter-spacing: 0.3px;
    }
    .result-amount-main {
      font-size: 42px;
      font-weight: 900;
      background: linear-gradient(135deg, #0369a1, #0ea5e9);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 8px 0 12px;
      letter-spacing: 0.5px;
      line-height: 1.1;
      text-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .result-amount-sub {
      font-size: 15px;
      color: #0284c7;
      margin: 4px 0;
      line-height: 1.7;
      font-weight: 500;
    }
    .result-amount-small {
      font-size: 14px;
      color: #334155;
      margin-top: 4px;
      line-height: 1.7;
      font-weight: 500;
    }
    
    /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø§Ù„Ø¹ØµØ±ÙŠØ© */
    .result-greeting-card {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-radius: 20px;
      padding: 16px 20px;
      margin-bottom: 16px;
      border: 2px solid #fcd34d;
      text-align: right;
    }
    .result-greeting-emoji {
      font-size: 32px;
      margin-bottom: 8px;
    }
    .result-greeting-text {
      font-size: 20px;
      font-weight: 800;
      color: #92400e;
      line-height: 1.6;
    }
    .result-greeting-sub {
      font-size: 15px;
      color: #b45309;
      margin-top: 6px;
      font-weight: 500;
    }
    
    /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ */
    .retirement-card {
      background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
      border-radius: 20px;
      padding: 16px 18px;
      margin: 12px 0;
      border: 2px solid #6ee7b7;
      text-align: right;
    }
    .retirement-title {
      font-size: 16px;
      font-weight: 800;
      color: #047857;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .retirement-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px dashed #a7f3d0;
      font-size: 14px;
      color: #065f46;
    }
    .retirement-row:last-child { border-bottom: none; }
    .retirement-value {
      font-weight: 800;
      color: #047857;
      font-size: 16px;
    }

    .support-panel {
      margin-top: 10px;
      border-radius: 16px;
      padding: 10px 12px;
      background: #f8fafc;
      border: 1px solid #e5e7eb;
    }
    .support-title {
      font-size: 13px;
      font-weight: 900;
      color: #0f766e;
      display:flex;
      align-items:center;
      gap:8px;
      margin-bottom: 6px;
    }
    .support-row {
      font-size: 13px;
      color: #0f172a;
      display:flex;
      justify-content: space-between;
      gap: 10px;
      padding: 4px 0;
      border-bottom: 1px dashed #e5e7eb;
    }
    .support-row:last-child{ border-bottom:none; }
    .support-badge {
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      background:#ecfeff;
      color:#155e75;
      border: 1px solid #a5f3fc;
      margin-top: 6px;
    }

    .dual-main-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(180px,1fr));
      gap: 8px;
      margin-top: 10px;
    }
    .dual-box {
      background: #eff6ff;
      border-radius: 14px;
      padding: 8px 10px;
      font-size: 13px;
      text-align: right;
      border: 1px solid #dbeafe;
    }
    .dual-box-title {
      font-size: 12px;
      color: #1d4ed8;
      margin-bottom: 2px;
      font-weight: 900;
    }
    .dual-box-amount {
      font-size: 18px;
      font-weight: 900;
      color: #1e3a8a;
    }

    .result-section-title {
      text-align: right;
      font-size: 18px;
      font-weight: 800;
      margin: 16px 0 10px;
      color: #0f172a;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .result-section-box {
      border-radius: 20px;
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border: 2px solid #e2e8f0;
      padding: 14px 16px;
      text-align: right;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }

    /* Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø¨Ø®Ø· Ø£ÙˆØ¶Ø­ */
    .instalment-row {
      font-size: 16px;
      padding: 10px 0;
      border-bottom: 1px dashed #cbd5e1;
      text-align: right;
      color: #1e293b;
      line-height: 1.7;
      font-weight: 600;
    }
    .instalment-row strong { font-weight: 800; color:#0369a1; font-size: 17px; }
    .instalment-row:last-child { border-bottom: none; }

    .alert-error {
      color: #b91c1c;
      background: #fef2f2;
      border-radius: 12px;
      padding: 8px 10px;
      font-size: 14px;
      margin: 6px 0;
      text-align: right;
      border: 1px solid #fecaca;
      line-height: 1.55;
    }

    .notice-soft {
      color:#9f1239;
      background:#fff1f2;
      border:1px solid #fecdd3;
      border-radius: 14px;
      padding: 10px 12px;
      font-size: 13px;
      text-align:right;
      line-height: 1.6;
      margin-top: 8px;
    }

    /* VAT small */
    .vat-small {
      font-size: 11px;
      color: #6b7280;
      font-weight: 600;
      margin-top: 2px;
    }

    .admin-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(180px,1fr));
      gap: 8px 12px;
      margin-top: 6px;
      text-align: right;
    }
    .admin-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    .admin-table th, .admin-table td {
      border: 1px solid #e5e7eb;
      padding: 5px 6px;
      font-size: 12px;
      text-align: center;
      vertical-align: top;
    }
    .admin-table th {
      background: #f3f4f6;
      color: #374151;
    }

    footer {
      font-size: 13px;
      color: rgba(255,255,255,0.8);
      margin-top: 10px;
      padding: 12px 12px;
      position: relative;
      background: transparent;
      border-top: none;
      z-index: 1;
    }

    .footer-inner {
      max-width: 900px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    #adminIcon {
      border-radius: 999px;
      background: #e5e7eb;
      padding: 6px 12px;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      color: #111827;
    }
    #adminIcon:hover { background: #d1d5db; }

    /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ ØªØ­Øª Ø§Ù„ÙÙˆØªØ± - Ù…Ø®ÙÙŠØ© */
    #miniAdminTools {
      display:inline-flex;
      align-items:center;
      gap:6px;
      cursor:pointer;
      padding: 4px 8px;
      border-radius: 10px;
      border: none;
      background: transparent;
      opacity: 0.15;
      transition: opacity 0.3s ease;
      color:#111827;
      font-size: 12px;
      user-select:none;
    }
    #miniAdminTools:hover { background:#f3f4f6; }

    /* Ø¨Ø·Ø§Ù‚Ø© Ù…Ø¹Ø§ÙŠÙ†Ø© Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ù„ØµÙˆØ±Ø© */
    .client-preview {
      background:#ffffff;
      border: 1px solid #e5e7eb;
      border-radius: 16px;
      padding: 12px 12px;
      text-align:right;
      line-height:1.7;
      font-size:14px;
      color:#111827;
    }
    .client-preview .h {
      font-weight: 900;
      color:#1e3a8a;
      font-size:16px;
      margin-bottom:6px;
    }
    .client-preview .k {
      color:#374151;
      font-weight: 800;
    }
    .client-preview .v {
      color:#0f172a;
      font-weight: 900;
    }
    .client-preview .hr {
      height:1px;background:#e5e7eb;margin:10px 0;
    }

    /* ====== (Ø¥Ø¶Ø§ÙØ©) Ø´Ø±ÙŠØ· ØµØºÙŠØ± Ù„Ù„Ù‡Ø¬Ø±ÙŠ ====== */
    .hijri-chip{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 3px 10px;
      border-radius: 999px;
      font-size: 11px;
      background:#eff6ff;
      color:#1d4ed8;
      border: 1px solid #dbeafe;
      margin-right:6px;
      font-weight:800;
      white-space:nowrap;
    }
  </style>
</head>
<body>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
<div id="splashScreen" class="hidden" style="display:none;">
  <div class="splash-logo">FINO</div>
  <div class="splash-text">Ù…Ù†ØµØ© ØªØ±Ø´ÙŠØ­ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ</div>
  <div class="splash-loader">
    <div class="splash-loader-bar"></div>
  </div>
</div>

<!-- Ø§Ù„Ø¬Ø²ÙŠØ¦Ø§Øª Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© -->
<div id="particles"></div>

<header>
  <div class="top-bar">
    <div style="text-align:right">
      <h1>Ù…Ù†ØµØ© FINO</h1>
      <p>Ù…Ù†ØµØ© Ø°ÙƒÙŠØ© ØªØ­Ø³Ø¨ Ù„Ùƒ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ ÙˆØªÙØ±Ø´Ù‘Ø­ Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù†Ø³Ø¨ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø±Ø§ØªØ¨Ùƒ ÙˆÙ†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ ÙˆØ§Ù„ØªØ²Ø§Ù…Ø§ØªÙƒ Ø®Ù„Ø§Ù„ Ø«ÙˆØ§Ù†ÙØŒ Ø¨Ø¯ÙˆÙ† Ø­ÙŠØ±Ø© ÙˆÙ„Ø§ ØªØ¹Ø¨</p>
    </div>
  </div>
</header>

<div class="page-container">

  <!-- ØµÙØ­Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ -->
  <div id="landingPage" class="page active">
    <div class="card fade-in">
      <div class="time-greeting" id="timeGreeting">ğŸŒ… ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±</div>
      <div class="welcome-title">Ù…Ù†ØµØ© FINO ğŸš€</div>
      <div class="welcome-sub">
        Ù…Ù† Ù‡Ù†Ø§ ØªÙ‚Ø¯Ø± ØªØ­Ø³Ø¨ ØªÙ…ÙˆÙŠÙ„Ùƒ ÙˆØªØ´ÙˆÙ Ø£ÙØ¶Ù„ Ø¨Ù†Ùƒ Ù…Ù†Ø§Ø³Ø¨ Ù„Ùƒ Ù…Ù† Ø­ÙŠØ« Ø§Ù„Ù†Ø³Ø¨Ø© Ø­Ø³Ø¨ Ø±Ø§ØªØ¨Ùƒ ÙˆÙ†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ ÙˆØ§Ù„ØªØ²Ø§Ù…Ø§ØªÙƒ.
      </div>
      <button class="primary" onclick="startClientFlow()" style="font-size:20px;">
        ğŸš€ Ø§Ø¨Ø¯Ø£ Ø¨Ø£Ø³Ù… Ø§Ù„Ù„Ù‡
      </button>
      <div style="margin-top:15px;">
        <button class="secondary small" onclick="showPage('earlySettlement')" id="earlySettlementBtn">
          ğŸ’° Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø³Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¨ÙƒØ±
        </button>
      </div>
      <div style="margin-top:12px; font-size:13px; color:#6b7280;">
        Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù…ØµÙ…Ù…Ø© Ø¨Ø­ÙŠØ« ØªÙ‚Ø¯Ø± ØªØµÙˆÙ‘Ø± Ø§Ù„Ø´Ø§Ø´Ø© Ø£Ùˆ ØªØ­ÙØ¸Ù‡Ø§ ÙƒØµÙˆØ±Ø© .
      </div>
      
      <!-- Ù‚Ø³Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
      <div id="homeRatings" style="margin-top:15px; display:none;"></div>
    </div>
  </div>

  <!-- ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ø³Ø¨Ø© -->
  <div id="calculatorPage" class="page">
    <div class="card">
      <div class="steps-badge">
        Ø£Ø³Ø¦Ù„Ø© Ø¨Ø³ÙŠØ·Ø© Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ© Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ø£Ø¯Ù‚ Ø­Ø³Ø¨Ø© Ù…Ù…ÙƒÙ†Ø© ğŸ‘Œ
      </div>
      <div id="question"></div>
      <div style="margin-top:14px; display:flex; justify-content:flex-end; gap:8px; flex-wrap:wrap;">
        <button id="nextButton" class="primary small" style="display:none;" onclick="nextQuestion()">Ø§Ù„ØªØ§Ù„ÙŠ</button>
        <button id="mainButton" class="primary small" onclick="handleStartOrReset()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø­Ø³Ø¨Ø©</button>
      </div>
      <div id="resetButtonContainer" style="margin-top:8px; display:none;">
        <button onclick="resetCalc()" style="background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;border:none;padding:6px 14px;font-size:11px;border-radius:16px;cursor:pointer;box-shadow:0 3px 10px rgba(99,102,241,0.25);transition:all 0.2s ease;opacity:0.85;" onmouseover="this.style.opacity='1';this.style.transform='translateY(-1px)'" onmouseout="this.style.opacity='0.85';this.style.transform='translateY(0)'">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø¨Ø©</button>
      </div>
    </div>
  </div>

  <!-- ØµÙØ­Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
  <div id="resultPage" class="page">
    <div class="card fade-in" id="resultCard">
      <!-- ØªØ¹Ø¨Ø¦Ø© Ù…Ù† Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª -->
    </div>

    <!-- (ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø²Ø± "Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„" Ù…Ù† Ù‡Ù†Ø§ Ø­Ø³Ø¨ Ø·Ù„Ø¨ÙƒØŒ ÙˆØµØ§Ø± â–«ï¸ ØªØ­Øª Ø§Ù„ÙÙˆØªØ±) -->

    <div style="margin-top:10px; display:flex; justify-content:space-between; gap:8px; flex-wrap:wrap;">
      <button class="secondary small" onclick="backToLanding()">ğŸ  Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
      <div style="display:flex; gap:8px; flex-wrap:wrap;">
        <button class="secondary small" onclick="saveResultAsImage()">ğŸ“¸ Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙƒØµÙˆØ±Ø©</button>
        <button class="secondary small" onclick="shareResultOnWhatsApp()">ğŸ“² Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§ØªØ³Ø§Ø¨</button>
        <button class="primary small" onclick="resetCalc(); showPage('calculator');">ğŸ” Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
      </div>
    </div>
  </div>

    <!-- Ù‚Ø³Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… -->
    <div id="ratingSection" class="card fade-in" style="margin-top:12px; display:none;">
      <h3 style="margin:0 0 8px; font-size:16px; color:#111827; text-align:right;">â­ Ù‚ÙŠÙ‘Ù… ØªØ¬Ø±Ø¨ØªÙƒ</h3>
      <p style="font-size:13px; color:#6b7280; text-align:right; margin-bottom:10px;">Ø±Ø£ÙŠÙƒ ÙŠÙ‡Ù…Ù†Ø§! ÙƒÙŠÙ ÙƒØ§Ù†Øª ØªØ¬Ø±Ø¨ØªÙƒ Ù…Ø¹ Ù…Ù†ØµØ© FINOØŸ</p>
      <div id="ratingStars" style="display:flex; justify-content:center; gap:8px; margin-bottom:10px;">
        <span class="rating-star" onclick="setRating(1)" style="font-size:28px; cursor:pointer;">â˜†</span>
        <span class="rating-star" onclick="setRating(2)" style="font-size:28px; cursor:pointer;">â˜†</span>
        <span class="rating-star" onclick="setRating(3)" style="font-size:28px; cursor:pointer;">â˜†</span>
        <span class="rating-star" onclick="setRating(4)" style="font-size:28px; cursor:pointer;">â˜†</span>
        <span class="rating-star" onclick="setRating(5)" style="font-size:28px; cursor:pointer;">â˜†</span>
      </div>
      <textarea id="ratingComment" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù‡Ù†Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)..." style="width:100%; height:60px; border-radius:10px; border:1px solid #d1d5db; padding:8px; font-size:14px; resize:none;"></textarea>
      <button onclick="submitRating()" style="margin-top:8px; background:linear-gradient(135deg,#10b981,#059669); color:#fff; border:none; padding:8px 20px; border-radius:20px; font-size:14px; cursor:pointer;">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</button>
      <div id="ratingSuccess" style="display:none; margin-top:8px; color:#059669; font-size:13px;">âœ… Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ùƒ!</div>
    </div>

    <!-- Ù‚Ø³Ù… Ø§Ù„ØªØ³ÙˆÙŠÙ‚ -->
    <div id="marketingSection" class="card fade-in" style="margin-top:12px; background:linear-gradient(135deg,#fef3c7,#fde68a); border:2px solid #f59e0b;">
      <div style="text-align:center;">
        <div style="font-size:24px; margin-bottom:6px;">ğŸš€</div>
        <h3 style="margin:0 0 6px; font-size:17px; color:#92400e;">Ù†Ù†Ø¬Ø² ØªÙ…ÙˆÙŠÙ„Ùƒ Ø¨Ø£Ø³Ø±Ø¹ ÙˆÙ‚Øª!</h3>
        <p style="font-size:14px; color:#78350f; margin-bottom:10px;">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø§Ù„Ø­ÙŠÙ† ÙˆØ®Ù„Ù†Ø§ Ù†Ø³Ø§Ø¹Ø¯Ùƒ ÙÙŠ Ø¥ØªÙ…Ø§Ù… ØªÙ…ÙˆÙŠÙ„Ùƒ Ø¨Ø¯ÙˆÙ† ØªØ¹Ù‚ÙŠØ¯Ø§Øª âš¡ï¸</p>
        <a href="https://wa.me/966506214458" target="_blank" style="display:inline-block; background:linear-gradient(135deg,#25d366,#128c7e); color:#fff; padding:10px 24px; border-radius:25px; font-size:15px; font-weight:bold; text-decoration:none;">ğŸ“² ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</a>
      </div>
    </div>

    <!-- Ø²Ø± Ø¥Ø¨Ø±Ø§Ù… Ø¹Ù‚Ø¯ -->
    <div id="contractSection" class="card fade-in" style="margin-top:12px; display:none;">
      <a id="contractLink" href="#" target="_blank" style="display:block; background:linear-gradient(135deg,#3b82f6,#1d4ed8); color:#fff; padding:12px 20px; border-radius:12px; font-size:16px; font-weight:bold; text-decoration:none; text-align:center;">ğŸ“ Ø¥Ø¨Ø±Ø§Ù… Ø¹Ù‚Ø¯ ØªØ­ÙˆÙŠÙ„ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</a>
    </div>
  </div>

  <!-- ØµÙØ­Ø© "Ù‚Ø±ÙŠØ¨Ø§Ù‹" Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª ØºÙŠØ± Ø§Ù„Ù…ÙØ¹Ù‘Ù„Ø© -->
  <div id="comingSoonPage" class="page">
    <div class="card fade-in">
      <h2 id="comingSoonTitle" style="margin-top:0; font-size:19px; color:#111827;">Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹</h2>
      <p id="comingSoonText" style="font-size:14px; color:#6b7280;">
        Ø­Ø§Ù„ÙŠØ§Ù‹ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ø­ØªØ³Ø§Ø¨ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ Ø¹Ø¨Ø± Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ø³Ø¨Ø©.<br>
        Ø³ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø¯Ù…Ø© ÙÙŠ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ø¥Ù† Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡ ğŸ™
      </p>
      <div style="margin-top:12px;">
        <button class="secondary small" onclick="backToFinanceType()"> ğŸ”™ Ø±Ø¬ÙˆØ¹ Ù„Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„</button>
      </div>
    </div>
  </div>

  <!-- ØµÙØ­Ø© Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ -->
  <div id="adminLoginPage" class="page">
    <div class="card fade-in">
      <h2 style="margin-top:0; font-size:19px; color:#111827;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±Ù</h2>
      <p style="font-size:13px; color:#b91c1c; text-align:right;">
        âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ù…Ø®ØµØµ Ù„Ù„Ù…Ø´Ø±ÙÙŠÙ† Ø§Ù„Ù…Ø±Ø®Øµ Ù„Ù‡Ù… ÙÙ‚Ø·.<br>
        Ø£ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¯Ø®ÙˆÙ„ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø© Ù‚Ø¯ ØªØ¹ØªØ¨Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Ù‹ ØºÙŠØ± Ù…ØµØ±Ø­ Ø¨Ù‡.
      </p>
      <label for="adminPin">Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„</label>
      <input id="adminPin" type="password" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ù…Ø´Ø±Ù" />
      <div style="margin-top:12px;">
        <button class="primary small" onclick="handleAdminLogin()">Ø¯Ø®ÙˆÙ„</button>
        <button class="secondary small" onclick="backToLanding()">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
      <div id="adminLoginError" class="alert-error" style="display:none; margin-top:8px;">
        Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.
      </div>
    </div>
  </div>

  <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ (Hub) -->
  <div id="adminHubPage" class="page">
    <div class="card fade-in">
      <h2 style="margin-top:0; font-size:19px; color:#111827;">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h2>
      <p style="font-size:13px; color:#6b7280; text-align:right;">
        Ø§Ø®ØªØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:
      </p>
      <div style="display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap; margin-top:10px;">
        <button class="primary small" onclick="showPage('admin')">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Ø³Ø¨</button>
        <button class="secondary small" onclick="showPage('adminProducts')">Ø¥Ø¯Ø§Ø±Ø© Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙ…ÙˆÙŠÙ„</button>
        <button class="secondary small" onclick="showPage('adminArchive')">Ø³Ø¬Ù„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</button>
        <button class="secondary small" onclick="showPage('adminRatings')">â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</button>
        <button class="secondary small" onclick="showPage('adminOffers')">ğŸ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø®Ø§ØµØ©</button>
        <button class="secondary small" onclick="showPage('adminMarketing')">ğŸ“¢ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ³ÙˆÙŠÙ‚</button>
        <button class="secondary small" onclick="backToLanding()">Ø±Ø¬ÙˆØ¹</button>
      </div>
    </div>
  </div>

  <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ (ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Ø³Ø¨) -->
  <div id="adminPage" class="page">
    <div class="card fade-in">
      <h2 style="margin-top:0; font-size:19px; color:#111827;">Ù„ÙˆØ­Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ù†ÙˆÙƒ</h2>
      <p style="font-size:13px; color:#6b7280; text-align:right;">
        Ù…Ù† Ù‡Ù†Ø§ ØªØ¶ÙŠÙ ÙˆØªØ¹Ø¯Ù‘Ù„ Ø´Ø±Ø§Ø¦Ø­ Ø§Ù„Ø±ÙˆØ§ØªØ¨ ÙˆÙ†Ø³Ø¨ Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ù„ÙƒÙ„ Ø¨Ù†Ùƒ / Ø´Ø±ÙƒØ© ØªÙ…ÙˆÙŠÙ„ ÙˆÙ†ÙˆØ¹ ØªÙ…ÙˆÙŠÙ„.
        Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ³ØªØ®Ø¯Ù… ÙÙŠ Ø®ÙŠØ§Ø± <strong>ØªØ±Ø´ÙŠØ­ Ø¨Ù†Ùƒ Ù…Ù†Ø§Ø³Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</strong>.
      </p>

      <form id="adminForm" onsubmit="saveBankConfig(event)">
        <div class="admin-grid">
          <div>
            <label>Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ / Ø´Ø±ÙƒØ© Ø§Ù„ØªÙ…ÙˆÙŠÙ„</label>
            <select id="adminBankName">
              <option value="">Ø§Ø®ØªØ±...</option>
              <option>Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ</option>
              <option>Ù…ØµØ±Ù Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ</option>
              <option>Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶</option>
              <option>Ø¨Ù†Ùƒ Ø³Ø§Ø¨</option>
              <option>Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„ÙˆØ·Ù†ÙŠ</option>
              <option>Ù…ØµØ±Ù Ø§Ù„Ø¥Ù†Ù…Ø§Ø¡</option>
              <option>Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ Ø§Ù„ÙØ±Ù†Ø³ÙŠ</option>
              <option>Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ Ù„Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±</option>
              <option>Ø¨Ù†Ùƒ Ø§Ù„Ø¨Ù„Ø§Ø¯</option>
              <option>Ø¨Ù†Ùƒ Ø§Ù„Ø¬Ø²ÙŠØ±Ø©</option>
              <option>Ø¨Ù†Ùƒ Ø§Ù„Ø®Ù„ÙŠØ¬ Ø§Ù„Ø¯ÙˆÙ„ÙŠ</option>
              <option>Ø¨Ù†Ùƒ Ø¯Ø§Ù„ 360 (D360 Bank)</option>
              <option>Ø¨Ù†Ùƒ Ø¥Ø³ ØªÙŠ Ø³ÙŠ (STC Bank)</option>
              <option>Ø¨Ù†Ùƒ ÙÙŠØ¬Ù† (Vision Bank)</option>
              <option>Ø¢ÙŠØ²ÙŠ Ø¨Ù†Ùƒ (EZ Bank)</option>

              <option>Amlak International Company</option>
              <option>Dar Al Tamleek Company</option>
              <option>Saudi Home Loans Company</option>
              <option>Deutsche Gulf Finance</option>
              <option>Abdul Latif Jameel United Real Estate Finance</option>
              <option>Saudi Real Estate Refinance Company</option>
              <option>Bidaya Home Finance</option>
              <option>Nayifat Finance Company</option>
              <option>Yanal Finance Company</option>
              <option>AlYusr Leasing &amp; Financing Company</option>
              <option>Ajil Financial Services Company</option>
              <option>National Finance Company</option>
              <option>Morabaha Marina Finance Company</option>
              <option>Kirnaf Finance Company</option>
              <option>Aljasriah Finance Company</option>
              <option>Matager Finance Company</option>
              <option>Saudi Finance Company</option>
              <option>Abdul Latif Jameel Finance Company</option>
              <option>Gulf Finance Company</option>
              <option>Tamwily International Company</option>
              <option>Alamthal Financing Company</option>
              <option>Osoul Modern Finance Company</option>
              <option>Dar Aletiman Alsaudi Company</option>
              <option>Tawkelat Financing Company</option>
              <option>Ijarah Finance Company</option>
              <option>Tayseer Finance Company</option>
              <option>Saudi Fransi For Finance Leasing Company</option>
              <option>Tamweel Aloula Finance Company</option>
              <option>American Express Saudi Arabia</option>
              <option>Aljabr Finance Company</option>
              <option>Alraedah Finance Company</option>
              <option>Raya Financing Company</option>
              <option>Quara Finance Company</option>
              <option>Taajeer Finance Company</option>
              <option>Gulf Lifting Financial Leasing Company</option>
              <option>Bab Rizq Jameel Microfinance Company</option>
              <option>United Company for Financial Services (Tasheel)</option>
              <option>Emkan Finance Company</option>
              <option>Tamam Finance Company</option>
              <option>National Home Finance Company</option>
              <option>Ø¨Ù†Ùƒ Ø¢Ø®Ø± (  )</option>
            </select>
          </div>
          <div>
            <label>Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„</label>
            <select id="adminFinanceType">
              <option value="personal">ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ / ØªØ£Ø¬ÙŠØ±ÙŠ</option>
              <option value="consumer">ØªÙ…ÙˆÙŠÙ„ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ</option>
              <option value="mortgage">ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ</option>
              <option value="buyoutPersonal">Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ</option>
              <option value="buyoutMortgage">Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ</option>
            </select>
          </div>
          <div>
            <label>Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø¹Ù… (Ù„Ù„Ø¹Ù‚Ø§Ø±ÙŠ)</label>
            <select id="adminSupportedType">
              <option value="Ø§Ù„ÙƒÙ„">Ø§Ù„ÙƒÙ„</option>
              <option value="Ù…Ø¯Ø¹ÙˆÙ…">Ù…Ø¯Ø¹ÙˆÙ…</option>
              <option value="ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…">ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…</option>
            </select>
          </div>
          <div>
            <label>Ù…Ù† Ø±Ø§ØªØ¨ (Ø±ÙŠØ§Ù„)</label>
            <input id="adminMinSalary" type="number" min="0" />
          </div>
          <div>
            <label>Ø¥Ù„Ù‰ Ø±Ø§ØªØ¨ (Ø±ÙŠØ§Ù„)</label>
            <input id="adminMaxSalary" type="number" min="0" />
          </div>
          <div>
            <label>Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ (%)</label>
            <input id="adminMargin" type="number" min="0" step="0.01" />
          </div>

          <div>
            <label>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ¸ÙŠÙØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <select id="adminJobType">
              <option value="">Ø§Ù„ÙƒÙ„</option>
              <option>Ø¹Ø³ÙƒØ±ÙŠ</option>
              <option>Ù…Ø¯Ù†ÙŠ (Ù‚Ø·Ø§Ø¹ Ø­ÙƒÙˆÙ…ÙŠ)</option>
              <option>Ø®Ø§Øµ (Ø´Ø¨Ù‡ Ø­ÙƒÙˆÙ…ÙŠ)</option>
              <option>Ø®Ø§Øµ (Ø´Ø±ÙƒØ© Ù…Ø¹ØªÙ…Ø¯Ø©)</option>
              <option>Ø®Ø§Øµ (Ø´Ø±ÙƒØ© ØºÙŠØ± Ù…Ø¹ØªÙ…Ø¯Ø©)</option>
            </select>
          </div>
          <div>
            <label>Ù…Ù† Ø´Ù‡Ø± (Ø§Ù„Ù…Ø¯Ø©)</label>
            <input id="adminMinMonths" type="number" min="1" />
          </div>
          <div>
            <label>Ø¥Ù„Ù‰ Ø´Ù‡Ø± (Ø§Ù„Ù…Ø¯Ø©)</label>
            <input id="adminMaxMonths" type="number" min="1" />
          </div>
          <div>
            <label>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <select id="adminProductDetail">
              <option value="">Ø§Ù„ÙƒÙ„</option>
              <option>ÙˆØ­Ø¯Ø© Ø¬Ø§Ù‡Ø²Ø© Ù…Ù† Ø§Ù„Ø³ÙˆÙ‚</option>
              <option>Ø¨Ù†Ø§Ø¡ Ø°Ø§ØªÙŠ</option>
              <option>Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø®Ø§Ø±Ø·Ø©</option>
              <option>ØªØ­Øª Ø§Ù„Ø§Ù†Ø´Ø§Ø¡ (Ø¨ÙŠØª ØªÙ…Ù„ÙƒÙ‡ Ø¹Ø¸Ù…)</option>
              <option>Ø§Ø±Ø¶ ÙˆÙ‚Ø±Ø¶ (Ø§Ø±Ø¶ ÙˆØ¨Ù†Ø§Ø¡ Ø°Ø§ØªÙŠ)</option>
              <option>Ø§Ø±Ø¶ (Ø³ÙƒÙ†ÙŠØ©)</option>
              <option>Ø±Ù‡Ù†</option>
            </select>
          </div>
          <div>
            <label>Ø§Ø¹ØªØ²Ø§Ø² (Ù„Ù„Ø¹Ø³ÙƒØ±ÙŠ Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…)</label>
            <select id="adminEtezaaz">
              <option value="">Ø¨Ø¯ÙˆÙ†</option>
              <option value="Ù†Ø¹Ù…">Ø§Ø¹ØªØ²Ø§Ø²</option>
            </select>
          </div>
          <div>
            <label>Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ø¹Ù…Ø±</label>
            <select id="adminAgeCalcType">
              <option value="hijri">Ù‡Ø¬Ø±ÙŠ (Ø§ÙØªØ±Ø§Ø¶ÙŠ)</option>
              <option value="gregorian">Ù…ÙŠÙ„Ø§Ø¯ÙŠ</option>
            </select>
          </div>
          <div>
            <label>Ø§Ù„Ø¹Ù…Ø± Ø§Ù„Ø£Ù‚ØµÙ‰ (Ø³Ù†Ø©)</label>
            <input id="adminMaxAge" type="number" min="50" max="80" placeholder="60" />
          </div>
        </div>
        <input type="hidden" id="adminEditIndex" value="" />
        <div style="text-align:left; margin-top:10px;">
          <button type="submit" class="primary small">ğŸ’¾ Ø­ÙØ¸</button>
          <button type="button" class="secondary small" onclick="clearAdminForm()">Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</button>
        </div>
      </form>

      <table class="admin-table" id="adminTable">
        <thead>
          <tr>
            <th>Ø§Ù„Ø¨Ù†Ùƒ / Ø§Ù„Ø´Ø±ÙƒØ©</th>
            <th>Ø§Ù„ØªÙ…ÙˆÙŠÙ„</th>
            <th>Ø§Ù„Ø¯Ø¹Ù…</th>
            <th>Ù…Ù† Ø±Ø§ØªØ¨</th>
            <th>Ø¥Ù„Ù‰ Ø±Ø§ØªØ¨</th>
            <th>Ø§Ù„Ù…Ø¯Ø© (Ù…Ù†)</th>
            <th>Ø§Ù„Ù…Ø¯Ø© (Ø¥Ù„Ù‰)</th>
            <th>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ¸ÙŠÙØ©</th>
            <th>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</th>
            <th>Ø§Ø¹ØªØ²Ø§Ø²</th>
            <th>Ø§Ù„Ù†Ø³Ø¨Ø© %</th>
            <th>Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ø¹Ù…Ø±</th>
            <th>Ø§Ù„Ø¹Ù…Ø± Ø§Ù„Ø£Ù‚ØµÙ‰</th>
            <th>ØªØ­ÙƒÙ…</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div style="margin-top:8px; font-size:11px; color:#9ca3af; text-align:right;">
        Ù…Ù„Ø§Ø­Ø¸Ø©: Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¨Ù†ÙˆÙƒ ØªÙØ¬Ù„Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ.
        Ø¶Ø¹ Ù…Ù„ÙØ§Øª Ø§Ù„ØµÙˆØ± ÙÙŠ Ù…Ø¬Ù„Ø¯ <code>img</code> Ø¨Ù†ÙØ³ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø´Ø§Ø± Ø¥Ù„ÙŠÙ‡Ø§ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯.
      </div>

      <div style="margin-top:12px; text-align:left;">
        <button class="secondary small" onclick="showPage('adminHub')">Ø±Ø¬ÙˆØ¹ Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</button>
      </div>
    </div>
  </div>

  <!-- (Ø¥Ø¶Ø§ÙØ©) Ø¥Ø¯Ø§Ø±Ø© Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙ…ÙˆÙŠÙ„ -->
  <div id="adminProductsPage" class="page">
    <div class="card fade-in">
      <h2 style="margin-top:0; font-size:19px; color:#111827;">Ø¥Ø¯Ø§Ø±Ø© Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙ…ÙˆÙŠÙ„</h2>
      <p style="font-size:13px; color:#6b7280; text-align:right;">
        Ù…Ù† Ù‡Ù†Ø§ ØªØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙŠ ØªØ¸Ù‡Ø± Ù„Ù„Ø¹Ù…ÙŠÙ„ ÙÙŠ "Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„": ØªÙØ¹ÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù + Ø±Ø³Ø§Ù„Ø© Ø§Ø¹ØªØ°Ø§Ø± + Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯.
      </p>

      <form id="adminProductsForm" onsubmit="saveFinanceProduct(event)">
        <div class="admin-grid">
          <div style="grid-column:1/-1;">
            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ (ÙŠØ¸Ù‡Ø± Ù„Ù„Ø¹Ù…ÙŠÙ„)</label>
            <input id="fpName" type="text" placeholder="Ù…Ø«Ø§Ù„: ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø£Ø³Ø·ÙˆÙ„" />
          </div>

          <div>
            <label>Ø§Ù„Ø­Ø§Ù„Ø©</label>
            <select id="fpEnabled">
              <option value="true">Ù…ÙØ¹Ù‘Ù„</option>
              <option value="false">ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„</option>
            </select>
          </div>

          <div style="grid-column:1/-1;">
            <label>Ø±Ø³Ø§Ù„Ø© Ø¹Ù†Ø¯ Ø¹Ø¯Ù… Ø§Ù„ØªÙØ¹ÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <input id="fpMessage" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù†Ø¹ØªØ°Ø± Ù…Ù†ÙƒØŒ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹." />
          </div>
        </div>

        <input type="hidden" id="fpEditIndex" value="" />

        <div style="text-align:left; margin-top:10px; display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;">
          <button type="submit" class="primary small">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</button>
          <button type="button" class="secondary small" onclick="clearFinanceProductForm()">Ù…Ø³Ø­</button>
        </div>
      </form>

      <table class="admin-table" id="financeProductsTable">
        <thead>
          <tr>
            <th>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</th>
            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
            <th>Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù</th>
            <th>ØªØ­ÙƒÙ…</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div style="margin-top:12px; text-align:left;">
        <button class="secondary small" onclick="showPage('adminHub')">Ø±Ø¬ÙˆØ¹ Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</button>
      </div>
    </div>

    <div class="card fade-in">
      <h2 style="margin-top:0; font-size:19px; color:#111827;">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (ØªÙ‚Ø¯ÙŠØ±ÙŠØ©) Ù„Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù…Ù…ØªØ¯</h2>
      <p style="font-size:13px; color:#6b7280; text-align:right;">
        Ù…Ù„Ø§Ø­Ø¸Ø©: "Ø±Ø§ØªØ¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯" ÙŠØ­ØªØ§Ø¬ Ø±Ø§ØªØ¨ Ø£Ø³Ø§Ø³ÙŠ ÙØ¹Ù„ÙŠØŒ ÙˆØ¨Ù…Ø§ Ø£Ù†Ùƒ Ù„Ø§ ØªØ±ÙŠØ¯ Ø³Ø¤Ø§Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ù†Ù‡ØŒ ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ø¯Ø§Ø¯ "Ù…Ø¹Ø§Ù…Ù„" ØªÙ‚Ø¯ÙŠØ±ÙŠ Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØµØ§ÙÙŠ Ø¥Ù„Ù‰ (Ø¨Ø¯ÙŠÙ„ Ù„Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ) Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ø³Ø¨Ø© Ø§Ù„Ù…Ù…ØªØ¯Ø© ÙÙ‚Ø·.
      </p>
      <div class="admin-grid">
        <div>
          <label>Ù…Ø¹Ø§Ù…Ù„ ØªÙ‚Ø¯ÙŠØ±ÙŠ (Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ = Ø§Ù„ØµØ§ÙÙŠ Ã— Ø§Ù„Ù…Ø¹Ø§Ù…Ù„)</label>
          <input id="retBasicMultiplier" type="number" step="0.01" min="0" />
        </div>
        <div style="display:flex; align-items:flex-end; justify-content:flex-end; gap:8px;">
          <button class="primary small" onclick="saveRetirementSettings()">ğŸ’¾ Ø­ÙØ¸</button>
          <button class="secondary small" onclick="loadRetirementSettingsToUI()">Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„</button>
        </div>
      </div>
      <div style="margin-top:8px; font-size:12px; color:#6b7280; text-align:right;">
        Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ = 1.00 (ÙŠØ¹Ù†ÙŠ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„ØµØ§ÙÙŠ ÙƒØ¨Ø¯ÙŠÙ„ Ù„Ù„Ø£Ø³Ø§Ø³ÙŠ) â€” ÙˆØªÙ‚Ø¯Ø± ØªØºÙŠØ±Ù‡ Ø­Ø³Ø¨ Ø®Ø¨Ø±ØªÙƒ.
      </div>
    </div>
  </div>

  <!-- Ø³Ø¬Ù„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
  <div id="adminArchivePage" class="page">
    <div class="card fade-in">
      <h2 style="margin-top:0; font-size:19px; color:#111827;">Ø³Ø¬Ù„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>
      <p style="font-size:13px; color:#6b7280; text-align:right;">
        Ø§Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ø£Ùˆ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯Ù†ÙŠ. ÙŠØ¸Ù‡Ø± "Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©" + "Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„" Ø¥Ù† ÙˆÙØ¬Ø¯Øª.
      </p>

      <div class="admin-grid">
        <div style="grid-column:1/-1;">
          <label>Ø¨Ø­Ø« (Ø¬ÙˆØ§Ù„ / Ø³Ø¬Ù„ Ù…Ø¯Ù†ÙŠ)</label>
          <input id="archiveSearch" type="text" placeholder="Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ø£Ùˆ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯Ù†ÙŠ..." oninput="renderArchiveTable()" />
        </div>
      </div>

      <table class="admin-table" id="archiveTable">
        <thead>
          <tr>
            <th>Ø§Ù„Ù…ÙØªØ§Ø­ (Ø¬ÙˆØ§Ù„/Ø³Ø¬Ù„)</th>
            <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
            <th>Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„</th>
            <th>ØªØ§Ø±ÙŠØ®/ÙˆÙ‚Øª</th>
            <th>Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±Ø´Ø­</th>
            <th>Ù…Ù…ØªØ¯</th>
            <th>ØªØ­ÙƒÙ…</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div style="margin-top:12px; text-align:left;">
        <button class="secondary small" onclick="showPage('adminHub')">Ø±Ø¬ÙˆØ¹ Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</button>
      </div>
    </div>
  </div>

  <!-- ØµÙØ­Ø© Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø³Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¨ÙƒØ± -->
  <div id="earlySettlementPage" class="page">
    <div class="card fade-in">
      <h2 style="margin-top:0; font-size:22px; color:#111827;">ğŸ’° Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø³Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¨ÙƒØ±</h2>
      <p style="font-size:14px; color:#6b7280; text-align:right;">
        Ø§Ø­Ø³Ø¨ Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¨ÙƒØ± Ù„ØªÙ…ÙˆÙŠÙ„Ùƒ Ø­Ø³Ø¨ Ù†Ø¸Ø§Ù… Ø³Ø§Ù…Ø§ (Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ)
      </p>
      
      <div class="admin-grid" style="margin-top:15px;">
        <div>
          <label>Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„</label>
          <select id="esFinanceType">
            <option value="personal">ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ / Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ</option>
            <option value="mortgage">ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ</option>
          </select>
        </div>
        <div>
          <label>Ù…Ø¨Ù„Øº Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø£ØµÙ„ÙŠ (Ø±ÙŠØ§Ù„)</label>
          <input id="esOriginalAmount" type="number" min="0" placeholder="Ù…Ø«Ø§Ù„: 500000">
        </div>
        <div>
          <label>Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ÙƒÙ„ÙŠØ© (Ø´Ù‡Ø±)</label>
          <input id="esTotalMonths" type="number" min="1" placeholder="Ù…Ø«Ø§Ù„: 60">
        </div>
        <div>
          <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…Ø³Ø¯Ø¯Ø©</label>
          <input id="esPaidMonths" type="number" min="0" placeholder="Ù…Ø«Ø§Ù„: 24">
        </div>
        <div>
          <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø³Ù†ÙˆÙŠØ© (%)</label>
          <input id="esAnnualRate" type="number" step="0.01" min="0" placeholder="Ù…Ø«Ø§Ù„: 5.5">
        </div>
      </div>
      
      <div style="margin-top:15px;">
        <button class="primary" onclick="calculateEarlySettlement()">ğŸ“Š Ø§Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¨ÙƒØ±</button>
      </div>
      
      <div id="esResult" style="display:none; margin-top:20px; padding:15px; background:linear-gradient(135deg,#ecfdf5,#d1fae5); border-radius:15px; text-align:right;">
        <!-- Ø§Ù„Ù†ØªÙŠØ¬Ø© ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
      </div>
      
      <div style="margin-top:15px; padding:12px; background:#fef3c7; border-radius:10px; text-align:right; font-size:13px;">
        <strong>â„¹ï¸ Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ø­Ø³Ø¨ Ù†Ø¸Ø§Ù… Ø³Ø§Ù…Ø§ØŒ Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¨ÙƒØ± = Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù…Ù† Ø§Ù„Ø£ØµÙ„ + ÙƒÙ„ÙØ© 3 Ø£Ø´Ù‡Ø± Ù‚Ø§Ø¯Ù…Ø© (Ù„Ù„Ø´Ø®ØµÙŠ) Ø£Ùˆ Ø´Ù‡Ø± ÙˆØ§Ø­Ø¯ (Ù„Ù„Ø¹Ù‚Ø§Ø±ÙŠ)
      </div>
      
      <div style="margin-top:15px;">
        <button class="secondary small" onclick="showPage('landing')">ğŸ  Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
      </div>
    </div>
  </div>

  <!-- ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª -->
  <div id="adminRatingsPage" class="page">
    <div class="card fade-in">
      <h2 style="margin-top:0; font-size:19px; color:#111827;">â­ Ø¥Ø¯Ø§Ø±Ø© ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>
      <p style="font-size:13px; color:#6b7280; text-align:right;">
        Ù‡Ù†Ø§ ØªÙ‚Ø¯Ø± ØªØ´ÙˆÙ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØªÙ†Ø´Ø±Ù‡Ø§ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.
      </p>
      
      <div style="margin:15px 0;">
        <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
          <input type="checkbox" id="showRatingsOnHome" onchange="saveRatingsSettings()">
          <span>Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        </label>
      </div>
      
      <table class="admin-table" id="ratingsTable">
        <thead>
          <tr>
            <th>Ø§Ù„Ø§Ø³Ù…</th>
            <th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th>
            <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</th>
            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            <th>Ù…Ù†Ø´ÙˆØ±</th>
            <th>ØªØ­ÙƒÙ…</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      
      <div style="margin-top:15px;">
        <button class="secondary small" onclick="showPage('adminHub')">ğŸ”™ Ø±Ø¬ÙˆØ¹ Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</button>
      </div>
    </div>
  </div>

  <!-- ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø®Ø§ØµØ© -->
  <div id="adminOffersPage" class="page">
    <div class="card fade-in">
      <h2 style="margin-top:0; font-size:19px; color:#111827;">ğŸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø®Ø§ØµØ©</h2>
      <p style="font-size:13px; color:#6b7280; text-align:right;">
        Ø£Ø¶Ù Ø¹Ø±ÙˆØ¶ Ø®Ø§ØµØ© ØªØ¸Ù‡Ø± Ù„Ù„Ø¹Ù…ÙŠÙ„ ÙˆÙ‚Øª Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø£Ùˆ Ø§Ù„Ù…Ø¨Ù„Øº.
      </p>
      
      <form id="offerForm" onsubmit="saveOffer(event)" style="margin-top:15px;">
        <input type="hidden" id="offerEditIndex" value="">
        <div class="admin-grid">
          <div>
            <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ø±Ø¶</label>
            <input id="offerTitle" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø¹Ø±Ø¶ Ø®Ø§Øµ Ù„Ù„Ø¹Ø³ÙƒØ±ÙŠÙŠÙ†">
          </div>
          <div>
            <label>Ù†Øµ Ø§Ù„Ø¹Ø±Ø¶</label>
            <textarea id="offerText" rows="2" placeholder="Ù…Ø«Ø§Ù„: ÙŠØ§ ÙÙ„Ø§Ù† ÙˆÙ„Ø§ÙŠÙ‡Ù…Ùƒ Ù…Ø§Ù„Ùƒ Ø§Ù„Ø§ Ù†Ø³Ø¯Ø¯ Ø¹Ù†Ùƒ..."></textarea>
          </div>
          <div>
            <label>Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</label>
            <select id="offerTargetType">
              <option value="">Ø§Ù„ÙƒÙ„</option>
              <option>ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ</option>
              <option>ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ</option>
              <option>Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©</option>
            </select>
          </div>
          <div>
            <label>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø¨Ù„Øº (Ø±ÙŠØ§Ù„)</label>
            <input id="offerMinAmount" type="number" min="0" placeholder="0">
          </div>
          <div>
            <label>Ø§Ù„Ø­Ø§Ù„Ø©</label>
            <select id="offerEnabled">
              <option value="true">Ù…ÙØ¹Ù‘Ù„</option>
              <option value="false">Ù…ÙˆÙ‚Ù</option>
            </select>
          </div>
        </div>
        <div style="margin-top:10px; display:flex; gap:8px; justify-content:flex-end;">
          <button type="submit" class="primary small">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¹Ø±Ø¶</button>
          <button type="button" class="secondary small" onclick="clearOfferForm()">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
      </form>
      
      <table class="admin-table" id="offersTable" style="margin-top:15px;">
        <thead>
          <tr>
            <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
            <th>Ø§Ù„Ù†Øµ</th>
            <th>Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</th>
            <th>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰</th>
            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
            <th>ØªØ­ÙƒÙ…</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      
      <div style="margin-top:15px;">
        <button class="secondary small" onclick="showPage('adminHub')">ğŸ”™ Ø±Ø¬ÙˆØ¹ Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</button>
      </div>
    </div>
  </div>

  <!-- ØµÙØ­Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ³ÙˆÙŠÙ‚ -->
  <div id="adminMarketingPage" class="page">
    <div class="card fade-in">
      <h2 style="margin-top:0; font-size:19px; color:#111827;">ğŸ“¢ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ³ÙˆÙŠÙ‚</h2>
      <p style="font-size:13px; color:#6b7280; text-align:right;">
        ØªØ­ÙƒÙ… Ø¨Ù‚Ø³Ù… Ø§Ù„ØªØ³ÙˆÙŠÙ‚ ÙˆØ²Ø± Ø¥Ø¨Ø±Ø§Ù… Ø§Ù„Ø¹Ù‚Ø¯ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø©.
      </p>
      
      <div class="admin-grid" style="margin-top:15px;">
        <div>
          <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
            <input type="checkbox" id="showMarketingSection" onchange="saveMarketingSettings()" checked>
            <span>Ø¹Ø±Ø¶ Ù‚Ø³Ù… Ø§Ù„ØªØ³ÙˆÙŠÙ‚ "Ù†Ù†Ø¬Ø² ØªÙ…ÙˆÙŠÙ„Ùƒ"</span>
          </label>
        </div>
        <div>
          <label>Ø¹Ù†ÙˆØ§Ù† Ù‚Ø³Ù… Ø§Ù„ØªØ³ÙˆÙŠÙ‚</label>
          <input id="marketingTitle" type="text" value="Ù†Ù†Ø¬Ø² ØªÙ…ÙˆÙŠÙ„Ùƒ Ø¨Ø£Ø³Ø±Ø¹ ÙˆÙ‚Øª!">
        </div>
        <div>
          <label>Ù†Øµ Ù‚Ø³Ù… Ø§Ù„ØªØ³ÙˆÙŠÙ‚</label>
          <textarea id="marketingText" rows="2">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø§Ù„Ø­ÙŠÙ† ÙˆØ®Ù„Ù†Ø§ Ù†Ø³Ø§Ø¹Ø¯Ùƒ ÙÙŠ Ø¥ØªÙ…Ø§Ù… ØªÙ…ÙˆÙŠÙ„Ùƒ Ø¨Ø¯ÙˆÙ† ØªØ¹Ù‚ÙŠØ¯Ø§Øª âš¡ï¸</textarea>
        </div>
        <div>
          <label>Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</label>
          <input id="marketingWhatsapp" type="text" value="966506214458">
        </div>
      </div>
      
      <hr style="margin:20px 0; border:none; border-top:1px dashed #e5e7eb;">
      
      <div class="admin-grid">
        <div>
          <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
            <input type="checkbox" id="showContractButton" onchange="saveMarketingSettings()">
            <span>Ø¹Ø±Ø¶ Ø²Ø± "Ø¥Ø¨Ø±Ø§Ù… Ø¹Ù‚Ø¯"</span>
          </label>
        </div>
        <div>
          <label>Ù†Øµ Ø²Ø± Ø§Ù„Ø¹Ù‚Ø¯</label>
          <input id="contractButtonText" type="text" value="ğŸ“ Ø¥Ø¨Ø±Ø§Ù… Ø¹Ù‚Ø¯ ØªØ­ÙˆÙŠÙ„ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
        </div>
        <div>
          <label>Ø±Ø§Ø¨Ø· Ø§Ù„Ø¹Ù‚Ø¯</label>
          <input id="contractLink" type="url" placeholder="https://example.com/contract">
        </div>
      </div>
      
      <hr style="margin:20px 0; border:none; border-top:1px dashed #e5e7eb;">
      
      <div>
        <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
          <input type="checkbox" id="showRatingSection" onchange="saveMarketingSettings()" checked>
          <span>Ø¹Ø±Ø¶ Ù‚Ø³Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡</span>
        </label>
      </div>
      
      <div style="margin-top:15px; display:flex; gap:8px; justify-content:flex-end;">
        <button class="primary small" onclick="saveMarketingSettings()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        <button class="secondary small" onclick="showPage('adminHub')">ğŸ”™ Ø±Ø¬ÙˆØ¹</button>
      </div>
    </div>
  </div>

</div>

<footer>
  <div class="footer-inner">
    <div>
      Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© -  Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ© -
      <span id="datetime"></span>
      <span class="hijri-chip">Ù‡Ø¬Ø±ÙŠ: <span id="datetimeHijri"></span></span>
    </div>

    <!-- â–«ï¸ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ ØªØ­Øª Ø§Ù„ÙÙˆØªØ± -->
    <div id="miniAdminTools" title="Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„" onclick="openMiniAdminTools()" style="opacity:0.15;font-size:8px;">
      â–ª
    </div>
  </div>
</footer>

<!-- Ù…ÙƒØªØ¨Ø© Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙƒØµÙˆØ±Ø© -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ (â–«ï¸) -->
<div id="miniAdminAuthModal" style="display:none; position:fixed; inset:0; background:rgba(15,23,42,.55); z-index:9999; padding:18px;">
  <div style="max-width:700px; margin:70px auto; background:#fff; border-radius:18px; padding:14px; text-align:right; box-shadow:0 18px 40px rgba(0,0,0,.25);">
    <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
      <div style="font-weight:900; color:#111827;">â–«ï¸ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</div>
      <button class="secondary small" onclick="closeMiniAdminAuth()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>

    <div class="alert-error" style="margin-top:10px;">
      âš ï¸ ØªØ­Ø°ÙŠØ±: Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† ÙÙ‚Ø·. Ø£ÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… ØºÙŠØ± Ù…ØµØ±Ø­ Ø¨Ù‡ Ù‚Ø¯ ÙŠØ¹Ø±Ù‘Ø¶Ùƒ Ù„Ù„Ù…Ø³Ø§Ø¡Ù„Ø©.
    </div>

    <label>Ø±Ù…Ø² Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</label>
    <input id="miniAdminPin" type="password" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„" />

    <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;">
      <button class="primary small" onclick="verifyMiniAdminPin()">ØªØ£ÙƒÙŠØ¯</button>
      <button class="secondary small" onclick="closeMiniAdminAuth()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>

    <div id="miniAdminPinError" class="alert-error" style="display:none; margin-top:8px;">
      Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­.
    </div>
  </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ -->
<div id="miniAdminActionsModal" style="display:none; position:fixed; inset:0; background:rgba(15,23,42,.55); z-index:9999; padding:18px;">
  <div style="max-width:820px; margin:70px auto; background:#fff; border-radius:18px; padding:14px; text-align:right; box-shadow:0 18px 40px rgba(0,0,0,.25);">
    <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
      <div style="font-weight:900; color:#111827;">â–«ï¸ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</div>
      <button class="secondary small" onclick="closeMiniAdminActions()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>

    <p style="font-size:13px; color:#6b7280; margin:10px 0 0;">
      Ø§Ø®ØªØ±:
    </p>

    <div style="margin-top:10px; display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap;">
      <button class="primary small" onclick="openClientResultModal(true)">Ù†ØªÙŠØ¬Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„</button>
      <button class="secondary small" onclick="openArchiveSaveModal()">Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨Ø§Ù„Ø£Ø±Ø´ÙŠÙ</button>
      <button class="secondary small" onclick="openAdminLoginFromMiniTools()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±Ù</button>
    </div>

    <div style="margin-top:10px; font-size:12px; color:#6b7280;">
      * â€œÙ†ØªÙŠØ¬Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„â€ = Ù†ÙØ³ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø®ØªØµØ±Ø© + Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª + Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„. ÙˆÙŠÙ…ÙƒÙ† Ø­ÙØ¸Ù‡Ø§ ÙƒØµÙˆØ±Ø©.
    </div>
  </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø­ÙØ¸ Ø¨Ø§Ù„Ø£Ø±Ø´ÙŠÙ -->
<div id="archiveSaveModal" style="display:none; position:fixed; inset:0; background:rgba(15,23,42,.55); z-index:9999; padding:18px;">
  <div style="max-width:820px; margin:70px auto; background:#fff; border-radius:18px; padding:14px; text-align:right; box-shadow:0 18px 40px rgba(0,0,0,.25);">
    <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
      <div style="font-weight:900; color:#111827;">ğŸ—‚ï¸ Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨Ø§Ù„Ø£Ø±Ø´ÙŠÙ</div>
      <button class="secondary small" onclick="closeArchiveSaveModal()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>

    <div class="alert-error" style="margin-top:10px;">
      âš ï¸ ØªÙ†Ø¨ÙŠÙ‡: Ø³ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¬Ù‡Ø§Ø² (LocalStorage) â€” Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….
    </div>

    <label>Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯Ù†ÙŠ (Ø¥Ù„Ø²Ø§Ù…ÙŠ)</label>
    <input id="archiveKeyInput" type="text" placeholder="Ù…Ø«Ø§Ù„: 05xxxxxxxx Ø£Ùˆ 1xxxxxxxxx" />

    <div style="margin-top:10px; display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap;">
      <button class="primary small" onclick="saveCurrentResultToArchive()">Ø­ÙØ¸</button>
      <button class="secondary small" onclick="closeArchiveSaveModal()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>

    <div id="archiveSaveMsg" style="display:none; margin-top:10px; font-size:13px; color:#0f766e; font-weight:900;"></div>
  </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„ (Ø¨Ø¹Ø¯ ØªØ­Ù‚Ù‚ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„) -->
<div id="clientResultModal" style="display:none; position:fixed; inset:0; background:rgba(15,23,42,.55); z-index:9999; padding:18px;">
  <div style="max-width:900px; margin:40px auto; background:#fff; border-radius:18px; padding:14px; text-align:right; box-shadow:0 18px 40px rgba(0,0,0,.25);">
    <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
      <div style="font-weight:900; color:#111827;">ğŸ“„ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„ (Ù…Ø®ØªØµØ±Ø©)</div>
      <button class="secondary small" onclick="closeClientResultModal()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>

    <div style="margin-top:10px; font-size:13px; color:#6b7280;">
      * Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªØ§Ù„ÙŠØ© Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© â€” Ø¥Ø°Ø§ ØªØ±ÙƒØªÙ‡Ø§ ÙØ§Ø¶ÙŠØ© Ø³ÙŠØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ â€œØ§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©â€ Ù…Ù† Ø§Ù„Ø­Ø§Ø³Ø¨Ø©.
    </div>

    <div class="admin-grid" style="margin-top:10px;">
      <div>
        <label>Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input id="clientNetOverride" type="number" min="0" placeholder="Ù…Ø«Ø§Ù„: 450000">
      </div>
      <div>
        <label>Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input id="clientInstOverride" type="number" min="0" placeholder="Ù…Ø«Ø§Ù„: 3200">
      </div>
      <div style="grid-column:1/-1;">
        <label>Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©)</label>
        <input id="clientNoteOverride" type="text" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø© ØªØ¸Ù‡Ø± Ù„Ù„Ø¹Ù…ÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
      </div>
    </div>

    <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;">
      <button class="primary small" onclick="generateClientResultText()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø®ØªØµØ±Ø©</button>
      <button class="secondary small" onclick="copyClientResultText()">ğŸ“‹ Ù†Ø³Ø®</button>
      <button class="secondary small" onclick="shareClientResultOnWhatsApp()">ğŸ“² Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§ØªØ³Ø§Ø¨</button>
      <button class="secondary small" onclick="saveClientResultAsImage()">ğŸ–¼ï¸ Ø­ÙØ¸ ÙƒØµÙˆØ±Ø©</button>
    </div>

    <div style="margin-top:10px;">
      <label>Ø§Ù„Ù†Øµ Ø§Ù„Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ø±Ø³Ø§Ù„</label>
      <textarea id="clientResultText" style="width:100%; min-height:180px; padding:10px; font-size:14px; border-radius:12px; border:1px solid #e5e7eb; background:#f9fafb; direction:rtl;"></textarea>
    </div>

    <div style="margin-top:10px;">
      <label>Ù…Ø¹Ø§ÙŠÙ†Ø© (Ù„Ù„ØµÙˆØ±Ø©)</label>
      <div id="clientPreviewCard" class="client-preview">
        <div class="h">Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø³Ø¨Ø© (Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©)</div>
        <div style="color:#6b7280; font-size:12px;">Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø®ØªØµØ±Ø© Ø£ÙˆÙ„Ø§Ù‹ Ù„ØªØ¸Ù‡Ø± Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ù‡Ù†Ø§.</div>
      </div>
    </div>
  </div>
</div>

<script>
  function showPage(name) {
    ['landing','calculator','result','adminLogin','adminHub','admin','adminProducts','adminArchive','comingSoon','earlySettlement','adminRatings','adminOffers','adminMarketing','adminQuestions'].forEach(id => {
      const el = document.getElementById(id + 'Page');
      if (!el) return;
      el.classList.toggle('active', id === name);
    });
  }

  function backToLanding() { showPage('landing'); }

  function startClientFlow() {
    showPage('calculator');
    resetCalc();
  }

  function backToFinanceType(){
    showPage('calculator');
    hasStarted = true;
    const idx = generalQuestions.findIndex(q => q.id === 'financeType');
    step = idx >= 0 ? idx : 0;
    commitmentStep = 0;
    currentCommitment = {};
    document.getElementById('mainButton').style.display = 'none';
    document.getElementById('resetButtonContainer').style.display = 'block';
    document.getElementById('nextButton').style.display = 'inline-flex';
    showQuestion();
  }

  const bankLogoMap = {
    'Ù…ØµØ±Ù Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ': 'img/alrajhi.png',
    'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ': 'img/alahli.png',
    'Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶': 'img/riyad.png',
    'Ø¨Ù†Ùƒ Ø§Ù„Ø¨Ù„Ø§Ø¯': 'img/bilad.png',
    'Ø¨Ù†Ùƒ Ø§Ù„Ø¬Ø²ÙŠØ±Ø©': 'img/jazira.png',
    'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ Ø§Ù„ÙØ±Ù†Ø³ÙŠ': 'img/bsf.png',
    'Ø¨Ù†Ùƒ Ø³Ø§Ø¨': 'img/sab.png',
    'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„ÙˆØ·Ù†ÙŠ': 'img/anb.png',
    'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ Ù„Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±': 'img/saib.png'
  };

  let bankConfigs = [];
  const defaultBankConfigs = [
    { bankName: 'Ù…ØµØ±Ù Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ', bankType:'Ø¨Ù†Ùƒ', financeType: 'personal', supportedType: 'Ø§Ù„ÙƒÙ„', minSalary: 4000, maxSalary: 8000, margin: 5.5 },
    { bankName: 'Ù…ØµØ±Ù Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ', bankType:'Ø¨Ù†Ùƒ', financeType: 'personal', supportedType: 'Ø§Ù„ÙƒÙ„', minSalary: 8001, maxSalary: 20000, margin: 4.9 },
    { bankName: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ', bankType:'Ø¨Ù†Ùƒ', financeType: 'mortgage', supportedType: 'Ù…Ø¯Ø¹ÙˆÙ…', minSalary: 4000, maxSalary: 15000, margin: 4.3 },
    { bankName: 'Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶', bankType:'Ø¨Ù†Ùƒ', financeType: 'mortgage', supportedType: 'ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…', minSalary: 6000, maxSalary: 20000, margin: 4.8 }
  ];

  function loadBankConfigs() {
    try {
      const saved = localStorage.getItem('stBankConfigs');
      if (saved) {
        bankConfigs = JSON.parse(saved);
      } else {
        bankConfigs = defaultBankConfigs;
        saveBankConfigs();
      }
    } catch (e) {
      bankConfigs = defaultBankConfigs;
    }
    renderBankTable();
  }
  function saveBankConfigs() {
    localStorage.setItem('stBankConfigs', JSON.stringify(bankConfigs));
  }

  function renderBankTable() {
    const tbody = document.querySelector('#adminTable tbody');
    if(!tbody) return;
    tbody.innerHTML = '';
    bankConfigs.forEach((cfg, index) => {
      let financeLabel =
        cfg.financeType === 'personal' ? 'Ø´Ø®ØµÙŠ/ØªØ£Ø¬ÙŠØ±ÙŠ' :
        cfg.financeType === 'consumer' ? 'Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ' :
        cfg.financeType === 'mortgage' ? 'Ø¹Ù‚Ø§Ø±ÙŠ' :
        cfg.financeType === 'buyoutPersonal' ? 'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø´Ø®ØµÙŠ' :
        cfg.financeType === 'buyoutMortgage' ? 'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø¹Ù‚Ø§Ø±ÙŠ' :
        cfg.financeType;

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${cfg.bankName || ''}</td>
        <td>${financeLabel}</td>
        <td>${cfg.supportedType || ''}</td>
        <td>${(cfg.minSalary || 0).toLocaleString()}</td>
        <td>${(cfg.maxSalary || 0).toLocaleString()}</td>
        <td>${cfg.minMonths || ''}</td>
        <td>${cfg.maxMonths || ''}</td>
        <td>${cfg.jobType || ''}</td>
        <td>${cfg.productDetail || ''}</td>
        <td>${cfg.etezaaz || ''}</td>
        <td>${cfg.margin}</td>
        <td>${cfg.ageCalcType === 'gregorian' ? 'Ù…ÙŠÙ„Ø§Ø¯ÙŠ' : 'Ù‡Ø¬Ø±ÙŠ'}</td>
        <td>${cfg.maxAge || 60}</td>
        <td>
          <button class="btn small secondary" onclick="editBankConfig(${index})">ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="btn small secondary" onclick="deleteBankConfig(${index})">Ø­Ø°Ù</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  function clearAdminForm() {
    document.getElementById('adminBankName').value = '';
    document.getElementById('adminFinanceType').value = 'personal';
    document.getElementById('adminSupportedType').value = 'Ø§Ù„ÙƒÙ„';
    document.getElementById('adminMinSalary').value = '';
    document.getElementById('adminMaxSalary').value = '';
    document.getElementById('adminMargin').value = '';
    document.getElementById('adminJobType').value = '';
    document.getElementById('adminMinMonths').value = '';
    document.getElementById('adminMaxMonths').value = '';
    document.getElementById('adminProductDetail').value = '';
    document.getElementById('adminEtezaaz').value = '';
    document.getElementById('adminAgeCalcType').value = 'hijri';
    document.getElementById('adminMaxAge').value = '';
    document.getElementById('adminEditIndex').value = '';
  }

  function saveBankConfig(e) {
    e.preventDefault();
    const bankName = document.getElementById('adminBankName').value;
    const financeType = document.getElementById('adminFinanceType').value;
    const supportedType = document.getElementById('adminSupportedType').value;
    const minSalary = parseFloat(document.getElementById('adminMinSalary').value || '0');
    const maxSalary = parseFloat(document.getElementById('adminMaxSalary').value || '0');
    const margin = parseFloat(document.getElementById('adminMargin').value || '0');
    const jobType = document.getElementById('adminJobType').value;
    const minMonths = parseInt(document.getElementById('adminMinMonths').value || '0');
    const maxMonths = parseInt(document.getElementById('adminMaxMonths').value || '0');
    const productDetail = document.getElementById('adminProductDetail').value;
    const etezaaz = document.getElementById('adminEtezaaz').value;
    const ageCalcType = document.getElementById('adminAgeCalcType').value;
    const maxAge = parseInt(document.getElementById('adminMaxAge').value || '60');
    const editIndex = document.getElementById('adminEditIndex').value;

    if (!bankName || !margin || !minSalary || !maxSalary) {
      alert('Ø±Ø¬Ø§Ø¡Ù‹ Ø£ÙƒÙ…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©.');
      return;
    }
    const cfg = { bankName, financeType, supportedType, minSalary, maxSalary, margin };

    if (jobType) cfg.jobType = jobType;
    if (minMonths) cfg.minMonths = minMonths;
    if (maxMonths) cfg.maxMonths = maxMonths;
    if (productDetail) cfg.productDetail = productDetail;
    if (etezaaz) cfg.etezaaz = etezaaz;
    cfg.ageCalcType = ageCalcType || 'hijri';
    cfg.maxAge = maxAge || 60;

    if (editIndex === '') bankConfigs.push(cfg);
    else bankConfigs[parseInt(editIndex)] = cfg;

    saveBankConfigs();
    renderBankTable();
    clearAdminForm();
  }

  function editBankConfig(index) {
    const cfg = bankConfigs[index];
    document.getElementById('adminBankName').value = cfg.bankName || '';
    document.getElementById('adminFinanceType').value = cfg.financeType || 'personal';
    document.getElementById('adminSupportedType').value = cfg.supportedType || 'Ø§Ù„ÙƒÙ„';
    document.getElementById('adminMinSalary').value = cfg.minSalary || '';
    document.getElementById('adminMaxSalary').value = cfg.maxSalary || '';
    document.getElementById('adminMargin').value = cfg.margin || '';
    document.getElementById('adminJobType').value = cfg.jobType || '';
    document.getElementById('adminMinMonths').value = cfg.minMonths || '';
    document.getElementById('adminMaxMonths').value = cfg.maxMonths || '';
    document.getElementById('adminProductDetail').value = cfg.productDetail || '';
    document.getElementById('adminEtezaaz').value = cfg.etezaaz || '';
    document.getElementById('adminAgeCalcType').value = cfg.ageCalcType || 'hijri';
    document.getElementById('adminMaxAge').value = cfg.maxAge || '';
    document.getElementById('adminEditIndex').value = index;
  }

  function deleteBankConfig(index) {
    if (!confirm('Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø±ØŸ')) return;
    bankConfigs.splice(index, 1);
    saveBankConfigs();
    renderBankTable();
  }

  function getMatchingBanksForAnswers() {
    const salary = parseFloat(answers.salary || '0');
    if (!salary) return [];

    let fType;
    if (answers.financeType === 'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ') fType = 'buyoutPersonal';
    else if (answers.financeType === 'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ') fType = 'buyoutMortgage';
    else if (answers.financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ') fType = 'consumer';
    else if (answers.financeType && (answers.financeType.includes('Ø´Ø®ØµÙŠ') || answers.financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØªØ£Ø¬ÙŠØ±ÙŠ')) fType = 'personal';
    else if (answers.financeType && answers.financeType.includes('Ø¹Ù‚Ø§Ø±ÙŠ')) fType = 'mortgage';
    else fType = 'personal';

    const supp = answers.supported || 'Ø§Ù„ÙƒÙ„';
    const jobType = answers.jobType || '';
    const months = parseInt(answers.months || '0');
    const mortgageDetail = answers.mortgageProductType || '';
    const wantsEtezaaz = (answers.financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ' && answers.supported === 'Ù…Ø¯Ø¹ÙˆÙ…' && answers.isEtezaaz === 'Ù†Ø¹Ù…');

    const list = bankConfigs.filter(cfg => {
      if (cfg.financeType !== fType) return false;
      if (!(salary >= cfg.minSalary && salary <= cfg.maxSalary)) return false;
      if (!(cfg.supportedType === 'Ø§Ù„ÙƒÙ„' || cfg.supportedType === supp)) return false;

      if (cfg.jobType && jobType && cfg.jobType !== jobType) return false;
      if (cfg.minMonths && months && months < cfg.minMonths) return false;
      if (cfg.maxMonths && months && months > cfg.maxMonths) return false;
      if (cfg.productDetail && mortgageDetail && cfg.productDetail !== mortgageDetail) return false;
      if (wantsEtezaaz && cfg.etezaaz && cfg.etezaaz !== 'Ù†Ø¹Ù…') return false;

      return true;
    });

    list.sort((a,b)=> a.margin - b.margin);
    return list;
  }

  const ADMIN_PIN = '11qq11qQ@';

  function handleAdminLogin() {
    const pin = document.getElementById('adminPin').value;
    const err = document.getElementById('adminLoginError');
    if (pin === ADMIN_PIN) {
      err.style.display = 'none';
      showPage('adminHub');
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø£ÙŠØ¶Ø§Ù‹
      renderArchiveTable();
      // (Ø¥Ø¶Ø§ÙØ©) ØªØ­Ø¯ÙŠØ« Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
      renderFinanceProductsTable();
      loadRetirementSettingsToUI();
    } else {
      err.style.display = 'block';
    }
  }

  // ====== Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ (â–«ï¸) ======
  let _miniAdminVerified = false;
  function openMiniAdminTools(){
    document.getElementById('miniAdminPin').value = '';
    document.getElementById('miniAdminPinError').style.display = 'none';
    document.getElementById('miniAdminAuthModal').style.display = 'block';
  }
  function closeMiniAdminAuth(){
    document.getElementById('miniAdminAuthModal').style.display = 'none';
  }
  function verifyMiniAdminPin(){
    const pin = document.getElementById('miniAdminPin').value;
    if(pin === ADMIN_PIN){
      _miniAdminVerified = true;
      document.getElementById('miniAdminPinError').style.display = 'none';
      document.getElementById('miniAdminAuthModal').style.display = 'none';
      document.getElementById('miniAdminActionsModal').style.display = 'block';
    } else {
      document.getElementById('miniAdminPinError').style.display = 'block';
    }
  }
  function closeMiniAdminActions(){
    document.getElementById('miniAdminActionsModal').style.display = 'none';
  }

  function openAdminLoginFromMiniTools(){
    closeMiniAdminActions();
    showPage('adminLogin');
  }

  function openArchiveSaveModal(){
    closeMiniAdminActions();
    const lc = answers._lastCalc;
    if(!lc){
      alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªÙŠØ¬Ø© Ø­Ø§Ù„ÙŠØ§Ù‹. Ø§Ø­Ø³Ø¨ Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Ø§Ø­ÙØ¸ Ø¨Ø§Ù„Ø£Ø±Ø´ÙŠÙ.');
      return;
    }
    document.getElementById('archiveKeyInput').value = '';
    document.getElementById('archiveSaveMsg').style.display = 'none';
    document.getElementById('archiveSaveModal').style.display = 'block';
  }
  function closeArchiveSaveModal(){
    document.getElementById('archiveSaveModal').style.display = 'none';
  }

  // ====== (Ø¥Ø¶Ø§ÙØ©) Ø¥Ø¯Ø§Ø±Ø© Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙ…ÙˆÙŠÙ„ ======
  const FIN_PRODUCTS_KEY = 'stFinanceProducts';
  let financeProducts = [];

  function getDefaultFinanceProducts(){
    // Ù†ÙØ³ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©ØŒ Ù„ÙƒÙ† Ù…Ø¹ Ø­Ø§Ù„Ø© (Ù…ÙØ¹Ù‘Ù„/ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„) + Ø±Ø³Ø§Ù„Ø©
    return [
      { name:'ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ', enabled:true, message:'' },
      { name:'ØªÙ…ÙˆÙŠÙ„ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ', enabled:true, message:'' },
      { name:'ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØªØ£Ø¬ÙŠØ±ÙŠ', enabled:true, message:'' },
      { name:'ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ', enabled:true, message:'' },
      { name:'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ', enabled:true, message:'' },
      { name:'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ', enabled:false, message:'Ø­Ø§Ù„ÙŠØ§Ù‹ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ø­ØªØ³Ø§Ø¨ Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ© Ø¹Ø¨Ø± Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ø³Ø¨Ø©.' },
      { name:'Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥ØªÙ…Ø§Ù†', enabled:false, message:'Ù†Ø¹ØªØ°Ø± Ù…Ù†ÙƒØŒ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ù†Ø³Ø¨ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„Ù…Ù†ØµØ©.' },
      { name:'ØªÙ…ÙˆÙŠÙ„ Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹', enabled:false, message:'Ù†Ø¹ØªØ°Ø± Ù…Ù†ÙƒØŒ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ù†Ø³Ø¨ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„Ù…Ù†ØµØ©.' },
      { name:'ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª', enabled:false, message:'Ù†Ø¹ØªØ°Ø± Ù…Ù†ÙƒØŒ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ù†Ø³Ø¨ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„Ù…Ù†ØµØ©.' },
      { name:'ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø£Ø³Ø·ÙˆÙ„', enabled:false, message:'Ù†Ø¹ØªØ°Ø± Ù…Ù†ÙƒØŒ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ù†Ø³Ø¨ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„Ù…Ù†ØµØ©.' }
    ];
  }

  function loadFinanceProducts(){
    try{
      const s = localStorage.getItem(FIN_PRODUCTS_KEY);
      if(s){
        const arr = JSON.parse(s);
        financeProducts = Array.isArray(arr) ? arr : getDefaultFinanceProducts();
      } else {
        financeProducts = getDefaultFinanceProducts();
        saveFinanceProducts();
      }
    }catch(e){
      financeProducts = getDefaultFinanceProducts();
    }
  }

  function saveFinanceProducts(){
    localStorage.setItem(FIN_PRODUCTS_KEY, JSON.stringify(financeProducts || []));
  }

  function getFinanceProductNames(){
    // Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… ÙƒØ³Ø± Ø£ÙŠ Ø´ÙŠØ¡: Ù†Ø±Ø¬Ù‘Ø¹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙÙ‚Ø·
    const list = (financeProducts && financeProducts.length) ? financeProducts : getDefaultFinanceProducts();
    return list.map(x=>x.name);
  }

  function findFinanceProduct(name){
    const list = (financeProducts && financeProducts.length) ? financeProducts : getDefaultFinanceProducts();
    return list.find(x=>x.name===name) || null;
  }

  function isFinanceProductEnabled(name){
    const p = findFinanceProduct(name);
    if(!p) return true;
    return !!p.enabled;
  }

  function getFinanceProductMessage(name){
    const p = findFinanceProduct(name);
    return (p && p.message) ? String(p.message) : '';
  }

  function clearFinanceProductForm(){
    document.getElementById('fpName').value = '';
    document.getElementById('fpEnabled').value = 'true';
    document.getElementById('fpMessage').value = '';
    document.getElementById('fpEditIndex').value = '';
  }

  function saveFinanceProduct(e){
    e.preventDefault();
    const name = (document.getElementById('fpName').value || '').trim();
    const enabled = (document.getElementById('fpEnabled').value === 'true');
    const message = (document.getElementById('fpMessage').value || '').trim();
    const editIndex = document.getElementById('fpEditIndex').value;

    if(!name){
      alert('ÙØ¶Ù„Ø§Ù‹ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬.');
      return;
    }

    const item = { name, enabled, message };

    if(editIndex === ''){
      // Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù…
      const exists = financeProducts.some(x=>x.name===name);
      if(exists){
        alert('Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹. Ø¹Ø¯Ù‘Ù„Ù‡ Ø¨Ø¯Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©.');
        return;
      }
      financeProducts.push(item);
    } else {
      financeProducts[parseInt(editIndex)] = item;
    }

    saveFinanceProducts();
    renderFinanceProductsTable();
    clearFinanceProductForm();
  }

  function renderFinanceProductsTable(){
    const tbody = document.querySelector('#financeProductsTable tbody');
    if(!tbody) return;
    tbody.innerHTML = '';
    (financeProducts || []).forEach((p, idx)=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${escapeHtml(p.name || '')}</td>
        <td>${p.enabled ? 'Ù…ÙØ¹Ù‘Ù„' : 'ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„'}</td>
        <td style="text-align:right;">${escapeHtml(p.message || '')}</td>
        <td>
          <button class="btn small secondary" onclick="editFinanceProduct(${idx})">ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="btn small secondary" onclick="deleteFinanceProduct(${idx})">Ø­Ø°Ù</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  function editFinanceProduct(idx){
    const p = financeProducts[idx];
    if(!p) return;
    document.getElementById('fpName').value = p.name || '';
    document.getElementById('fpEnabled').value = p.enabled ? 'true' : 'false';
    document.getElementById('fpMessage').value = p.message || '';
    document.getElementById('fpEditIndex').value = idx;
  }

  function deleteFinanceProduct(idx){
    if(!confirm('Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) return;
    financeProducts.splice(idx, 1);
    saveFinanceProducts();
    renderFinanceProductsTable();
  }

  // ====== (Ø¥Ø¶Ø§ÙØ©) Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªÙ‚Ø¯ÙŠØ±ÙŠØ© Ù„Ù„ØªÙ‚Ø§Ø¹Ø¯ (Ù…Ø¹Ø§Ù…Ù„) ======
  const RET_SETTINGS_KEY = 'stRetirementSettings';
  let retirementSettings = { basicMultiplier: 1.00 };

  function loadRetirementSettings(){
    try{
      const s = localStorage.getItem(RET_SETTINGS_KEY);
      if(s){
        const obj = JSON.parse(s);
        if(obj && typeof obj.basicMultiplier === 'number'){
          retirementSettings = obj;
        } else {
          retirementSettings = { basicMultiplier: 1.00 };
        }
      } else {
        retirementSettings = { basicMultiplier: 1.00 };
        localStorage.setItem(RET_SETTINGS_KEY, JSON.stringify(retirementSettings));
      }
    }catch(e){
      retirementSettings = { basicMultiplier: 1.00 };
    }
  }

  function loadRetirementSettingsToUI(){
    const el = document.getElementById('retBasicMultiplier');
    if(!el) return;
    el.value = (retirementSettings.basicMultiplier ?? 1.00).toFixed(2);
  }

  function saveRetirementSettings(){
    const el = document.getElementById('retBasicMultiplier');
    if(!el) return;
    const v = parseFloat(el.value || '1');
    if(!isFinite(v) || v <= 0){
      alert('Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©.');
      return;
    }
    retirementSettings.basicMultiplier = v;
    localStorage.setItem(RET_SETTINGS_KEY, JSON.stringify(retirementSettings));
    alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ âœ…');
  }

  // ====== Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (LocalStorage) ======
  function loadArchive(){
    try{
      const s = localStorage.getItem('stClientArchive');
      if(!s) return [];
      const a = JSON.parse(s);
      return Array.isArray(a) ? a : [];
    }catch(e){ return []; }
  }
  function saveArchive(list){
    localStorage.setItem('stClientArchive', JSON.stringify(list || []));
  }

  function saveCurrentResultToArchive(){
    const key = (document.getElementById('archiveKeyInput').value || '').trim();
    if(!key){
      alert('ÙØ¶Ù„Ø§Ù‹ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ø£Ùˆ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯Ù†ÙŠ.');
      return;
    }
    const lc = answers._lastCalc;
    if(!lc){
      alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªÙŠØ¬Ø© Ù„Ù„Ø­ÙØ¸.');
      return;
    }

    // Ù„Ùˆ ÙÙŠÙ‡ "Ù†ØªÙŠØ¬Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„" ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§ØŒ Ù†Ø®Ø²Ù†Ù‡Ø§ ÙƒØ°Ù„Ùƒ
    const clientText = (document.getElementById('clientResultText') && document.getElementById('clientResultText').value.trim())
      ? document.getElementById('clientResultText').value.trim()
      : (lc._lastClientText || '');

    const rec = {
      id: Date.now(),
      key: key,
      clientName: lc.clientName || '',
      financeType: lc.financeType || '',
      calcDateTimeStr: lc.calcDateTimeStr || '',
      recommendedBankName: lc.recommendedBankName || '',
      real: lc,
      clientText: clientText || '',
    };

    const list = loadArchive();
    list.unshift(rec);
    saveArchive(list);

    document.getElementById('archiveSaveMsg').style.display = 'block';
    document.getElementById('archiveSaveMsg').textContent = 'ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ø§Ù„Ø£Ø±Ø´ÙŠÙ âœ…';
    renderArchiveTable();
  }

  function renderArchiveTable(){
    const table = document.querySelector('#archiveTable tbody');
    if(!table) return;
    table.innerHTML = '';
    const q = (document.getElementById('archiveSearch')?.value || '').trim();
    const list = loadArchive().filter(r=>{
      if(!q) return true;
      return (String(r.key||'').includes(q));
    });

    list.forEach((r, idx)=>{
      const tr = document.createElement('tr');
      const hasExtended = r.real && r.real.extended;
      const hasFormula = r.real && r.real.retirementFormula;
      tr.innerHTML = `
        <td>${escapeHtml(r.key || '')}</td>
        <td>${escapeHtml(r.clientName || '')}</td>
        <td>${escapeHtml(r.financeType || '')}</td>
        <td>${escapeHtml(r.calcDateTimeStr || '')}</td>
        <td>${escapeHtml(r.recommendedBankName || '')}</td>
        <td>${hasExtended ? '<span style="color:#047857;">\u2705 Ù†Ø¹Ù…</span>' : '<span style="color:#6b7280;">-</span>'}</td>
        <td>
          <button class="btn small secondary" onclick="viewArchiveRecord(${idx})">Ø¹Ø±Ø¶</button>
          ${hasFormula ? `<button class="btn small secondary" onclick="showRetirementFormula(${idx})">ğŸ“Š Ù…Ø¹Ø§Ø¯Ù„Ø©</button>` : ''}
          <button class="btn small secondary" onclick="deleteArchiveRecord(${idx})">Ø­Ø°Ù</button>
        </td>
      `;
      table.appendChild(tr);
    });
  }

  function showRetirementFormula(indexFiltered){
    const q = (document.getElementById('archiveSearch')?.value || '').trim();
    const all = loadArchive();
    const filtered = all.filter(r=> !q || String(r.key||'').includes(q));
    const rec = filtered[indexFiltered];
    if(!rec || !rec.real || !rec.real.retirementFormula) return;
    
    alert('ğŸ“Š Ù…Ø¹Ø§Ø¯Ù„Ø© Ø­Ø³Ø§Ø¨ Ø±Ø§ØªØ¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯:\n\n' + rec.real.retirementFormula);
  }

  function deleteArchiveRecord(indexFiltered){
    const q = (document.getElementById('archiveSearch')?.value || '').trim();
    const all = loadArchive();
    const filtered = all.filter(r=> !q || String(r.key||'').includes(q));
    const rec = filtered[indexFiltered];
    if(!rec) return;
    if(!confirm('Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù…Ù† Ø§Ù„Ø£Ø±Ø´ÙŠÙØŸ')) return;
    const newAll = all.filter(x => x.id !== rec.id);
    saveArchive(newAll);
    renderArchiveTable();
  }

  function viewArchiveRecord(indexFiltered){
    const q = (document.getElementById('archiveSearch')?.value || '').trim();
    const all = loadArchive();
    const filtered = all.filter(r=> !q || String(r.key||'').includes(q));
    const rec = filtered[indexFiltered];
    if(!rec) return;

    // Ù†Ø¹Ø±Ø¶Ù‡Ø§ Ø¯Ø§Ø®Ù„ Ù†Ø§ÙØ°Ø© "Ù†ØªÙŠØ¬Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„" + Ù†Ø¶Ø¹ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø±Ø³Ù„ Ø¥Ù† ÙˆØ¬Ø¯
    const lc = rec.real;
    answers._lastCalc = lc;

    openClientResultModal(true);

    setTimeout(()=>{
      if(rec.clientText){
        document.getElementById('clientResultText').value = rec.clientText;
        _clientResultTextCache = rec.clientText;
        renderClientPreviewFromText(rec.clientText);
      } else {
        // Ø¥Ø°Ø§ Ù…Ø§ ÙÙŠÙ‡ Ù†Øµ Ù…Ø±Ø³Ù„ØŒ Ù†Ù†Ø´Ø¦ Ù…Ù† Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©
        generateClientResultText();
      }
      
      // Ø¹Ø±Ø¶ Ù…Ø¹Ø§Ø¯Ù„Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ (Ø¥Ø°Ø§ ÙˆØ¬Ø¯Øª)
      if(lc && lc.retirementFormula){
        alert('ğŸ“Š Ù…Ø¹Ø§Ø¯Ù„Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯:\n\n' + lc.retirementFormula);
      }
    }, 200);
  }

  function escapeHtml(s){
    return String(s||'')
      .replace(/&/g,'&amp;')
      .replace(/</g,'&lt;')
      .replace(/>/g,'&gt;')
      .replace(/"/g,'&quot;')
      .replace(/'/g,'&#39;');
  }

  // ====== (Ø¥Ø¶Ø§ÙØ©) Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ (Ø£Ù… Ø§Ù„Ù‚Ø±Ù‰) ======
  function getHijriNowParts(){
    try{
      const fmt = new Intl.DateTimeFormat('en-US-u-ca-islamic-umalqura', {year:'numeric', month:'numeric', day:'numeric'});
      const parts = fmt.formatToParts(new Date());
      const y = parseInt(parts.find(p=>p.type==='year')?.value || '0', 10);
      const m = parseInt(parts.find(p=>p.type==='month')?.value || '0', 10);
      const d = parseInt(parts.find(p=>p.type==='day')?.value || '0', 10);
      return {y, m, d};
    }catch(e){
      // fallback ØªÙ‚Ø±ÙŠØ¨ÙŠ
      return {y:1446, m:1, d:1};
    }
  }

  function getHijriNowDisplay(){
    try{
      const fmt = new Intl.DateTimeFormat('ar-SA-u-ca-islamic-umalqura', {year:'numeric', month:'2-digit', day:'2-digit'});
      return fmt.format(new Date());
    }catch(e){
      return '';
    }
  }

  function monthsDiffHijri(fromY,fromM,fromD,toY,toM,toD){
    let months = (toY*12 + toM) - (fromY*12 + fromM);
    if(toD < fromD) months -= 1;
    return Math.max(0, months);
  }

  // ====== Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ© Ø§Ù„Ø±Ø³Ù…ÙŠ ======
  const militarySalaryTable = {
    // Ø§Ù„Ø¶Ø¨Ø§Ø·
    'Ù…Ù„Ø§Ø²Ù…': { allowance: 380, salaries: [7590,7970,8350,8730,9110,9490,9870,10250,10630,11010,11390,11770,12150,12530,12910] },
    'Ù…Ù„Ø§Ø²Ù… Ø£ÙˆÙ„': { allowance: 440, salaries: [8835,9275,9715,10155,10595,11035,11475,11915,12355,12795,13235,13675,14115,14555,14995] },
    'Ù†Ù‚ÙŠØ¨': { allowance: 495, salaries: [10600,11095,11590,12085,12580,13075,13570,13835,14100,14365,14630,14895,15160,15425,15690] },
    'Ø±Ø§Ø¦Ø¯': { allowance: 265, salaries: [13515,13780,14045,14310,14575,14840,15105,15370,15635,15900,16165,16430,16695,16960,17225] },
    'Ù…Ù‚Ø¯Ù…': { allowance: 470, salaries: [14645,15115,15585,16055,16525,16995,17465,17935,18405,18875,19345,19815,20285,20755] },
    'Ø¹Ù‚ÙŠØ¯': { allowance: 590, salaries: [16520,17110,17700,18290,18880,19470,20060,20650,21240,21830,22420,23010,23600] },
    'Ø¹Ù…ÙŠØ¯': { allowance: 650, salaries: [18800,19450,20100,20750,21400,22050,22700,23350,24000,24650,25300,25950] },
    'Ù„ÙˆØ§Ø¡': { allowance: 730, salaries: [21390,22120,22850,23580,24310,25040,25770,26500,27230,27960,28690] },
    // Ø§Ù„Ø£ÙØ±Ø§Ø¯
    'Ø¬Ù†Ø¯ÙŠ': { allowance: 130, salaries: [3220,3350,3480,3610,3740,3870,4000,4130,4260,4390,4520,4650,4780,4910,5040] },
    'Ø¬Ù†Ø¯ÙŠ Ø£ÙˆÙ„': { allowance: 145, salaries: [3395,3540,3685,3830,3975,4120,4265,4410,4555,4700,4845,4990,5135,5280,5425] },
    'Ø¹Ø±ÙŠÙ': { allowance: 175, salaries: [3765,3940,4115,4290,4465,4640,4815,4990,5165,5340,5515,5690,5865,6040,6215] },
    'ÙˆÙƒÙŠÙ„ Ø±Ù‚ÙŠØ¨': { allowance: 210, salaries: [4455,4665,4875,5085,5295,5505,5715,5925,6135,6345,6555,6765,6975,7185,7395] },
    'Ø±Ù‚ÙŠØ¨': { allowance: 250, salaries: [5260,5510,5760,6010,6260,6510,6760,7010,7260,7510,7760,8010,8260,8510,8760] },
    'Ø±Ù‚ÙŠØ¨ Ø£ÙˆÙ„': { allowance: 300, salaries: [6180,6480,6780,7080,7380,7680,7980,8280,8580,8880,9180,9480,9780,10080,10380] },
    'Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡': { allowance: 360, salaries: [7215,7575,7935,8295,8655,9015,9375,9735,10095,10455,10815,11175,11535,11895,12255] }
  };

  // ====== Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø­Ø§Ø³Ø¨Ø© ======
  let answers = { commitments: [] }, step = 0, commitmentStep = 0, currentCommitment = {};
  let hasStarted = false;

  const generalQuestions = [
    { id:'clientName',label:'ØªØ¹Ø±ÙÙ†Ø§ Ø¨Ø£Ø³Ù…Ùƒ  ',type:'text' },
    { id:'birthDate',label:'ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ Ù‡Ø¬Ø±ÙŠ\u2728',type:'birthdate' },
    { id:'jobType',label:'Ù†ÙˆØ¹ Ø§Ù„ÙˆØ¸ÙŠÙØ©',type:'select',options:['Ø¹Ø³ÙƒØ±ÙŠ','Ù…Ø¯Ù†ÙŠ (Ù‚Ø·Ø§Ø¹ Ø­ÙƒÙˆÙ…ÙŠ)','Ø®Ø§Øµ (Ø´Ø¨Ù‡ Ø­ÙƒÙˆÙ…ÙŠ)','Ø®Ø§Øµ (Ø´Ø±ÙƒØ© Ù…Ø¹ØªÙ…Ø¯Ø©)','Ø®Ø§Øµ (Ø´Ø±ÙƒØ© ØºÙŠØ± Ù…Ø¹ØªÙ…Ø¯Ø©)'] },
    {
      id:'militaryRank',
      label:'Ø§Ø°ÙƒØ± Ø§Ù„Ø±ØªØ¨Ø© Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ©',
      type:'select',
      options:[
        'Ø¬Ù†Ø¯ÙŠ','Ø¬Ù†Ø¯ÙŠ Ø£ÙˆÙ„','Ø¹Ø±ÙŠÙ','ÙˆÙƒÙŠÙ„ Ø±Ù‚ÙŠØ¨','Ø±Ù‚ÙŠØ¨','Ø±Ù‚ÙŠØ¨ Ø£ÙˆÙ„',
        'Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡','Ù…Ù„Ø§Ø²Ù…','Ù…Ù„Ø§Ø²Ù… Ø£ÙˆÙ„','Ù†Ù‚ÙŠØ¨','Ø±Ø§Ø¦Ø¯','Ù…Ù‚Ø¯Ù…','Ø¹Ù‚ÙŠØ¯','Ø¹Ù…ÙŠØ¯','Ù„ÙˆØ§Ø¡'
      ],
      show:a=>a.jobType==='Ø¹Ø³ÙƒØ±ÙŠ'
    },
    {
      id:'financeType',
      label:'Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ ØªØ±ÙŠØ¯ Ø­Ø³Ø¨ØªÙ‡:',
      type:'select',
      options:[
        'ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ',
        'ØªÙ…ÙˆÙŠÙ„ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ',
        'ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØªØ£Ø¬ÙŠØ±ÙŠ',
        'ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ',
        'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ',
        'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ',
        'Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥ØªÙ…Ø§Ù†',
        'ØªÙ…ÙˆÙŠÙ„ Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹',
        'ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª',
        'ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø£Ø³Ø·ÙˆÙ„'
      ]
    },
    {
      id:'mortgageProductType',
      label:'Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ',
      type:'select',
      options:[
        'ÙˆØ­Ø¯Ø© Ø¬Ø§Ù‡Ø²Ø© Ù…Ù† Ø§Ù„Ø³ÙˆÙ‚',
        'Ø¨Ù†Ø§Ø¡ Ø°Ø§ØªÙŠ',
        'Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø®Ø§Ø±Ø·Ø©',
        'ØªØ­Øª Ø§Ù„Ø§Ù†Ø´Ø§Ø¡ (Ø¨ÙŠØª ØªÙ…Ù„ÙƒÙ‡ Ø¹Ø¸Ù…)',
        'Ø§Ø±Ø¶ ÙˆÙ‚Ø±Ø¶ (Ø§Ø±Ø¶ ÙˆØ¨Ù†Ø§Ø¡ Ø°Ø§ØªÙŠ)',
        'Ø§Ø±Ø¶ (Ø³ÙƒÙ†ÙŠØ©)',
        'Ø±Ù‡Ù†'
      ],
      show:a=>a.financeType==='ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ'
    },
    { id:'supported',label:'Ù‡Ù„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¯Ø¹ÙˆÙ…ØŸ',type:'select',options:['Ù…Ø¯Ø¹ÙˆÙ…','ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…'],
      show:a=>a.financeType==='ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ' && ['ÙˆØ­Ø¯Ø© Ø¬Ø§Ù‡Ø²Ø© Ù…Ù† Ø§Ù„Ø³ÙˆÙ‚','Ø¨Ù†Ø§Ø¡ Ø°Ø§ØªÙŠ','Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø®Ø§Ø±Ø·Ø©','ØªØ­Øª Ø§Ù„Ø§Ù†Ø´Ø§Ø¡ (Ø¨ÙŠØª ØªÙ…Ù„ÙƒÙ‡ Ø¹Ø¸Ù…)','Ø§Ø±Ø¶ ÙˆÙ‚Ø±Ø¶ (Ø§Ø±Ø¶ ÙˆØ¨Ù†Ø§Ø¡ Ø°Ø§ØªÙŠ)'].includes(a.mortgageProductType)
    },
    {
      id:'isEtezaaz',
      label:'Ù‡Ù„ Ø£Ù†Øª Ù…Ù† Ù…Ù†Ø³ÙˆØ¨ÙŠ ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯ÙØ§Ø¹ (Ù…Ø¤Ù‡Ù„ Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ø¹ØªØ²Ø§Ø²)ØŸ',
      type:'select',
      options:['Ù†Ø¹Ù…','Ù„Ø§'],
      show:a=>a.financeType==='ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ' && a.supported==='Ù…Ø¯Ø¹ÙˆÙ…' && a.jobType==='Ø¹Ø³ÙƒØ±ÙŠ'
    },
    { id:'bundle',label:'Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø© Ù…Ù† Ø³ÙƒÙ†ÙŠØŸ',type:'select',options:['Ù†Ø¹Ù…','Ù„Ø§'],show:a=>a.supported==='Ù…Ø¯Ø¹ÙˆÙ…' },
    { id:'salary',label:'ÙƒÙ… Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„ØµØ§ÙÙŠØŸ',type:'number' },

    /* (Ø¥Ø¶Ø§ÙØ©) Ø¯Ù…Ø¬ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù…Ø¹ Ø§Ù„Ø±Ø§ØªØ¨ + Ø§Ø³ØªÙ‚Ø·Ø§Ø¹ 65% */
    {
      id:'includeSupportInSalary',
      label:'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§ØªØ¨ (Ù„Ù„Ø§Ø­ØªØ³Ø§Ø¨)ØŸ',
      type:'select',
      options:['Ù†Ø¹Ù…','Ù„Ø§'],
      show:a=>{
        const sal = parseFloat(a.salary || '0');
        return (a.financeType==='ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ' && a.supported==='Ù…Ø¯Ø¹ÙˆÙ…' && a.bundle==='Ù„Ø§' && sal > 0 && sal < 15000);
      }
    },

    /* (Ø¥Ø¶Ø§ÙØ©) Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù…Ù…ØªØ¯ Ù„Ù„Ø¹Ø³ÙƒØ±ÙŠ */
    {
      id:'extendAfterRetirement',
      label:'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù…ØªØ¯ Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø­ØªÙ‰ Ø¹Ù…Ø± 60 Ø³Ù†Ø©ØŸ',
      type:'select',
      options:['Ù†Ø¹Ù…','Ù„Ø§'],
      show:a=>{
        if(a.jobType!=='Ø¹Ø³ÙƒØ±ÙŠ') return false;
        if(!a.militaryRank) return false;
        const ft = a.financeType || '';
        const allowed = (ft==='ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ' || ft==='ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ' || ft==='ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØªØ£Ø¬ÙŠØ±ÙŠ' || ft==='Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ');
        if(!allowed) return false;

        const info = getMilitaryTimingInfoFromAnswers(a);
        // Ø´Ø±Ø·Ùƒ: Ø£Ù‚Ù„ Ù…Ù† 25 Ø³Ù†Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ + ÙˆÙÙŠÙ‡ ØªÙ…Ø¯ÙŠØ¯ Ø¥Ù„Ù‰ 60
        return (info.rankRemainingMonths > 0 && info.rankRemainingMonths <= (25*12) && info.monthsTo60 > info.rankRemainingMonths);
      }
    },
    { id:'appointDate',label:'ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ† (Ù‡Ø¬Ø±ÙŠ)âœ¨',type:'appointdate', show:a=>a.extendAfterRetirement==='Ù†Ø¹Ù…' },

    { id:'months',label:'Ø¹Ù„Ù‰ ÙƒÙ… Ø´Ù‡Ø± ØªØ±ÙŠØ¯ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ØŸ',type:'select',options:[],dynamic:true },
    { id:'calcMode',label:'ÙƒÙŠÙ ØªÙØ¶Ù‘Ù„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù†Ø³Ø¨Ø©ØŸ',type:'select',options:['Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Ø³Ø¨Ø© Ø¨Ù†ÙØ³ÙŠ','ØªØ±Ø´ÙŠØ­ Ø¨Ù†Ùƒ Ù…Ù†Ø§Ø³Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹'] },
    { id:'profitMargin',label:'Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø³Ù†ÙˆÙŠ (%)ØŸ',type:'number' },
    /* Ø³Ø¤Ø§Ù„ Ø§Ù„Ø¨Ù†Ùƒ - ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± "Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Ø³Ø¨Ø© Ø¨Ù†ÙØ³ÙŠ" */
    {
      id:'currentBank',
      label:'Ø§Ø°ÙƒØ± Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø°ÙŠ Ø¹Ù„ÙŠÙ‡ Ù‡Ø°Ù‡ Ø§Ù„Ù†Ø³Ø¨Ø©',
      type:'select',
      options:[
        'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ',
        'Ù…ØµØ±Ù Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ',
        'Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶',
        'Ø¨Ù†Ùƒ Ø³Ø§Ø¨',
        'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„ÙˆØ·Ù†ÙŠ',
        'Ù…ØµØ±Ù Ø§Ù„Ø¥Ù†Ù…Ø§Ø¡',
        'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ Ø§Ù„ÙØ±Ù†Ø³ÙŠ',
        'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ Ù„Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±',
        'Ø¨Ù†Ùƒ Ø§Ù„Ø¨Ù„Ø§Ø¯',
        'Ø¨Ù†Ùƒ Ø§Ù„Ø¬Ø²ÙŠØ±Ø©',
        'Ø¨Ù†Ùƒ Ø¢Ø®Ø±'
      ],
      show:a=>a.calcMode==='Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Ø³Ø¨Ø© Ø¨Ù†ÙØ³ÙŠ'
    },
    {
      id:'buyoutAmount',
      label:'ÙƒÙ… Ù…Ø¨Ù„Øº Ø§Ù„ØªØ³Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¨ÙƒØ± Ù„Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©)ØŸ',
      type:'number',
      show:a=>a.financeType==='Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ'
    },
    { id:'hasCommitments',label:'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØªØ²Ø§Ù…Ø§ØªØŸ',type:'select',options:['Ù†Ø¹Ù…','Ù„Ø§'] }
  ];

  const commitmentQuestions = [
    { id:'type',label:'Ù†ÙˆØ¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…',type:'select',options:['Ù‚Ø±Ø¶ Ø´Ø®ØµÙŠ','Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©','Ù‚Ø±Ø¶ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ','Ù‚Ø±Ø¶ Ø¹Ù‚Ø§Ø±ÙŠ'] },
    { id:'amount',label:'ÙƒÙ… Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠØŸ',type:'number' },
    { id:'months',label:'ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©ØŸ',type:'select',options:[],dynamic:true },
    { id:'balloon',label:'Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ø¯ÙØ¹Ø© Ø£Ø®ÙŠØ±Ø© (Ù„Ù‚Ø±Ø¶ Ø§Ù„Ø³ÙŠØ§Ø±Ø©)ØŸ',type:'select',options:['Ù†Ø¹Ù…','Ù„Ø§'],show:c=>c.type==='Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©' },
    { id:'balloonAmount',label:'ÙƒÙ… Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©ØŸ',type:'number',show:c=>c.balloon==='Ù†Ø¹Ù…' },
    { id:'more',label:'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø£Ø®Ø±Ù‰ØŸ',type:'select',options:['Ù†Ø¹Ù…','Ù„Ø§'] }
  ];

  function getRetirementAge(rank) {
    const retirementAges = {
      'Ø¬Ù†Ø¯ÙŠ': 44,'Ø¬Ù†Ø¯ÙŠ Ø£ÙˆÙ„': 44,'Ø¹Ø±ÙŠÙ': 46,'ÙˆÙƒÙŠÙ„ Ø±Ù‚ÙŠØ¨': 48,'Ø±Ù‚ÙŠØ¨': 50,'Ø±Ù‚ÙŠØ¨ Ø£ÙˆÙ„': 50,
      'Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡': 52,'Ù…Ù„Ø§Ø²Ù…': 44,'Ù…Ù„Ø§Ø²Ù… Ø£ÙˆÙ„': 44,'Ù†Ù‚ÙŠØ¨': 48,'Ø±Ø§Ø¦Ø¯': 50,'Ù…Ù‚Ø¯Ù…': 52,
      'Ø¹Ù‚ÙŠØ¯': 54,'Ø¹Ù…ÙŠØ¯': 56,'Ù„ÙˆØ§Ø¡': 58
    };
    return retirementAges[rank] || 60;
  }

  // (Ø¥Ø¶Ø§ÙØ©) Ø­Ø³Ø§Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯/Ø§Ù„Ù€60 Ù…Ù† Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ù‡Ø¬Ø±ÙŠ)
  function getMilitaryTimingInfoFromAnswers(a){
    const nowH = getHijriNowParts();
    const by = parseInt(a.birthYear || '0', 10);
    const bm = parseInt(a.birthMonth || '0', 10);
    const bd = parseInt(a.birthDay || '0', 10);

    const rankAge = getRetirementAge(a.militaryRank || 'Ø¬Ù†Ø¯ÙŠ');
    const retY = by + rankAge;
    const retM = bm;
    const retD = bd;

    const y60 = by + 60;
    const m60 = bm;
    const d60 = bd;

    const rankRemainingMonths = monthsDiffHijri(nowH.y, nowH.m, nowH.d, retY, retM, retD);
    const monthsTo60 = monthsDiffHijri(nowH.y, nowH.m, nowH.d, y60, m60, d60);

    return {
      nowH,
      birth:{y:by,m:bm,d:bd},
      rankAge,
      rankRemainingMonths,
      monthsTo60,
      rankRetHijriStr: `${retY}/${String(retM).padStart(2,'0')}/${String(retD).padStart(2,'0')}`
    };
  }

  function getMaxAllowedMonths(){
    const info = getMilitaryTimingInfoFromAnswers(answers);
    const by = info.birth.y;
    if(!by){ return 0; }

    let maxAge = 60;

    if(answers.jobType === 'Ø¹Ø³ÙƒØ±ÙŠ'){
      // Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø³Ù† Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø­Ø³Ø¨ Ø§Ù„Ø±ØªØ¨Ø©
      maxAge = info.rankAge;

      // Ø¥Ø°Ø§ Ø§Ø®ØªØ§Ø± Ø§Ù„Ù…Ù…ØªØ¯ -> Ù†Ø³Ù…Ø­ Ø­ØªÙ‰ 60 (Ø­Ø³Ø¨ Ø´Ø±Ø· Ø§Ù„Ø¸Ù‡ÙˆØ±)
      if(answers.extendAfterRetirement === 'Ù†Ø¹Ù…'){
        // Ù„Ø§ Ù†Ø²ÙŠØ¯ ÙÙˆÙ‚ 60
        maxAge = 60;
      }
    }

    // Ø­Ø³Ø§Ø¨ Ø£Ø´Ù‡Ø± Ù…ØªØ¨Ù‚ÙŠØ© Ø¨Ø¯Ù‚Ø© Ù‡Ø¬Ø±ÙŠØ§Ù‹ (Ø­ØªÙ‰ maxAge)
    const retY = by + maxAge;
    const retM = info.birth.m;
    const retD = info.birth.d;
    const remainingMonths = monthsDiffHijri(info.nowH.y, info.nowH.m, info.nowH.d, retY, retM, retD);

    answers.retirementYearHijri = retY;

    if(remainingMonths <= 0){
      showSorryPage(answers.clientName || "Ø§Ù„Ø¹Ù…ÙŠÙ„");
      return 0;
    }

    const isPersonal = answers.financeType && (
      answers.financeType.includes('Ø´Ø®ØµÙŠ') ||
      answers.financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ' ||
      answers.financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØªØ£Ø¬ÙŠØ±ÙŠ' ||
      answers.financeType === 'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ'
    );

    return Math.min(remainingMonths, isPersonal ? 60 : 360);
  }

  function describeMonths(m){
    const y = Math.floor(m / 12), mo = m % 12;
    let result = `${m} Ø´Ù‡Ø±`;
    let yTxt = y === 1 ? "Ø³Ù†Ø© ÙˆØ§Ø­Ø¯Ø©" : y === 2 ? "Ø³Ù†ØªØ§Ù†" : y >= 3 && y <= 10 ? `${y} Ø³Ù†ÙˆØ§Øª` : y > 10 ? `${y} Ø³Ù†Ø©` : '';
    let mTxt = mo === 1 ? "ÙˆØ´Ù‡Ø± ÙˆØ§Ø­Ø¯" : mo === 2 ? "ÙˆØ´Ù‡Ø±ÙŠÙ†" : mo >= 3 && mo <= 10 ? `Ùˆ${mo} Ø£Ø´Ù‡Ø±` : mo > 10 ? `Ùˆ${mo} Ø´Ù‡Ø±` : '';
    if (yTxt || mTxt) result += ` (${yTxt} ${mTxt})`;
    return result.trim();
  }

  function numberToArabicWords(n){
    if (n < 1000) return `${n} Ø±ÙŠØ§Ù„`;
    let parts = [];
    if(n >= 1_000_000){
      let mil = Math.floor(n / 1_000_000);
      parts.push(mil === 1 ? "Ù…Ù„ÙŠÙˆÙ†" : mil === 2 ? "Ù…Ù„ÙŠÙˆÙ†Ø§Ù†" : mil <= 10 ? `${mil} Ù…Ù„Ø§ÙŠÙŠÙ†` : `${mil} Ù…Ù„ÙŠÙˆÙ†`);
      n %= 1_000_000;
    }
    if(n >= 1000){
      let th = Math.floor(n / 1000);
      parts.push(th === 1 ? "Ø£Ù„Ù" : th === 2 ? "Ø£Ù„ÙØ§Ù†" : th <= 10 ? `${th} Ø¢Ù„Ø§Ù` : `${th} Ø£Ù„Ù`);
      n %= 1000;
    }
    if(n > 0) parts.push(`${n}`);
    return parts.join(" Ùˆ ") + " Ø±ÙŠØ§Ù„";
  }

  // Ø¯Ø¹Ù… Ø³ÙƒÙ†ÙŠ Ø´Ù‡Ø±ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ø¬Ø¯ÙˆÙ„ (20 Ø³Ù†Ø© = 240 Ø´Ù‡Ø±)
  function getHousingSupportMonthlyBySalary(salary){
    const s = Number(salary || 0);
    if (s <= 3000) return 1350;
    if (s <= 4000) return 1206;
    if (s <= 5000) return 1073;
    if (s <= 6000) return 955;
    if (s <= 7000) return 850;
    if (s <= 8000) return 757;
    if (s <= 9000) return 673;
    if (s <= 10000) return 599;
    return 416; // Ø£ÙƒØ«Ø± Ù…Ù† 10,000
  }

  function fmtMoney(n){
    const x = Number(n || 0);
    return x.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " Ø±ÙŠØ§Ù„";
  }
  function safeNum(v){
    const n = parseFloat(v);
    return isNaN(n) ? null : n;
  }

  function showSorryPage(name){
    showPage('calculator');
    const cont = document.getElementById('question');
    document.getElementById('nextButton').style.display = 'none';
    cont.innerHTML = `<div class="fade-in alert-error">
      <strong>Ù…Ø¹Ù„ÙŠØ´ ${name}ØŒ ÙŠØ¸Ù‡Ø± Ø¥Ù† Ø¹Ù…Ø±Ùƒ ØªØ¹Ø¯Ù‘Ù‰ Ø³Ù† Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ù„Ù„ØªÙ…ÙˆÙŠÙ„.</strong><br>
      Ø¥Ø°Ø§ ÙƒÙ†Øª Ù…ØªÙ‚Ø§Ø¹Ø¯ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±.
    </div>`;
  }

  function handleStartOrReset(){
    if(!hasStarted){
      hasStarted = true;
      document.getElementById('mainButton').style.display = 'none';
      document.getElementById('resetButtonContainer').style.display = 'block';
      document.getElementById('nextButton').style.display = 'inline-flex';
      showQuestion();
    }else{ resetCalc(); }
  }

  function resetCalc(){
    answers = { commitments: [] };
    step = 0;
    commitmentStep = 0;
    currentCommitment = {};
    hasStarted = true;
    document.getElementById('mainButton').style.display = 'none';
    document.getElementById('resetButtonContainer').style.display = 'block';
    document.getElementById('nextButton').style.display = 'inline-flex';
    showQuestion();
  }

  function showComingSoonForProduct(productName){
    const titleEl = document.getElementById('comingSoonTitle');
    const textEl = document.getElementById('comingSoonText');

    titleEl.textContent = productName || 'Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹';

    const msg = getFinanceProductMessage(productName);
    if(msg){
      textEl.innerHTML = `${escapeHtml(msg)}<br><br>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ ØªÙ…ÙˆÙŠÙ„ Ø¢Ø®Ø± Ù„Ù„Ø§Ø­ØªØ³Ø§Ø¨.`;
    } else if (productName === 'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ') {
      textEl.innerHTML = 'Ø­Ø§Ù„ÙŠØ§Ù‹ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ø­ØªØ³Ø§Ø¨ Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ© Ø¹Ø¨Ø± Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ø³Ø¨Ø©.<br>Ø³ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø¯Ù…Ø© ÙÙŠ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ø¥Ù† Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡ ğŸ™<br><br>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ ØªÙ…ÙˆÙŠÙ„ Ø¢Ø®Ø± Ù„Ù„Ø§Ø­ØªØ³Ø§Ø¨.';
    } else {
      textEl.innerHTML = 'Ù†Ø¹ØªØ°Ø± Ù…Ù†ÙƒØŒ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ù†Ø³Ø¨ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„Ù…Ù†ØµØ©.<br>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ø§Ø­ØªØ³Ø§Ø¨ ØªÙ…ÙˆÙŠÙ„ Ø¢Ø®Ø± Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ø²Ø± Ø£Ø¯Ù†Ø§Ù‡.';
    }
    showPage('comingSoon');
  }

  function showQuestion(){
    const cont = document.getElementById('question');
    cont.innerHTML = '';
    let q;

    if(step < generalQuestions.length){
      q = generalQuestions[step];

      // (Ø¥Ø¶Ø§ÙØ©) Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø®ÙŠØ§Ø±Ø§Øª Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± Ø§Ù„Ø´ÙƒÙ„)
      if(q.id === 'financeType'){
        q.options = getFinanceProductNames();
      }

      if(q.show && !q.show(answers)){ step++; showQuestion(); return; }

      // (Ø¥Ø¶Ø§ÙØ©) Ø¥Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -> ØµÙØ­Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹
      if(q.id === 'salary'){
        const ft = answers.financeType;
        if(ft && !isFinanceProductEnabled(ft)){
          showComingSoonForProduct(ft);
          return;
        }
      }

      if(q.id === 'salary' && (
        answers.financeType === 'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ' ||
        answers.financeType === 'Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥ØªÙ…Ø§Ù†' ||
        answers.financeType === 'ØªÙ…ÙˆÙŠÙ„ Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹' ||
        answers.financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª' ||
        answers.financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø£Ø³Ø·ÙˆÙ„'
      )){
        showComingSoonForProduct(answers.financeType);
        return;
      }

      if(q.id === 'profitMargin' && answers.calcMode === 'ØªØ±Ø´ÙŠØ­ Ø¨Ù†Ùƒ Ù…Ù†Ø§Ø³Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹'){
        const list = getMatchingBanksForAnswers();
        const rec = list[0];
        if(rec){
          answers.recommendedBank = rec;
          answers.profitMargin = rec.margin;
          step++;
          showQuestion();
          return;
        } else {
          alert('Ù„Ù„Ø§Ø³Ù Ø­Ø³Ø¨ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ø§ÙŠÙ…ÙƒÙ†Ù†Ø§ ØªØ±Ø´ÙŠØ­ Ø¨Ù†Ùƒ Ù…Ø¹ÙŠÙ‘Ù†    ØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙŠ ØªØ¯Ø®Ù„Ù‡Ø§ ÙŠØ¯ÙˆÙŠØ§Ù‹.');
        }
      }
    }else if(answers.hasCommitments === 'Ù†Ø¹Ù…'){
      q = commitmentQuestions[commitmentStep];
      if(q.show && !q.show(currentCommitment)){ commitmentStep++; showQuestion(); return; }
    }else{
      document.getElementById('nextButton').style.display = 'none';
      calculate();
      return;
    }

    const div = document.createElement('div');
    div.classList.add('fade-in');
    div.innerHTML = `<label>${q.label}</label>`;

    if(q.type === 'birthdate'){
      // ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ ÙÙŠ ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø©
      const bdDiv = document.createElement('div');
      bdDiv.style.cssText = 'display:flex;gap:10px;justify-content:center;flex-wrap:wrap;';
      
      // Ø§Ù„ÙŠÙˆÙ…
      const daySelect = document.createElement('select');
      daySelect.id = 'birthDay';
      daySelect.innerHTML = '<option value="">Ø§Ù„ÙŠÙˆÙ…</option>';
      for(let i=1;i<=30;i++) daySelect.innerHTML += `<option value="${i}">${i}</option>`;
      
      // Ø§Ù„Ø´Ù‡Ø±
      const monthSelect = document.createElement('select');
      monthSelect.id = 'birthMonth';
      const hijriMonths = ['1 - Ù…Ø­Ø±Ù…','2 - ØµÙØ±','3 - Ø±Ø¨ÙŠØ¹ Ø£ÙˆÙ„','4 - Ø±Ø¨ÙŠØ¹ Ø«Ø§Ù†ÙŠ','5 - Ø¬Ù…Ø§Ø¯Ù‰ Ø£ÙˆÙ„Ù‰','6 - Ø¬Ù…Ø§Ø¯Ù‰ Ø§Ù„Ø«Ø§Ù†ÙŠØ©','7 - Ø±Ø¬Ø¨','8 - Ø´Ø¹Ø¨Ø§Ù†','9 - Ø±Ù…Ø¶Ø§Ù†','10 - Ø´ÙˆØ§Ù„','11 - Ø°Ùˆ Ø§Ù„Ù‚Ø¹Ø¯Ø©','12 - Ø°Ùˆ Ø§Ù„Ø­Ø¬Ø©'];
      monthSelect.innerHTML = '<option value="">Ø§Ù„Ø´Ù‡Ø±</option>';
      hijriMonths.forEach((m,i) => monthSelect.innerHTML += `<option value="${i+1}">${m}</option>`);
      
      // Ø§Ù„Ø³Ù†Ø©
      const yearSelect = document.createElement('select');
      yearSelect.id = 'birthYear';
      yearSelect.innerHTML = '<option value="">Ø§Ù„Ø³Ù†Ø©</option>';
      for(let y=1430;y>=1370;y--) yearSelect.innerHTML += `<option value="${y}">${y}</option>`;
      
      bdDiv.appendChild(daySelect);
      bdDiv.appendChild(monthSelect);
      bdDiv.appendChild(yearSelect);
      div.appendChild(bdDiv);
      
      // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³Ù†Ø©
      yearSelect.addEventListener('change', function(){
        if(daySelect.value && monthSelect.value && yearSelect.value){
          answers.birthDay = daySelect.value;
          answers.birthMonth = monthSelect.value;
          answers.birthYear = yearSelect.value;
          step++;
          showQuestion();
        }
      });
    } else if(q.type === 'appointdate'){
      // ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ† ÙÙŠ ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø©
      const adDiv = document.createElement('div');
      adDiv.style.cssText = 'display:flex;gap:10px;justify-content:center;flex-wrap:wrap;';
      
      // Ø§Ù„ÙŠÙˆÙ…
      const daySelectA = document.createElement('select');
      daySelectA.id = 'appointDay';
      daySelectA.innerHTML = '<option value="">Ø§Ù„ÙŠÙˆÙ…</option>';
      for(let i=1;i<=30;i++) daySelectA.innerHTML += `<option value="${i}">${i}</option>`;
      
      // Ø§Ù„Ø´Ù‡Ø±
      const monthSelectA = document.createElement('select');
      monthSelectA.id = 'appointMonth';
      const hijriMonthsA = ['1 - Ù…Ø­Ø±Ù…','2 - ØµÙØ±','3 - Ø±Ø¨ÙŠØ¹ Ø£ÙˆÙ„','4 - Ø±Ø¨ÙŠØ¹ Ø«Ø§Ù†ÙŠ','5 - Ø¬Ù…Ø§Ø¯Ù‰ Ø£ÙˆÙ„Ù‰','6 - Ø¬Ù…Ø§Ø¯Ù‰ Ø§Ù„Ø«Ø§Ù†ÙŠØ©','7 - Ø±Ø¬Ø¨','8 - Ø´Ø¹Ø¨Ø§Ù†','9 - Ø±Ù…Ø¶Ø§Ù†','10 - Ø´ÙˆØ§Ù„','11 - Ø°Ùˆ Ø§Ù„Ù‚Ø¹Ø¯Ø©','12 - Ø°Ùˆ Ø§Ù„Ø­Ø¬Ø©'];
      monthSelectA.innerHTML = '<option value="">Ø§Ù„Ø´Ù‡Ø±</option>';
      hijriMonthsA.forEach((m,i) => monthSelectA.innerHTML += `<option value="${i+1}">${m}</option>`);
      
      // Ø§Ù„Ø³Ù†Ø©
      const yearSelectA = document.createElement('select');
      yearSelectA.id = 'appointYear';
      yearSelectA.innerHTML = '<option value="">Ø§Ù„Ø³Ù†Ø©</option>';
      const nowH = getHijriNowParts();
      for(let y=nowH.y;y>=nowH.y-40;y--) yearSelectA.innerHTML += `<option value="${y}">${y}</option>`;
      
      adDiv.appendChild(daySelectA);
      adDiv.appendChild(monthSelectA);
      adDiv.appendChild(yearSelectA);
      div.appendChild(adDiv);
      
      // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³Ù†Ø©
      yearSelectA.addEventListener('change', function(){
        if(daySelectA.value && monthSelectA.value && yearSelectA.value){
          answers.appointDay = daySelectA.value;
          answers.appointMonth = monthSelectA.value;
          answers.appointYear = yearSelectA.value;
          step++;
          showQuestion();
        }
      });
    } else if(q.type === 'select'){
      const sel = document.createElement('select');
      sel.id = q.id;
      sel.innerHTML = '<option value="">Ø§Ø®ØªØ±...</option>';

      if(q.dynamic && q.id === 'months'){
        const limit = (step < generalQuestions.length)
          ? getMaxAllowedMonths()
          : (currentCommitment.type === 'Ù‚Ø±Ø¶ Ø¹Ù‚Ø§Ø±ÙŠ' ? 360 : 60);
        for(let i=1; i<=limit; i++){
          sel.innerHTML += `<option value="${i}">${i} Ø´Ù‡Ø±</option>`;
        }
      } else if(q.dynamic && q.id === 'appointYear'){
        const nowH = getHijriNowParts();
        const start = Math.max(1300, nowH.y - 40);
        for(let y = nowH.y; y >= start; y--){
          sel.innerHTML += `<option value="${y}">${y}</option>`;
        }
      } else {
        q.options.forEach(opt => {
          sel.innerHTML += `<option value="${opt}">${opt}</option>`;
        });
      }
      div.appendChild(sel);
      
      // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ù‚ÙŠÙ…Ø©
      sel.addEventListener('change', function(){
        if(this.value){
          // Ø­ÙØ¸ Ø§Ù„Ù‚ÙŠÙ…Ø© ÙˆØ§Ù„Ø§Ù†ØªÙ‚Ø§Ù„
          if(step < generalQuestions.length){
            answers[q.id] = this.value;
            step++;
          } else {
            currentCommitment[q.id] = this.value;
            commitmentStep++;
          }
          showQuestion();
        }
      });
    } else {
      div.innerHTML += `<input type="${q.type}" id="${q.id}" ${q.default ? `value="${q.default}"` : ''}>`;
    }

    cont.appendChild(div);
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„ØªØ§Ù„ÙŠ ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø¶Ø±ÙˆØ±Ø© (Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù†ØµÙŠØ© ÙˆØ§Ù„Ø±Ù‚Ù…ÙŠØ© ÙˆØ§Ù„ØªÙˆØ§Ø±ÙŠØ®)
    const nextBtn = document.getElementById('nextButton');
    if(q.type === 'text' || q.type === 'number' || q.type === 'birthdate' || q.type === 'appointdate'){
      nextBtn.style.display = 'inline-flex';
    } else {
      nextBtn.style.display = 'none';
    }
  }

  function nextQuestion(){
    const q = step < generalQuestions.length ? generalQuestions[step] : commitmentQuestions[commitmentStep];
    
    // Ø¯Ø¹Ù… Ù†ÙˆØ¹ birthdate
    if(q.type === 'birthdate'){
      const day = document.getElementById('birthDay');
      const month = document.getElementById('birthMonth');
      const year = document.getElementById('birthYear');
      if(!day.value || !month.value || !year.value){
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ ÙƒØ§Ù…Ù„Ø§Ù‹');
        return;
      }
      answers.birthDay = day.value;
      answers.birthMonth = month.value;
      answers.birthYear = year.value;
      step++;
      showQuestion();
      return;
    }
    
    const el = document.getElementById(q.id);
    const val = el ? el.value : '';

    if(!val){
      alert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚Ù„ Ù‚Ø¨Ù„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©');
      return;
    }

    if(step < generalQuestions.length){
      answers[q.id] = val;

      if(q.id === 'financeType'){
        // (Ø¥Ø¶Ø§ÙØ©) Ù„Ùˆ Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„ Ø¹Ø¨Ø± Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -> ØµÙØ­Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹
        if(!isFinanceProductEnabled(val)){
          showComingSoonForProduct(val);
          return;
        }

        if(
          val === 'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ' ||
          val === 'Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥ØªÙ…Ø§Ù†' ||
          val === 'ØªÙ…ÙˆÙŠÙ„ Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹' ||
          val === 'ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª' ||
          val === 'ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø£Ø³Ø·ÙˆÙ„'
        ){
          showComingSoonForProduct(val);
          return;
        }
      }

      if(q.id === 'months'){
        const max = getMaxAllowedMonths();
        if(parseInt(val) > max){
          alert(`Ø£Ù‚ØµÙ‰ Ù…Ø¯Ø© Ù…Ø³Ù…ÙˆØ­Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù…Ø± ÙˆØ§Ù„ØªÙ‚Ø§Ø¹Ø¯: ${describeMonths(max)}.`);
          answers[q.id] = max.toString();
        }
      }
      step++;
    }else{
      if(q.id === 'months') currentCommitment[q.id] = parseInt(val);
      else if(q.id === 'amount' || q.id === 'balloonAmount') currentCommitment[q.id] = parseFloat(val);
      else currentCommitment[q.id] = val;

      if(q.id === 'more'){
        answers.commitments.push(currentCommitment);
        currentCommitment = {};
        if(val === 'Ù†Ø¹Ù…'){
          commitmentStep = 0;
          showQuestion();
          return;
        }else{
          document.getElementById('nextButton').style.display = 'none';
          calculate();
          return;
        }
      }
      commitmentStep++;
    }
    showQuestion();
  }

  // ====== Ø­Ø³Ø§Ø¨ Ø±Ø§ØªØ¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ Ø¨Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø±Ø³Ù…ÙŠØ© ======
  // Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©: (Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø§Ù„Ø£Ø®ÙŠØ± Ã— Ø¹Ø¯Ø¯ Ø£Ø´Ù‡Ø± Ø§Ù„Ø®Ø¯Ù…Ø©) Ã· 420
  function estimateMilitaryPensionFromAnswers(){
    // Ø¥Ø°Ø§ Ù…Ø§ ÙÙŠÙ‡ Ù…Ù…ØªØ¯ Ø£Ùˆ Ù…Ø§ ÙÙŠÙ‡ ØªØ§Ø±ÙŠØ® ØªØ¹ÙŠÙŠÙ† -> Ù†Ø±Ø¬Ø¹ ÙƒØ§Ø¦Ù† ÙØ§Ø±Øº
    if(answers.jobType !== 'Ø¹Ø³ÙƒØ±ÙŠ') return { pension: 0, formula: '' };
    if(answers.extendAfterRetirement !== 'Ù†Ø¹Ù…') return { pension: 0, formula: '' };

    const ad = parseInt(answers.appointDay || '0', 10);
    const am = parseInt(answers.appointMonth || '0', 10);
    const ay = parseInt(answers.appointYear || '0', 10);
    if(!ad || !am || !ay) return { pension: 0, formula: '' };

    const rank = answers.militaryRank || 'Ø¬Ù†Ø¯ÙŠ';
    const rankData = militarySalaryTable[rank];
    if(!rankData) return { pension: 0, formula: '' };

    const info = getMilitaryTimingInfoFromAnswers(answers);
    const nowH = getHijriNowParts();
    
    // Ø­Ø³Ø§Ø¨ Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙˆÙ…)
    const currentServiceMonths = monthsDiffHijri(ay, am, ad, nowH.y, nowH.m, nowH.d);
    const currentServiceYears = Math.floor(currentServiceMonths / 12);
    
    // ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ (Ø­Ø³Ø¨ Ø§Ù„Ø±ØªØ¨Ø©)
    const retY = info.birth.y + info.rankAge;
    const retM = info.birth.m;
    const retD = info.birth.d;
    
    // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø®Ø¯Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯
    const totalServiceMonths = monthsDiffHijri(ay, am, ad, retY, retM, retD);
    const totalServiceYears = Math.floor(totalServiceMonths / 12);
    
    // Ø§Ù„Ø³Ù†ÙˆØ§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù„Ù„ØªÙ‚Ø§Ø¹Ø¯
    const yearsToRetirement = totalServiceYears - currentServiceYears;
    
    // ØªØ­Ø¯ÙŠØ¯ Ø³Ù†Ø© Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ø±ØªØ¨Ø© (Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ Ø³Ù†Ø© 1 Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¹Ø±Ù)
    // Ù†ÙØªØ±Ø¶ Ø£Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙÙŠ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…Ù† Ø±ØªØ¨ØªÙ‡ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    // ÙˆÙ†Ø­Ø³Ø¨ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø¨Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù„Ø§ÙˆØ§Øª
    
    // Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰)
    const currentBasicSalary = rankData.salaries[0];
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯
    // Ù†Ø¶ÙŠÙ Ø§Ù„Ø¹Ù„Ø§ÙˆØ§Øª Ø§Ù„Ø³Ù†ÙˆÙŠØ© Ù„Ù„Ø³Ù†ÙˆØ§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
    let futureYearIndex = Math.min(yearsToRetirement, rankData.salaries.length - 1);
    let basicSalaryAtRetirement = rankData.salaries[futureYearIndex];
    
    // Ø¥Ø°Ø§ ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„ØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø¢Ø®Ø± Ø±Ø§ØªØ¨ + Ø§Ù„Ø¹Ù„Ø§ÙˆØ§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
    if(yearsToRetirement > rankData.salaries.length - 1){
      const extraYears = yearsToRetirement - (rankData.salaries.length - 1);
      basicSalaryAtRetirement = rankData.salaries[rankData.salaries.length - 1] + (extraYears * rankData.allowance);
    }
    
    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø±Ø§ØªØ¨ Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø±ØªØ¨Ø©
    const maxSalary = rankData.salaries[rankData.salaries.length - 1];
    basicSalaryAtRetirement = Math.min(basicSalaryAtRetirement, maxSalary + (10 * rankData.allowance));
    
    // Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø±Ø³Ù…ÙŠØ©: (Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø§Ù„Ø£Ø®ÙŠØ± Ã— Ø¹Ø¯Ø¯ Ø£Ø´Ù‡Ø± Ø§Ù„Ø®Ø¯Ù…Ø©) Ã· 420
    let pension = (basicSalaryAtRetirement * totalServiceMonths) / 420;
    
    // Ø§Ù„Ù…Ø¹Ø§Ø´ Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø§Ù„Ø£Ø®ÙŠØ±
    pension = Math.min(pension, basicSalaryAtRetirement);
    
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„
    const formula = `Ù…Ø¹Ø§Ø¯Ù„Ø© Ø­Ø³Ø§Ø¨ Ø±Ø§ØªØ¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯:
Ø§Ù„Ø±ØªØ¨Ø©: ${rank}
ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†: ${ay}/${String(am).padStart(2,'0')}/${String(ad).padStart(2,'0')}
Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${currentServiceYears} Ø³Ù†Ø©
Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø®Ø¯Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯: ${totalServiceYears} Ø³Ù†Ø© (${totalServiceMonths} Ø´Ù‡Ø±)
Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø³Ù†Ø© 1): ${currentBasicSalary.toLocaleString()} Ø±ÙŠØ§Ù„
Ø§Ù„Ø¹Ù„Ø§ÙˆØ© Ø§Ù„Ø³Ù†ÙˆÙŠØ©: ${rankData.allowance} Ø±ÙŠØ§Ù„
Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯: ${basicSalaryAtRetirement.toLocaleString()} Ø±ÙŠØ§Ù„

Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©: (Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø§Ù„Ø£Ø®ÙŠØ± Ã— Ø£Ø´Ù‡Ø± Ø§Ù„Ø®Ø¯Ù…Ø©) Ã· 420
= (${basicSalaryAtRetirement.toLocaleString()} Ã— ${totalServiceMonths}) Ã· 420
= ${pension.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±ÙŠØ§Ù„`;
    
    return {
      pension: Math.max(0, pension),
      basicSalaryAtRetirement,
      totalServiceMonths,
      totalServiceYears,
      currentServiceYears,
      yearsToRetirement,
      formula
    };
  }

  // ====== Ø§Ù„Ø­Ø³Ø¨Ø© ======
  function calculate(){
    const salary = parseFloat(answers.salary),
          months = parseInt(answers.months),
          years  = months / 12,
          financeType = answers.financeType,
          supported = answers.supported,
          bundle = answers.bundle;

    let profitMargin = parseFloat(answers.profitMargin);
    if (!profitMargin || isNaN(profitMargin)) {
      alert('Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ ØºÙŠØ± ØµØ­ÙŠØ­Ø©.');
      return;
    }

    const isBuyoutPersonal = financeType === 'Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ';
    const isConsumer = financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ';
    const isLeasing = financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØªØ£Ø¬ÙŠØ±ÙŠ';

    if(financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ' && !answers.supported){
      answers.supported = 'ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…';
    }

    const now = new Date();
    const dayNames = ['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'];
    const dayName = dayNames[now.getDay()];
    const y = now.getFullYear();
    const m = String(now.getMonth()+1).padStart(2,'0');
    const d = String(now.getDate()).padStart(2,'0');
    const hh = String(now.getHours()).padStart(2,'0');
    const mm = String(now.getMinutes()).padStart(2,'0');
    const ss = String(now.getSeconds()).padStart(2,'0');
    const calcDateTimeStr = `${dayName} ${y}-${m}-${d} ${hh}:${mm}:${ss}`;

    // ====== (Ø¥Ø¶Ø§ÙØ©) Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯/Ø§Ù„Ù…Ù…ØªØ¯ ======
    const timing = getMilitaryTimingInfoFromAnswers(answers);
    const isExtended = (answers.jobType === 'Ø¹Ø³ÙƒØ±ÙŠ' && answers.extendAfterRetirement === 'Ù†Ø¹Ù…');
    const preRetMonths = isExtended ? Math.min(months, timing.rankRemainingMonths) : months;
    const pensionResult = isExtended ? estimateMilitaryPensionFromAnswers() : { pension: 0, formula: '' };
    const pensionSalaryEst = pensionResult.pension;
    const retirementFormula = pensionResult.formula;

    // ==== Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ (Ù…ÙˆØ¬ÙˆØ¯ ÙƒÙ…Ø§ Ù‡Ùˆ) ====
    if (isConsumer) {
      const consumerInst = salary * 0.1167;
      const totalCommits = (answers.commitments || []).reduce((s,c)=> s + (c.amount || 0), 0);
      const maxAll = salary * 0.45;

      if (consumerInst + totalCommits > maxAll) {
        showPage('result');
        const name = answers.clientName || 'Ø§Ù„Ø¹Ù…ÙŠÙ„';
        const resultCard = document.getElementById('resultCard');
        resultCard.innerHTML = `
          <h2 style="margin:0 0 6px; font-size:18px; text-align:right; color:#111827;">
            Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø³Ø¨Ø© (Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©)
          </h2>
          <div style="font-size:12px; color:#6b7280; text-align:right; margin-bottom:4px;">
            ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„Ø­Ø³Ø¨Ø©: ${calcDateTimeStr}
          </div>
          <div class="result-header">
            <div class="client-chip">Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙˆÙ…Ø³Ù‡Ù„Ø§ ÙŠØ§ ${name}</div>
            <div style="text-align:right;">
              <span class="badge-mode">ØªÙ…ÙˆÙŠÙ„ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ - Ù†Ø¸Ø§Ù… 11.67%</span><br>
              <span class="badge-duration">Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„: ${describeMonths(months)}</span>
            </div>
          </div>
          <div class="alert-error">
            Ù†Ø¹ØªØ°Ø± Ù…Ù†ÙƒØŒ Ø­Ø³Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø© ÙØ¥Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ²Ø§Ù…Ø§ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ø¹ Ù‚Ø³Ø· Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ
            ÙŠØªØ¬Ø§ÙˆØ² 45% Ù…Ù† ØµØ§ÙÙŠ Ø§Ù„Ø±Ø§ØªØ¨ØŒ ÙˆÙ„Ø°Ù„Ùƒ Ù‚Ø¯ Ù„Ø§ ÙŠÙƒÙˆÙ† Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…ØªØ§Ø­Ø§Ù‹ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬.
          </div>
          <div style="margin-top:10px; font-size:13px; color:#6b7280; text-align:right;">
            ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¬Ø±Ø¨Ø© Ù†ÙˆØ¹ ØªÙ…ÙˆÙŠÙ„ Ø¢Ø®Ø± Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù‚Ø¨Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ.
          </div>
        `;

        answers._lastCalc = {
          calcDateTimeStr,
          clientName: name,
          financeType: financeType,
          durationText: describeMonths(months),
          months: months,
          recommendedBankName: 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
          finalNet: 0,
          netWithoutFees: 0,
          netAfterAdmin: 0,
          totalInst: 0,
          adminFee: 0,
          vat: 0,
          commodityFee: 0,
          supportSakaniAdded: 0,
          supportEtezaazAdded: 0,
          supportTotalAdded: 0,
          mainShownValue: 0,
          mainShownLabel: '',
          hasHousingSupport: false,
          housingSupportMonthly: 0,
          housingSupportTotalForLoan: 0,
          housingSupportLumpSum: 0,
          isEtezaaz: false,
          phases: []
        };
        return;
      }

      const totalInst = consumerInst * months;
      const profitFactor = (years * profitMargin / 100) + 1;
      const netFinance = totalInst / profitFactor;

      let adminFee = netFinance * 0.005;
      if (adminFee > 2500) adminFee = 2500;
      const vat = adminFee * 0.15;
      const commodityFee = netFinance * 0.01;

      const netWithoutFees = netFinance;
      const netAfterAdmin = netFinance - (adminFee + vat);
      const finalNet = netAfterAdmin - commodityFee;
      const totalProfitWithFees = totalInst - finalNet;

      const name = answers.clientName || "Ø§Ù„Ø¹Ù…ÙŠÙ„";
      const duration = describeMonths(months);
      const finalNetFixed = finalNet.toFixed(0);
      const netAfterAdminFixed = netAfterAdmin.toFixed(0);
      const netWithoutFeesFixed = netWithoutFees.toFixed(0);

      const matchingBanks = getMatchingBanksForAnswers();
      const recommendedBank = matchingBanks[0] || null;
      const altBanks = matchingBanks.slice(1, 4);
      answers.recommendedBank = answers.recommendedBank || recommendedBank;

      showPage('result');
      const resultCard = document.getElementById('resultCard');

      let html = '';
      html += `<h2 style="margin:0 0 6px; font-size:18px; text-align:right; color:#111827;">Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø³Ø¨Ø© (Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©)</h2>`;
      html += `<div style="font-size:12px; color:#6b7280; text-align:right; margin-bottom:4px;">ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„Ø­Ø³Ø¨Ø©: ${calcDateTimeStr}</div>`;
      html += `<div class="result-header">
        <div class="client-chip">Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙˆÙ…Ø³Ù‡Ù„Ø§ ÙŠØ§ ${name}</div>
        <div style="text-align:right;">
          <span class="badge-mode">ØªÙ…ÙˆÙŠÙ„ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ - Ù†Ø¸Ø§Ù… 11.67%</span><br>
          <span class="badge-duration">Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„: ${duration}</span>
        </div>
      </div>`;

      if (recommendedBank) {
        const b = recommendedBank;
        const logoSrc = bankLogoMap[b.bankName];
        html += `<div class="bank-card">
          <div class="bank-logo">${logoSrc ? `<img src="${logoSrc}" alt="${b.bankName}">` : 'ğŸ¦'}</div>
          <div style="text-align:right">
            <div class="bank-text-main">${b.bankName}</div>
            <div class="bank-text-sub">ØªÙ… ØªØ±Ø´ÙŠØ­ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù†Ùƒ/Ø§Ù„Ø´Ø±ÙƒØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø±Ø§ØªØ¨Ùƒ ÙˆÙ†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø¨Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø±Ø¨Ø­ ØªÙ‚Ø±ÙŠØ¨ÙŠØ©: <strong>${b.margin}%</strong></div>
          </div>
        </div>`;
      }

      const monthlyInstFixed = consumerInst.toFixed(0);

      html += `
        <div class="result-main-block">
          <div class="result-main-title">ğŸ’³ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ </div>
          <div class="result-amount-main">${finalNetFixed.replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±ÙŠØ§Ù„</div>
          <div class="result-amount-sub">Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø© ÙˆØ±Ø³ÙˆÙ… Ø§Ù„Ø³Ù„Ø¹.</div>

          <div class="dual-main-grid">
            <div class="dual-box">
              <div class="dual-box-title">Ø§Ù„ØµØ§ÙÙŠ Ù‚Ø¨Ù„ Ø£ÙŠ Ø±Ø³ÙˆÙ…</div>
              <div class="dual-box-amount">${netWithoutFeesFixed.replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±.Ø³</div>
            </div>
            <div class="dual-box">
              <div class="dual-box-title">Ø¨Ø¹Ø¯ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© + Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© ÙÙ‚Ø·</div>
              <div class="dual-box-amount">${netAfterAdminFixed.replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±.Ø³</div>
            </div>
          </div>

          <div style="margin-top:8px; font-size:13px; color:#374151;">
            Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ Ù…ÙƒØªÙˆØ¨ Ø¨Ø§Ù„Ø­Ø±ÙˆÙ: <strong>${numberToArabicWords(parseInt(finalNetFixed))}</strong>
          </div>

          <div class="result-amount-small" style="margin-top:4px;">
            Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ (11.67% Ù…Ù† Ø§Ù„Ø±Ø§ØªØ¨): <strong>${monthlyInstFixed.replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±ÙŠØ§Ù„</strong>
          </div>

          <div class="result-amount-small" style="margin-top:2px;">
            Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…Ø­ØªØ³Ø¨Ø©: <strong>${profitMargin}% Ø³Ù†ÙˆÙŠØ§Ù‹</strong>
          </div>
        </div>
      `;

      html += `
        <div class="result-section-title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</div>
        <div class="result-section-box">
          <div class="instalment-row">
            Ø§Ù„Ù‚Ø³Ø· Ù…Ù† Ø§Ù„Ø´Ù‡Ø± <strong>1</strong> Ø¥Ù„Ù‰ <strong>${months}</strong>:
            <strong>${monthlyInstFixed.replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±ÙŠØ§Ù„</strong>
          </div>
        </div>
      `;

      if (altBanks.length > 0) {
        html += `
          <div class="result-section-title">Ø¨Ù†ÙˆÙƒ/Ø´Ø±ÙƒØ§Øª Ø£Ø®Ø±Ù‰ Ù…Ù†Ø§ÙØ³Ø©</div>
          <div class="result-section-box">
            <ul style="margin:0; padding-right:16px; font-size:13px; color:#4b5563; list-style-type:disc; text-align:right;">
        `;
        altBanks.forEach(b => {
          html += `<li>${b.bankName} - Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø±Ø¨Ø­ ØªÙ‚Ø±ÙŠØ¨ÙŠØ©: <strong>${b.margin}%</strong></li>`;
        });
        html += `</ul></div>`;
      }

      html += `
        <div class="result-section-title">Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø±Ø³ÙˆÙ…</div>
        <div class="result-section-box">
          <div class="instalment-row">Ø§Ù„Ø±Ø¨Ø­ Ø¯ÙˆÙ† Ø§Ù„Ø±Ø³ÙˆÙ…: <strong>${(totalInst - netWithoutFees).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±ÙŠØ§Ù„</strong></div>
          <div class="instalment-row">Ø§Ù„Ø±Ø¨Ø­ Ù…Ø¹ Ø§Ù„Ø±Ø³ÙˆÙ…: <strong>${totalProfitWithFees.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±ÙŠØ§Ù„</strong></div>
          <div class="instalment-row">
            Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©: <strong>${adminFee.toFixed(0)} Ø±ÙŠØ§Ù„</strong>
            <div class="vat-small">(Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø§Ø¯Ø§Ø±ÙŠØ©): ${vat.toFixed(0)} Ø±ÙŠØ§Ù„</div>
            + Ø±Ø³ÙˆÙ… Ø§Ù„Ø³Ù„Ø¹: <strong>${commodityFee.toFixed(0)} Ø±ÙŠØ§Ù„</strong>
          </div>
          <div class="instalment-row">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ : <strong>${totalInst.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±ÙŠØ§Ù„</strong></div>
        </div>

        <div style="margin-top:10px; font-size:13px; color:#6b7280; text-align:right;">
          âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø³Ø¨Ø© ØªÙ‚Ø±ÙŠØ¨ÙŠØ© ØŒ ÙˆØ§Ù„Ù†Ø³Ø¨ Ø§Ù„ÙØ¹Ù„ÙŠØ© ÙˆÙ…Ù†Ø­ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø¬Ù‡Ù‡ Ø§Ù„Ù…Ù…ÙˆÙ„Ø© ÙˆÙ‚Øª ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨.
          ğŸ”ºØªÙ†ÙˆÙŠØ©/Ù†Ø­Ù† Ù„Ø³Ù†Ø§ Ø¬Ù‡Ø© ØªÙ…ÙˆÙŠÙ„ÙŠØ©ØŒ Ø¯ÙˆØ±Ù†Ø§ Ø§Ù„ÙˆØ³Ø§Ø·Ø© Ùˆ Ù†Ù†Ø¬Ø²Ùƒ Ù…Ø¹ Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ© Ø§Ù„Ø§ÙØ¶Ù„ Ø¨Ø£Ø³Ø±Ø¹ ÙˆÙ‚Øª ÙˆØ¨Ø¯ÙˆÙ† ØªØ¹Ù‚ÙŠØ¯Ø§Øª .
        </div>
        <div style="margin-top:8px; font-size:14px; font-weight:bold; color:#1e3a8a; text-align:center;">
          ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ ğŸ“ 0506214458
        </div>
      `;

      resultCard.innerHTML = html;
      
      // Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø®Ø§ØµØ©
      showSpecialOffers(financeType, Number(finalNetFixed));
      
      // Ø¹Ø±Ø¶ Ù‚Ø³Ù… Ø§Ù„ØªØ³ÙˆÙŠÙ‚ ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ…
      updateMarketingAndRatingDisplay();

      answers._lastCalc = {
        calcDateTimeStr,
        clientName: name,
        financeType: financeType,
        durationText: duration,
        months: months,
        recommendedBankName: (recommendedBank && recommendedBank.bankName) ? recommendedBank.bankName : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
        finalNet: Number(finalNetFixed),
        netWithoutFees: Number(netWithoutFeesFixed),
        netAfterAdmin: Number(netAfterAdminFixed),
        totalInst: Number(totalInst.toFixed(0)),
        adminFee: Number(adminFee.toFixed(0)),
        vat: Number(vat.toFixed(0)),
        commodityFee: Number(commodityFee.toFixed(0)),
        supportSakaniAdded: 0,
        supportEtezaazAdded: 0,
        supportTotalAdded: 0,
        mainShownValue: Number(finalNetFixed),
        mainShownLabel: 'Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ',
        hasHousingSupport: false,
        housingSupportMonthly: 0,
        housingSupportTotalForLoan: 0,
        housingSupportLumpSum: 0,
        isEtezaaz: false,
        phases: [{from:1,to:months,inst: Number(monthlyInstFixed)}]
      };
      return;
    }

    // ==== Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Ø´Ø®ØµÙŠ/ØªØ£Ø¬ÙŠØ±ÙŠ/Ø¹Ù‚Ø§Ø±ÙŠ/Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø´Ø®ØµÙŠ) ====
    const isPersonalLike = (financeType && (financeType.includes('Ø´Ø®ØµÙŠ') || isLeasing)) || isBuyoutPersonal;
    const isMortgage = financeType && financeType.includes('Ø¹Ù‚Ø§Ø±ÙŠ');

    let deductionRate = 0, addCommodityFee = false;

    // (Ø¥Ø¶Ø§ÙØ©) Ø¯Ø¹Ù… Ø³ÙƒÙ†ÙŠ Ø´Ù‡Ø±ÙŠ (Ù…Ø¤Ù‚Øª) ÙÙ‚Ø· Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ ÙÙŠ Ø¯Ù…Ø¬ Ø§Ù„Ø±Ø§ØªØ¨
    const housingSupportMonthlyTmp = (financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ' && supported === 'Ù…Ø¯Ø¹ÙˆÙ…' && bundle === 'Ù„Ø§')
      ? getHousingSupportMonthlyBySalary(salary)
      : 0;

    // (Ø¥Ø¶Ø§ÙØ©) Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ø§Ø³ØªÙ‚Ø·Ø§Ø¹ Ù‚Ø¨Ù„ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ (Ù‚Ø¯ ÙŠØ¯Ù…Ø¬ Ø§Ù„Ø¯Ø¹Ù…)
    let salaryForDeductionPre = salary;

    if(isPersonalLike){
      if(months > 60){ alert('Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠ / Ø§Ù„ØªØ£Ø¬ÙŠØ±ÙŠ Ù„Ø§ ØªØªØ¬Ø§ÙˆØ² 60 Ø´Ù‡Ø±'); return; }
      deductionRate = 45;
      addCommodityFee = true;
    }else if(isMortgage){
      // (Ø¥Ø¶Ø§ÙØ©) Ø¥Ø°Ø§ Ø±Ø§ØªØ¨ < 15000 + Ø¯Ø¹Ù… Ø´Ù‡Ø±ÙŠ + Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ø®ØªØ§Ø± Ø¯Ù…Ø¬ Ø§Ù„Ø¯Ø¹Ù… -> 65% Ø¹Ù„Ù‰ (Ø§Ù„Ø±Ø§ØªØ¨ + Ø§Ù„Ø¯Ø¹Ù…)
      if(answers.includeSupportInSalary === 'Ù†Ø¹Ù…' && salary < 15000 && supported === 'Ù…Ø¯Ø¹ÙˆÙ…' && bundle === 'Ù„Ø§'){
        deductionRate = 65;
        salaryForDeductionPre = salary + housingSupportMonthlyTmp;
      } else {
        if(supported === 'Ù…Ø¯Ø¹ÙˆÙ…'){
          if(answers.isEtezaaz === 'Ù†Ø¹Ù…'){
            deductionRate = 65;
          } else if(bundle === 'Ù„Ø§'){
            deductionRate = 65;
          } else {
            deductionRate = salary < 15000 ? 55 : 65;
          }
        }else{
          deductionRate = salary < 15000 ? 55 : 65;
        }
      }
    }

    // (Ø¥Ø¶Ø§ÙØ©) Ø§Ù„Ø§Ø³ØªÙ‚Ø·Ø§Ø¹ Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯:
    // - Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ: Ù†ÙØ³ Ø§Ù„Ù†Ø³Ø¨Ø© Ù„ÙƒÙ† Ø¹Ù„Ù‰ Ø±Ø§ØªØ¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯
    // - Ø§Ù„Ø´Ø®ØµÙŠ/Ø§Ù„ØªØ£Ø¬ÙŠØ±ÙŠ/Ø´Ø±Ø§Ø¡ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø§Ù„Ø´Ø®ØµÙŠ: 25% Ø¹Ù„Ù‰ Ø±Ø§ØªØ¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯
    const postDeductionRate = (isPersonalLike && isExtended) ? 25 : deductionRate;

    let allowedInstPre = salaryForDeductionPre * deductionRate / 100;
    let allowedInstPost = (isExtended ? (pensionSalaryEst * postDeductionRate / 100) : allowedInstPre);

    let commits = [...answers.commitments].sort((a,b)=>parseInt(a.months)-parseInt(b.months));
    let balloonPhases = [];

    commits.forEach((c) => {
      if (c.type === 'Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©' && c.balloon === 'Ù†Ø¹Ù…' && c.balloonAmount) {
        const start = parseInt(c.months);
        const end = start + 24;
        balloonPhases.push({ start, end, value: c.balloonAmount / 24 });
      }
    });

    let futurePhases = [];
    for(let mmx = 1; mmx <= months; mmx++) {
      let activeCommits = commits
        .filter(c => mmx <= parseInt(c.months))
        .reduce((sum, c) => sum + (c.amount || 0), 0);

      let balloonExtra = balloonPhases.reduce((sum, b) =>
        (mmx >= b.start && mmx < b.end) ? sum + b.value : sum, 0);

      // (Ø¥Ø¶Ø§ÙØ©) ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ‚Ø·Ø§Ø¹ Ø­Ø³Ø¨ Ù‚Ø¨Ù„/Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ù„Ù„Ù…Ù…ØªØ¯
      const monthAllowed = (isExtended && mmx > preRetMonths) ? allowedInstPost : allowedInstPre;

      let available = monthAllowed - activeCommits - balloonExtra;

      if(isPersonalLike){
        // (Ø¥Ø¶Ø§ÙØ©) Ø­Ø¯ 33.33% Ù‚Ø¨Ù„ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§ØªØ¨ØŒ ÙˆØ¨Ø¹Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø¹Ù„Ù‰ Ø±Ø§ØªØ¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ (Ù„Ùˆ Ù…Ù…ØªØ¯)
        const baseForCap = (isExtended && mmx > preRetMonths) ? (pensionSalaryEst || 0) : salary;
        available = Math.min(available, baseForCap * 0.3333);
      }
      futurePhases.push({ month: mmx, inst: available });
    }

    let finalPhases = [];
    for (let i = 0; i < futurePhases.length; i++) {
      if (i === 0 || futurePhases[i].inst !== finalPhases[finalPhases.length - 1]?.inst) {
        finalPhases.push({ from: futurePhases[i].month, to: futurePhases[i].month, inst: futurePhases[i].inst });
      } else {
        finalPhases[finalPhases.length - 1].to = futurePhases[i].month;
      }
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù‚ÙŠÙ… Ø³Ø§Ù„Ø¨Ø© ÙÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· (Ø¹Ø¬Ø²)
    const hasNegativeInstalment = finalPhases.some(p => p.inst < 0);
    const minInstalment = Math.min(...finalPhases.map(p => p.inst));
    
    const totalInst = finalPhases.reduce((s,p)=>s + p.inst * (p.to - p.from + 1), 0);
    const profitFactor = (years * profitMargin / 100) + 1;
    const netFinance = totalInst / profitFactor;

    let adminFee = 0, vat = 0;
    if (isPersonalLike) {
      adminFee = netFinance * 0.005;
      if (adminFee > 2500) adminFee = 2500;
      vat = adminFee * 0.15;
    } else {
      adminFee = netFinance * 0.01;
      vat = adminFee * 0.15;
      if(adminFee + vat > 5750){ adminFee = 5000; vat = 750; }
    }

    const commodityFee = addCommodityFee ? netFinance * 0.01 : 0;

    const netWithoutFees = netFinance;
    const netAfterAdmin = netFinance - (adminFee + vat);
    const finalNet = netAfterAdmin - commodityFee;
    const totalProfitWithFees = totalInst - finalNet;

    // âœ… Ø¯Ø¹Ù… Ø³ÙƒÙ†ÙŠ/Ø§Ø¹ØªØ²Ø§Ø² (Ø§Ø¹ØªØ²Ø§Ø² Ø«Ø§Ø¨Øª 160,000 ÙˆÙ„Ø§ ÙŠØªØ¹Ø§Ø±Ø¶)
    const ETEZAAZ_FIXED = 160000;

    let supportText = '';
    let housingSupportMonthly = 0;
    let housingSupportTotalForLoan = 0;
    let housingSupportLumpSum = 0;

    let supportSakaniAdded = 0;
    let supportEtezaazAdded = 0;

    if(financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ' && supported === 'Ù…Ø¯Ø¹ÙˆÙ…'){
      if (bundle === 'Ù„Ø§') {
        housingSupportMonthly = getHousingSupportMonthlyBySalary(salary);
        const dist = Math.min(months, 240);
        housingSupportTotalForLoan = housingSupportMonthly * dist;
        supportSakaniAdded = housingSupportTotalForLoan;

        supportText += `
          <div class="support-panel">
            <div class="support-title">âœ… Ø¯Ø¹Ù… Ø³ÙƒÙ†ÙŠ (Ø´Ù‡Ø±ÙŠ) Ø­Ø³Ø¨ Ù…ØµÙÙˆÙØ© Ø§Ù„Ø¯Ø¹Ù…</div>
            <div class="support-row"><span>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø´Ù‡Ø±ÙŠ</span><strong>${fmtMoney(housingSupportMonthly)}</strong></div>
            <div class="support-row"><span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø¹Ù… Ø­ØªÙ‰ ${dist} Ø´Ù‡Ø±</span><strong>${fmtMoney(housingSupportTotalForLoan)}</strong></div>
            <div class="support-badge">ğŸŸ¢ ÙŠØªÙ… ØµØ±Ù Ø§Ù„Ø¯Ø¹Ù… Ø´Ù‡Ø±ÙŠØ§Ù‹</div>
          </div>
        `;
      } else {
        // ØªÙ‚Ø¯ÙŠØ±ÙŠ ÙƒÙ…Ø§ ÙƒØ§Ù†
        const sup = salary < 10000 ? 150000 : 100000;
        housingSupportLumpSum = sup;
        supportSakaniAdded = sup;

        supportText += `
          <div class="support-panel">
            <div class="support-title">âœ… Ø¯Ø¹Ù… Ø³ÙƒÙ†ÙŠ </div>
            <div class="support-row" style="border-bottom:none;"><span>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ©</span><strong>${fmtMoney(sup)}</strong></div>
          </div>
        `;
      }

      if (answers.isEtezaaz === 'Ù†Ø¹Ù…') {
        supportEtezaazAdded = ETEZAAZ_FIXED;
        supportText += `
          <div class="support-panel" style="margin-top:8px;">
            <div class="support-title">ğŸ›¡ï¸ Ø¯Ø¹Ù… Ø§Ø¹ØªØ²Ø§Ø² (ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯ÙØ§Ø¹)</div>
            <div class="support-row"><span>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¯Ø¹Ù… (Ø«Ø§Ø¨Øª)</span><strong>${fmtMoney(ETEZAAZ_FIXED)}</strong></div>
            <div class="support-row" style="border-bottom:none;"><span>Ù…Ù„Ø§Ø­Ø¸Ø©</span><strong>Ø¯Ø¹Ù… Ø¥Ø¶Ø§ÙÙŠ Ù…Ø³ØªÙ‚Ù„ Ù„Ø§ ÙŠØªØ¹Ø§Ø±Ø¶ Ù…Ø¹ Ø¯Ø¹Ù… Ø³ÙƒÙ†ÙŠ</strong></div>
            <div class="support-badge">â³ ØªØ¨Ø¯Ø£ Ø§Ù„Ø§Ù‚Ø³Ø§Ø· Ø¨Ø¹Ø¯ Ø³Ù†ØªÙŠÙ†</div>
          </div>
        `;
      }
    }

    const supportTotalAdded = (supportSakaniAdded || 0) + (supportEtezaazAdded || 0);

    const name = answers.clientName || "Ø§Ù„Ø¹Ù…ÙŠÙ„";
    const duration = describeMonths(months);
    const finalNetFixed = finalNet.toFixed(0);
    const netAfterAdminFixed = netAfterAdmin.toFixed(0);
    const netWithoutFeesFixed = netWithoutFees.toFixed(0);

    const allNegative = finalPhases.every(p => p.inst <= 0);

    const buyoutAmount = isBuyoutPersonal ? parseFloat(answers.buyoutAmount || '0') : 0;
    const netAfterBuyout = finalNet - buyoutAmount;

    const matchingBanks = getMatchingBanksForAnswers();
    const recommendedBank = matchingBanks[0] || null;
    const altBanks = matchingBanks.slice(1, 4);
    answers.recommendedBank = answers.recommendedBank || recommendedBank;

    // ====== MAIN DISPLAY VALUE Ø­Ø³Ø¨ Ø·Ù„Ø¨Ùƒ ======
    let mainShownValue = Number(finalNetFixed);
    let mainShownLabel = 'Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ';

    // (1) Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ:   = ØµØ§ÙÙŠ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ + Ø§Ù„Ø¯Ø¹Ù… (Ù„ÙƒÙ† Ù„Ø§ ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø¹Ù„Ù‰ Ø§Ù„ØµØ§ÙÙŠ)
    if(isMortgage){
      const supportAddedToNet = Number(supportEtezaazAdded || 0) + (housingSupportMonthly > 0 ? 0 : Number(supportSakaniAdded || 0));
      mainShownValue = Number(finalNetFixed) + supportAddedToNet;
      mainShownLabel = supportAddedToNet > 0 ? 'ØµØ§ÙÙŠ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¶Ø§Ù Ù„Ù‡ Ø§Ù„Ø¯Ø¹Ù…' : 'Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ';
    }

    // (2) Ø´Ø±Ø§Ø¡ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø§Ù„Ø´Ø®ØµÙŠ:  = Ù…Ø§ ÙŠØµÙÙŠ Ù„Ù„Ø¹Ù…ÙŠÙ„
    if(isBuyoutPersonal && buyoutAmount > 0){
      mainShownValue = Number(netAfterBuyout.toFixed(0));
      mainShownLabel = 'Ù…Ø§ ÙŠØµÙÙŠ Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ø¹Ø¯ Ø³Ø¯Ø§Ø¯ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù‚Ø¯ÙŠÙ…';
    }

    showPage('result');
    const resultCard = document.getElementById('resultCard');
    let html = '';

    // Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ‚Øª
    const hour = new Date().getHours();
    let greetEmoji = 'ğŸŒ…';
    let greetText = 'ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±';
    if (hour >= 12 && hour < 17) { greetEmoji = 'â˜€ï¸'; greetText = 'Ù…Ø³Ø§Ø¡ Ø§Ù„Ù†ÙˆØ±'; }
    else if (hour >= 17 && hour < 21) { greetEmoji = 'ğŸŒ‡'; greetText = 'Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±'; }
    else if (hour >= 21 || hour < 5) { greetEmoji = 'ğŸŒ™'; greetText = 'Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ø§Ù„Ù„ÙŠÙ„'; }
    
    // Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø§Ù„Ø¹ØµØ±ÙŠØ©
    html += `
      <div class="result-greeting-card">
        <div class="result-greeting-emoji">${greetEmoji}</div>
        <div class="result-greeting-text">Ø£Ø±Ø­Ø¨ ÙŠØ§ ${name}! ${greetText}</div>
        <div class="result-greeting-sub">ğŸ‰ Ø®Ù„ØµÙ†Ø§ Ø§Ù„Ø­Ø³Ø¨Ø© ÙˆØ¬Ø§Ùƒ Ø§Ù„Ø®Ø¨Ø± Ø§Ù„Ø­Ù„Ùˆ!</div>
      </div>
    `;
    
    // Ø±Ø³Ø§Ù„Ø© ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ø¹Ø¬Ø² ÙÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
    if (hasNegativeInstalment) {
      html += `
        <div style="background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); border: 2px solid #ef4444; border-radius: 16px; padding: 20px; margin-bottom: 16px; text-align: center;">
          <div style="font-size: 40px; margin-bottom: 10px;">âš ï¸</div>
          <div style="font-size: 18px; font-weight: 800; color: #dc2626; margin-bottom: 8px;">Ù„Ù„Ø£Ø³Ù ÙŠØ§ ${name} Ù…Ø¹Ù„ÙŠØ´!</div>
          <div style="font-size: 15px; color: #991b1b; line-height: 1.8;">
            Ø¹Ù†Ø¯Ùƒ Ø¹Ø¬Ø² Ø¨Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø£Ùˆ Ø§Ù„ØªØ²Ø§Ù…Ø§ØªÙƒ Ù„Ø§ ØªØ³Ù…Ø­ Ø¨Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„ØªÙ…ÙˆÙŠÙ„.<br>
            <strong>Ø§Ù„Ø¹Ø¬Ø² Ø§Ù„Ø´Ù‡Ø±ÙŠ: ${Math.abs(minInstalment).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±ÙŠØ§Ù„</strong><br>
            <span style="font-size: 13px;">ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø£Ùˆ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù†ØªÙ‡Ø§Ø¡ Ø¨Ø¹Ø¶ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª.</span>
          </div>
        </div>
      `;
    }
    
    html += `<div style="font-size:13px; color:#64748b; text-align:right; margin-bottom:8px;">ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„Ø­Ø³Ø¨Ø©: ${calcDateTimeStr}</div>`;

    html += `<div class="result-header">
      <div class="client-chip">ğŸ‘¤ ${name}</div>
      <div style="text-align:right;">
        <span class="badge-mode">${answers.calcMode === 'ØªØ±Ø´ÙŠØ­ Ø¨Ù†Ùƒ Ù…Ù†Ø§Ø³Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹' ? 'ğŸ¦ ØªØ±Ø´ÙŠØ­ Ø¨Ù†Ùƒ Ù…Ù†Ø§Ø³Ø¨' : 'ğŸ“Š Ø§Ù„Ø­Ø³Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¯Ø®Ù„Ø©'}</span><br>
        <span class="badge-duration">ğŸ“… Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„: ${duration}</span>
      </div>
    </div>`;

    html += `<div style="display:flex; justify-content:flex-end; margin:6px 0 10px;">
      <span class="badge-duration">ğŸ’³ Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„: ${financeType}</span>
    </div>`;

    if (recommendedBank) {
      const b = recommendedBank;
      const logoSrc = bankLogoMap[b.bankName];
      html += `<div class="bank-card">
        <div class="bank-logo">${logoSrc ? `<img src="${logoSrc}" alt="${b.bankName}">` : 'ğŸ¦'}</div>
        <div style="text-align:right">
          <div class="bank-text-main">${b.bankName}</div>
          <div class="bank-text-sub">ØªÙ… ØªØ±Ø´ÙŠØ­ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù†Ùƒ/Ø§Ù„Ø´Ø±ÙƒØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø±Ø§ØªØ¨Ùƒ ÙˆÙ†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø¨Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø±Ø¨Ø­ ØªÙ‚Ø±ÙŠØ¨ÙŠØ©: <strong>${b.margin}%</strong></div>
        </div>
      </div>`;
    }

    if (allNegative) {
      html += `<div class="alert-error">Ù†Ø¹ØªØ°Ø± Ù…Ù†ÙƒØŒ Ø­Ø³Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø© Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙ…ÙˆÙŠÙ„.</div>`;
    }

    // Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø§Ù„Ø¹ØµØ±ÙŠØ© (Ù„Ù„Ø¹Ø³ÙƒØ±ÙŠÙŠÙ† ÙÙ‚Ø·)
    if(isExtended){
      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ù†ÙˆØ§Øª ÙˆØ§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
      const remainingYears = Math.floor(timing.rankRemainingMonths / 12);
      const remainingMonthsLeft = timing.rankRemainingMonths % 12;
      const remainingText = remainingYears > 0 
        ? `${remainingYears} Ø³Ù†Ø© Ùˆ ${remainingMonthsLeft} Ø´Ù‡Ø±`
        : `${remainingMonthsLeft} Ø´Ù‡Ø±`;
      
      // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯
      const basicAtRetirement = pensionResult.basicSalaryAtRetirement || 0;
      const totalServiceYears = pensionResult.totalServiceYears || 0;
      const totalServiceMonths = pensionResult.totalServiceMonths || 0;
      
      html += `
        <div class="retirement-card">
          <div class="retirement-title">ğŸ–ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ ÙŠØ§ ${name}</div>
          <div class="retirement-row">
            <span>Ø§Ø®ØªØ±Øª Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù…Ù…ØªØ¯ Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯</span>
            <span class="retirement-value">âœ… Ù†Ø¹Ù…</span>
          </div>
          <div class="retirement-row">
            <span>Ø§Ù„Ø±ØªØ¨Ø© Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ©</span>
            <span class="retirement-value">${answers.militaryRank || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
          </div>
          <div class="retirement-row">
            <span>Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø®Ø¯Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯</span>
            <span class="retirement-value">${totalServiceYears} Ø³Ù†Ø© (${totalServiceMonths} Ø´Ù‡Ø±)</span>
          </div>
          <div class="retirement-row">
            <span>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯</span>
            <span class="retirement-value">${basicAtRetirement.toLocaleString()} Ø±ÙŠØ§Ù„</span>
          </div>
          <div class="retirement-row" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-radius: 12px; padding: 10px; margin-top: 8px;">
            <span style="font-weight: 800; color: #92400e;">Ø±Ø§ØªØ¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</span>
            <span class="retirement-value" style="font-size: 18px; color: #92400e; font-weight: 900;">${pensionSalaryEst.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±ÙŠØ§Ù„</span>
          </div>
          <div class="retirement-row">
            <span>ØªØªÙ‚Ø§Ø¹Ø¯ ÙŠØ§ ${name} Ø¨Ø¹Ø¯ Ø¹Ù…Ø± Ø·ÙˆÙŠÙ„ Ø¨Ø§Ù„Ø·Ø§Ø¹Ø© Ø¨Ø¹Ø¯</span>
            <span class="retirement-value">${remainingText}</span>
          </div>
          <div class="retirement-row">
            <span>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ (Ù‡Ø¬Ø±ÙŠ)</span>
            <span class="retirement-value">${timing.rankRetHijriStr}</span>
          </div>
          <div style="margin-top:12px; font-size:12px; color:#065f46; text-align:right; background: #ecfdf5; padding: 10px; border-radius: 10px;">
            <strong>ğŸ“Š Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø±Ø³Ù…ÙŠØ©:</strong><br>
            Ø±Ø§ØªØ¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ = (Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø§Ù„Ø£Ø®ÙŠØ± Ã— Ø£Ø´Ù‡Ø± Ø§Ù„Ø®Ø¯Ù…Ø©) Ã· 420<br>
            = (${basicAtRetirement.toLocaleString()} Ã— ${totalServiceMonths}) Ã· 420 = <strong>${pensionSalaryEst.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±ÙŠØ§Ù„</strong>
          </div>
          <div style="margin-top:8px; font-size:12px; color:#6b7280; text-align:right;">
            ğŸ“ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ù‚Ø¨Ù„ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø¹Ù„Ù‰ Ø±Ø§ØªØ¨Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠØŒ ÙˆØ¨Ø¹Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø¹Ù„Ù‰ Ø±Ø§ØªØ¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯.
          </div>
        </div>
      `;
    }

    // ====== ÙƒØªÙ„Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ( ) ======
    html += `
      <div class="result-main-block">
        <div class="result-main-title">â­ ${mainShownLabel} ( )</div>
        <div class="result-amount-main">${fmtMoney(mainShownValue).replace(' Ø±ÙŠØ§Ù„','')} Ø±ÙŠØ§Ù„</div>
    `;

    // ØªÙØµÙŠÙ„ Ø¯Ø¹Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ ØªØ­Øª Ø¨Ø®Ø· Ø£ØµØºØ± (Ø­Ø³Ø¨ Ø·Ù„Ø¨Ùƒ)
    if(isMortgage){
      const base = Number(finalNetFixed);
      html += `
        <div class="result-amount-sub">Ù‡Ø°Ù‡ Ù‡ÙŠ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªÙŠ ÙŠØ¨Ø­Ø« Ø¹Ù†Ù‡Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„: (ØµØ§ÙÙŠ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ + Ø§Ù„Ø¯Ø¹Ù… Ø¥Ù† ÙˆØ¬Ø¯)</div>
        <div class="result-amount-small">
          ØµØ§ÙÙŠ Ø§Ù„ØªÙ…ÙˆÙŠÙ„: <strong>${fmtMoney(base)}</strong><br>
          ${supportSakaniAdded ? `Ø¯Ø¹Ù… Ø³ÙƒÙ†ÙŠ Ø§Ù„Ù…Ø¶Ø§Ù: <strong>${fmtMoney(supportSakaniAdded)}</strong><br>` : `Ø¯Ø¹Ù… Ø³ÙƒÙ†ÙŠ Ø§Ù„Ù…Ø¶Ø§Ù: <strong>Ù„Ø§ ÙŠÙˆØ¬Ø¯</strong><br>`}
          ${supportEtezaazAdded ? `Ø¯Ø¹Ù… Ø§Ø¹ØªØ²Ø§Ø² Ø§Ù„Ù…Ø¶Ø§Ù: <strong>${fmtMoney(supportEtezaazAdded)}</strong><br>` : `Ø¯Ø¹Ù… Ø§Ø¹ØªØ²Ø§Ø² Ø§Ù„Ù…Ø¶Ø§Ù: <strong>Ù„Ø§ ÙŠÙˆØ¬Ø¯</strong><br>`}
          ${
            (housingSupportMonthly > 0)
              ? `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶ (Ù„Ø§ ÙŠØ´Ù…Ù„ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø´Ù‡Ø±ÙŠ): <strong>${fmtMoney(mainShownValue)}</strong>`
              : `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (ØµØ§ÙÙŠ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ + Ø§Ù„Ø¯Ø¹Ù…): <strong>${fmtMoney(mainShownValue)}</strong>`
          }
        </div>
      `;
    } else if(isBuyoutPersonal && buyoutAmount > 0){
      html += `
        <div class="result-amount-sub">Ù‡Ø°Ù‡ Ù‡ÙŠ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªÙŠ ÙŠØ¨Ø­Ø« Ø¹Ù†Ù‡Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„: (Ø§Ù„ØµØ§ÙÙŠ Ø¨Ø¹Ø¯ Ø³Ø¯Ø§Ø¯ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù‚Ø¯ÙŠÙ…)</div>
        <div class="result-amount-small">
          Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø³Ø¯Ø§Ø¯: <strong>${fmtMoney(Number(finalNetFixed))}</strong><br>
          Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¨ÙƒØ±: <strong>${fmtMoney(buyoutAmount)}</strong><br>
          Ù…Ø§ ÙŠØµÙÙŠ Ù„Ù„Ø¹Ù…ÙŠÙ„: <strong>${fmtMoney(mainShownValue)}</strong>
        </div>
      `;
    } else {
      html += `<div class="result-amount-sub">Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ Ø¨Ø¹Ø¯ Ø®ØµÙ… Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø© ${addCommodityFee ? 'ÙˆØ±Ø³ÙˆÙ… Ø§Ù„Ø³Ù„Ø¹' : ''}.</div>`;
    }

    // Ø¯Ø¹Ù… ØªÙØµÙŠÙ„ÙŠ (Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯) ÙŠØ¨Ù‚Ù‰ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†ØªÙŠØ¬Ø©
    if(supportText) html += supportText;

    // Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© (ØªØ¨Ù‚Ù‰)
    html += `
        <div class="dual-main-grid">
          <div class="dual-box">
            <div class="dual-box-title">Ø§Ù„ØµØ§ÙÙŠ Ù‚Ø¨Ù„ Ø£ÙŠ Ø±Ø³ÙˆÙ…</div>
            <div class="dual-box-amount">${netWithoutFeesFixed.replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±.Ø³</div>
          </div>
          <div class="dual-box">
            <div class="dual-box-title">Ø¨Ø¹Ø¯ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© + Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø³ÙˆÙ… </div>
            <div class="dual-box-amount">${netAfterAdminFixed.replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±.Ø³</div>
          </div>
        </div>

        <div style="margin-top:8px; font-size:13px; color:#374151;">
          Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ Ù…ÙƒØªÙˆØ¨ Ø¨Ø§Ù„Ø­Ø±ÙˆÙ:
          <strong>${numberToArabicWords(parseInt(finalNetFixed))}</strong>
        </div>

        <div class="result-amount-small" style="margin-top:4px;">
          Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…Ø­ØªØ³Ø¨Ø©: <strong>${profitMargin}% Ø³Ù†ÙˆÙŠØ§Ù‹</strong>
        </div>
      </div>
    `;

    // Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
    html += `
      <div class="result-section-title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ Ø­Ø³Ø¨ Ø§Ù„ÙØªØ±Ø§Øª</div>
      <div class="result-section-box">
    `;
    finalPhases.forEach(p=>{
      html += `
        <div class="instalment-row">
          Ø§Ù„Ù‚Ø³Ø· Ù…Ù† Ø§Ù„Ø´Ù‡Ø± <strong>${p.from}</strong> Ø¥Ù„Ù‰ <strong>${p.to}</strong>:
          <strong>${p.inst.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±ÙŠØ§Ù„</strong>
        </div>
      `;
    });
    html += `</div>`;

    if (altBanks.length > 0) {
      html += `
        <div class="result-section-title">Ù£ Ø¨Ù†ÙˆÙƒ/Ø´Ø±ÙƒØ§Øª Ø£Ø®Ø±Ù‰ Ù…Ù†Ø§ÙØ³Ø©</div>
        <div class="result-section-box">
          <ul style="margin:0; padding-right:16px; font-size:13px; color:#4b5563; list-style-type:disc; text-align:right;">
      `;
      altBanks.forEach(b => {
        html += `<li>${b.bankName} - Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø±Ø¨Ø­ ØªÙ‚Ø±ÙŠØ¨ÙŠØ©: <strong>${b.margin}%</strong></li>`;
      });
      html += `</ul></div>`;
    }

    // Ø§Ù„Ø±Ø³ÙˆÙ… ÙˆØ§Ù„Ø±Ø¨Ø­
    html += `
      <div class="result-section-title">Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø±Ø³ÙˆÙ…</div>
      <div class="result-section-box">
        <div class="instalment-row">
          Ø§Ù„Ø±Ø¨Ø­ Ø¯ÙˆÙ† Ø§Ù„Ø±Ø³ÙˆÙ…:
          <strong>${(totalInst - netWithoutFees).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±ÙŠØ§Ù„</strong>
        </div>
        <div class="instalment-row">
          Ø§Ù„Ø±Ø¨Ø­ Ù…Ø¹ Ø§Ù„Ø±Ø³ÙˆÙ…:
          <strong>${totalProfitWithFees.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±ÙŠØ§Ù„</strong>
        </div>
        <div class="instalment-row">
          Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©:
          <strong>${adminFee.toFixed(0)} Ø±ÙŠØ§Ù„</strong>
          <div class="vat-small">(Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø§Ø¯Ø§Ø±ÙŠØ©): ${vat.toFixed(0)} Ø±ÙŠØ§Ù„</div>
          ${addCommodityFee ? ` + Ø±Ø³ÙˆÙ… Ø§Ù„Ø³Ù„Ø¹: <strong>${commodityFee.toFixed(0)} Ø±ÙŠØ§Ù„</strong>` : ''}
        </div>
        <div class="instalment-row">
          Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ :
          <strong>${totalInst.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} Ø±ÙŠØ§Ù„</strong>
        </div>
      </div>
      <div style="margin-top:10px; font-size:13px; color:#6b7280; text-align:right;">
        âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø³Ø¨Ø© ØªÙ‚Ø±ÙŠØ¨ÙŠØ© ØŒ ÙˆØ§Ù„Ù†Ø³Ø¨ Ø§Ù„ÙØ¹Ù„ÙŠØ© ÙˆÙ…Ù†Ø­ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø¬Ù‡Ù‡ Ø§Ù„Ù…Ù…ÙˆÙ„Ø© ÙˆÙ‚Øª ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨.
ğŸ”ºØªÙ†ÙˆÙŠÙ‡: Ù„Ø³Ù†Ø§ Ø¬Ù‡Ø© ØªÙ…ÙˆÙŠÙ„ÙŠØ©ØŒ Ø¯ÙˆØ±Ù†Ø§ Ù†Ù†Ø¬Ø²Ùƒ Ù…Ø¹ Ø§ÙØ¶Ù„ Ø¬Ù‡Ø© ØªÙ…ÙˆÙŠÙ„ÙŠØ© Ø¨Ø£Ø³Ø±Ø¹ ÙˆÙ‚Øª ÙˆØ¨Ø¯ÙˆÙ† ØªØ¹Ù‚ÙŠØ¯Ø§Øªâš¡ï¸
      </div>
    `;

    // ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø®Ø§Øµ (ØºÙŠØ± Ù…Ø¯Ù†ÙŠ ÙˆØºÙŠØ± Ø¹Ø³ÙƒØ±ÙŠ)
    if (answers.jobType && !['Ù…Ø¯Ù†ÙŠ (Ù‚Ø·Ø§Ø¹ Ø­ÙƒÙˆÙ…ÙŠ)','Ø¹Ø³ÙƒØ±ÙŠ'].includes(answers.jobType)) {
      html += `
        <div class="notice-soft">
          ØªÙ†Ø¨ÙŠÙ‡: Ø¬Ù…ÙŠØ¹ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø®Ø§Øµ (Ø´Ø¨Ù‡ Ø­ÙƒÙˆÙ…ÙŠ/Ù…Ø¹ØªÙ…Ø¯/ØºÙŠØ± Ù…Ø¹ØªÙ…Ø¯) ØªØ®Ø¶Ø¹ Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ù…ÙˆÙ„Ø© ÙˆÙ‚Ø¯ ØªØ®ØªÙ„Ù Ø§Ù„Ø´Ø±ÙˆØ· Ø­Ø³Ø¨ Ø³ÙŠØ§Ø³Ø© ÙƒÙ„ Ø¬Ù‡Ø©.
        </div>
      `;
    }

    // ØªÙ†Ø¨ÙŠÙ‡ Ø§Ø¹ØªØ²Ø§Ø² (Ø·Ù„Ø¨Ùƒ)
    if (answers.isEtezaaz === 'Ù†Ø¹Ù…') {
      html += `
        <div class="notice-soft">
          ØªÙ†Ø¨ÙŠÙ‡ Ø§Ø¹ØªØ²Ø§Ø²: Ø¯Ø¹Ù… ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯ÙØ§Ø¹ ÙŠØ¨Ø¯Ø£ Ø¨Ø¹Ø¯ Ø³Ù†ØªÙŠÙ†ØŒ ÙˆÙ„Ø§ ØªØªÙˆÙØ± Ù„Ø¯ÙŠÙ†Ø§ ØªÙØ§ØµÙŠÙ„ Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù‚Ø³Ø· â€” ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø¬Ù‡Ø© Ø¹Ù…Ù„Ùƒ Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø©.
        </div>
      `;
    }

    html += `
      <div style="margin-top:8px; font-size:14px; font-weight:900; color:#1e3a8a; text-align:center;">
        ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ ğŸ“ 0506214458
      </div>
    `;

    resultCard.innerHTML = html;
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø®Ø§ØµØ©
    showSpecialOffers(financeType, Number(finalNetFixed));
    
    // Ø¹Ø±Ø¶ Ù‚Ø³Ù… Ø§Ù„ØªØ³ÙˆÙŠÙ‚ ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ…
    updateMarketingAndRatingDisplay();

    // Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ pensionResult.formula
    
    // Ø­ÙØ¸ Ø¢Ø®Ø± Ù†ØªÙŠØ¬Ø© (Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… "Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„" + Ø§Ù„Ø£Ø±Ø´ÙŠÙ)
    answers._lastCalc = {
      calcDateTimeStr,
      clientName: name,
      financeType: financeType,
      durationText: duration,
      months: months,
      recommendedBankName: (recommendedBank && recommendedBank.bankName) ? recommendedBank.bankName : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
      finalNet: Number(finalNetFixed),
      netWithoutFees: Number(netWithoutFeesFixed),
      netAfterAdmin: Number(netAfterAdminFixed),
      totalInst: Number(totalInst.toFixed(0)),
      adminFee: Number(adminFee.toFixed(0)),
      vat: Number(vat.toFixed(0)),
      commodityFee: Number(commodityFee.toFixed(0)),
      supportSakaniAdded: Number(supportSakaniAdded || 0),
      supportEtezaazAdded: Number(supportEtezaazAdded || 0),
      supportTotalAdded: Number(supportTotalAdded || 0),
      mainShownValue: Number(mainShownValue || 0),
      mainShownLabel: mainShownLabel || '',
      hasHousingSupport: (financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ' && (answers.supported === 'Ù…Ø¯Ø¹ÙˆÙ…')),
      housingSupportMonthly: Number(housingSupportMonthly || 0),
      housingSupportTotalForLoan: Number(housingSupportTotalForLoan || 0),
      housingSupportLumpSum: Number(housingSupportLumpSum || 0),
      isEtezaaz: (answers.isEtezaaz === 'Ù†Ø¹Ù…'),
      phases: Array.isArray(finalPhases) ? finalPhases : [],
      // (Ø¥Ø¶Ø§ÙØ©) Ù„Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ ÙÙ‚Ø·
      extended: !!isExtended,
      preRetMonths: preRetMonths,
      pensionSalaryEst: Number(pensionSalaryEst || 0),
      retirementHijri: timing.rankRetHijriStr || '',
      // Ù…Ø¹Ø§Ø¯Ù„Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„
      retirementFormula: retirementFormula
    };
  }

  // Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙƒØµÙˆØ±Ø© JPG (ÙˆØ§Ø¶Ø­Ø© + Ø­Ø¬Ù… Ù…ØªÙˆØ³Ø·)
  function saveResultAsImage() {
    const card = document.getElementById('resultCard');
    if (!card) { alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø©.'); return; }

    html2canvas(card, { scale: 2, backgroundColor: '#ffffff', useCORS: true }).then(canvas => {
      const MAX_W = 1400;
      let outCanvas = canvas;

      if (canvas.width > MAX_W) {
        const ratio = MAX_W / canvas.width;
        const w = Math.round(canvas.width * ratio);
        const h = Math.round(canvas.height * ratio);

        const tmp = document.createElement('canvas');
        tmp.width = w; tmp.height = h;
        const ctx = tmp.getContext('2d');
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = 'high';
        ctx.drawImage(canvas, 0, 0, w, h);
        outCanvas = tmp;
      }

      const link = document.createElement('a');
      link.download = 'fino-result.jpg';
      link.href = outCanvas.toDataURL('image/jpeg', 0.92);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }).catch(err => {
      console.error(err);
      alert('ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙƒØµÙˆØ±Ø©ØŒ Ø¬Ø±Ù‘Ø¨ Ù…Ù† Ù…ØªØµÙØ­ Ø¢Ø®Ø± Ø£Ùˆ ØªØ£ÙƒØ¯ Ø£Ù† Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª Ù…ÙØ¹Ù‘Ù„.');
    });
  }

  // Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ (Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©)
  function shareResultOnWhatsApp(){
    const card = document.getElementById('resultCard');
    if(!card){ alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø©.'); return; }
    const text = card.innerText || card.textContent || '';
    const url = 'https://wa.me/?text=' + encodeURIComponent(text);
    window.open(url, '_blank');
  }

  function updateDateTime(){
    const n = new Date();
    const dayNames = ['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'];
    const dayName = dayNames[n.getDay()];
    const y = n.getFullYear();
    const m = String(n.getMonth()+1).padStart(2,'0');
    const d = String(n.getDate()).padStart(2,'0');
    const hh = String(n.getHours()).padStart(2,'0');
    const mm = String(n.getMinutes()).padStart(2,'0');
    const ss = String(n.getSeconds()).padStart(2,'0');
    const el = document.getElementById('datetime');
    if (el) el.textContent = `${dayName} ${y}-${m}-${d} ${hh}:${mm}:${ss}`;

    // (Ø¥Ø¶Ø§ÙØ©) ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‡Ø¬Ø±ÙŠ
    const hEl = document.getElementById('datetimeHijri');
    if(hEl) hEl.textContent = getHijriNowDisplay();
  }

  // ====== Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„ ======
  let _clientResultTextCache = '';

  function openClientResultModal(fromAdmin){
    const lc = answers._lastCalc;
    if(!lc){
      alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªÙŠØ¬Ø© Ø­Ø§Ù„ÙŠØ§Ù‹. Ø§Ø­Ø³Ø¨ Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Ø§ÙØªØ­ "Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„".');
      return;
    }
    // Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† Ù…Ù† Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ (Ø¨Ø¹Ø¯ ØªØ­Ù‚Ù‚ â–«ï¸) Ø£Ùˆ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„
    if(fromAdmin !== true && _miniAdminVerified !== true){
      alert('Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„.');
      return;
    }

    document.getElementById('clientNetOverride').value = '';
    document.getElementById('clientInstOverride').value = '';
    document.getElementById('clientNoteOverride').value = '';
    document.getElementById('clientResultText').value = '';
    _clientResultTextCache = '';
    document.getElementById('clientPreviewCard').innerHTML = `
      <div class="h">Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø³Ø¨Ø© (Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©)</div>
      <div style="color:#6b7280; font-size:12px;">Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø®ØªØµØ±Ø© Ø£ÙˆÙ„Ø§Ù‹ Ù„ØªØ¸Ù‡Ø± Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ù‡Ù†Ø§.</div>
    `;
    document.getElementById('clientResultModal').style.display = 'block';
  }

  function closeClientResultModal(){
    document.getElementById('clientResultModal').style.display = 'none';
  }

  function generateClientResultText(){
    const lc = answers._lastCalc;
    if(!lc){ alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªÙŠØ¬Ø©.'); return; }

    const netOv = safeNum(document.getElementById('clientNetOverride').value);
    const instOv = safeNum(document.getElementById('clientInstOverride').value);
    const note  = (document.getElementById('clientNoteOverride').value || '').trim();

    // Ø§Ù„ØµØ§ÙÙŠ Ù„Ù„Ø¹Ù…ÙŠÙ„: Ø¥Ø°Ø§ ÙƒØªØ¨ØªÙ‡ Ø§Ø¹ØªÙ…Ø¯Ù‡ØŒ ÙˆØ¥Ù„Ø§ Ù†Ø¹ØªÙ…Ø¯  Ù„Ù„Ù†ÙˆØ¹:
    let usedNet = (netOv !== null) ? netOv : lc.finalNet;

    // ÙÙŠ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ: Ù„Ø§ ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø¹Ù„Ù‰ Ø§Ù„ØµØ§ÙÙŠ
    let usedNetWithSupport = usedNet;
    const supportAddedToNet = (lc.supportEtezaazAdded || 0) + ((lc.housingSupportMonthly || 0) > 0 ? 0 : (lc.supportSakaniAdded || 0));
    if(lc.financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ' && supportAddedToNet){
      usedNetWithSupport = usedNet + supportAddedToNet;
    }

    const hasMultiPhases = Array.isArray(lc.phases) && lc.phases.length > 1;
    const singlePhaseInst = (!hasMultiPhases && Array.isArray(lc.phases) && lc.phases[0]) ? Number(lc.phases[0].inst) : null;
    const usedInst = (instOv !== null) ? instOv : (singlePhaseInst !== null ? singlePhaseInst : null);

    const overrideUsed = (netOv !== null) || (instOv !== null);

    const totalPaid = (usedInst !== null)
      ? (usedInst * lc.months)
      : lc.totalInst;

    const computedProfit = totalPaid - usedNet;

    // Ø¯Ø¹Ù…
    let supportLines = '';
    if(lc.supportSakaniAdded){
      if(lc.housingSupportMonthly > 0){
        supportLines += `- Ø¯Ø¹Ù… Ø³ÙƒÙ†ÙŠ (Ø´Ù‡Ø±ÙŠ) Ø­Ø³Ø¨ Ù…ØµÙÙˆÙØ© Ø§Ù„Ø¯Ø¹Ù…: ${fmtMoney(lc.housingSupportMonthly)}\n`;
        supportLines += `- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¯Ø¹Ù… Ø³ÙƒÙ†ÙŠ (Ø­ØªÙ‰ 20 Ø³Ù†Ø© ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰): ${fmtMoney(lc.supportSakaniAdded)}\n`;
      } else {
        supportLines += `- Ø¯Ø¹Ù… Ø³ÙƒÙ†ÙŠ Ø§Ù„Ù…Ø¶Ø§Ù: ${fmtMoney(lc.supportSakaniAdded)}\n`;
      }
    }
    if(lc.supportEtezaazAdded){
      supportLines += `- Ø¯Ø¹Ù… Ø§Ø¹ØªØ²Ø§Ø²: ${fmtMoney(lc.supportEtezaazAdded)} (Ø¯Ø¹Ù… Ø¥Ø¶Ø§ÙÙŠ Ù…Ø³ØªÙ‚Ù„)\n`;
      supportLines += `- ØªÙ†Ø¨ÙŠÙ‡ Ø§Ø¹ØªØ²Ø§Ø²: ÙŠØ¨Ø¯Ø£ Ø¨Ø¹Ø¯ Ø³Ù†ØªÙŠÙ† ÙˆÙ„Ø§ ØªØªÙˆÙØ± Ù„Ø¯ÙŠÙ†Ø§ ØªÙØ§ØµÙŠÙ„ Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ù„Ù‚Ø³Ø· â€” ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø¬Ù‡Ø© Ø¹Ù…Ù„Ùƒ.\n`;
    }

    let instBlock = '';
    if (usedInst !== null) {
      instBlock = `Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ: ${fmtMoney(usedInst)}\n`;
    } else if (hasMultiPhases) {
      instBlock = `Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø­Ø³Ø¨ Ø§Ù„ÙØªØ±Ø§Øª:\n`;
      lc.phases.forEach(p=>{
        instBlock += `- Ù…Ù† Ø§Ù„Ø´Ù‡Ø± ${p.from} Ø¥Ù„Ù‰ ${p.to}: ${fmtMoney(p.inst)}\n`;
      });
    } else {
      instBlock = `Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ: ØºÙŠØ± Ù…Ø­Ø¯Ø¯\n`;
    }

    const feesBlock =
`ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø±Ø³ÙˆÙ… :
- Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©: ${fmtMoney(lc.adminFee)}
- (Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø§Ø¯Ø§Ø±ÙŠØ©): ${fmtMoney(lc.vat)}${lc.commodityFee ? `\n- Ø±Ø³ÙˆÙ… Ø§Ù„Ø³Ù„Ø¹: ${fmtMoney(lc.commodityFee)}` : ''}\n`;

    const profitBlock = overrideUsed
      ? `Ø§Ù„Ø±Ø¨Ø­ ${fmtMoney(computedProfit)}\n`
      : `Ø§Ù„Ø±Ø¨Ø­ Ù…Ø¹ Ø§Ù„Ø±Ø³ÙˆÙ… ${fmtMoney(lc.totalInst - lc.finalNet)}\n`;

    const contact = `\nÙ„Ù„Ø§Ø³ØªÙØ³Ø§Ø± ÙˆØ§Ù„ØªÙ‚Ø¯ÙŠÙ…: 0506214458\nØ³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©\n`;

    const privateNotice = (answers.jobType && !['Ù…Ø¯Ù†ÙŠ (Ù‚Ø·Ø§Ø¹ Ø­ÙƒÙˆÙ…ÙŠ)','Ø¹Ø³ÙƒØ±ÙŠ'].includes(answers.jobType))
      ? `\nØªÙ†Ø¨ÙŠÙ‡: Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø®Ø§Øµ Ø¨Ø¬Ù…ÙŠØ¹ Ø£Ù†ÙˆØ§Ø¹Ù‡ Ù„Ø§Ø¨Ø¯ Ø§Ø¹ØªÙ…Ø§Ø¯Ù‡ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ù…ÙˆÙ„Ø© ÙˆÙ‚Ø¯ ØªØ®ØªÙ„Ù Ø§Ù„Ø´Ø±ÙˆØ·.\n`
      : '';

    let text =
`Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø³Ø¨Ø© (Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©)
ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„Ø­Ø³Ø¨Ø©: ${lc.calcDateTimeStr}
Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙˆÙ…Ø³Ù‡Ù„Ø§ ÙŠØ§ ${lc.clientName}
Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„: ${lc.financeType}
Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„: ${lc.durationText}
Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ/Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ù…Ø±Ø´Ø­Ø©: ${lc.recommendedBankName}

Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ: ${fmtMoney(usedNet)}
`;

    if(lc.financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ' && (lc.supportSakaniAdded || lc.supportEtezaazAdded)){
      if(supportAddedToNet){
        text += `ØµØ§ÙÙŠ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¶Ø§Ù Ù„Ù‡ Ø§Ù„Ø¯Ø¹Ù…: ${fmtMoney(usedNetWithSupport)}\n`;
      }
      text += `ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯Ø¹Ù…:\n${supportLines || '- Ù„Ø§ ÙŠÙˆØ¬Ø¯\n'}`;
    }

    // (Ø¥Ø¶Ø§ÙØ©) ØªÙˆØ¶ÙŠØ­ Ø§Ù„Ù…Ù…ØªØ¯ Ø¥Ù† ÙˆØ¬Ø¯
    if(lc.extended){
      text += `\nÙ…Ù„Ø§Ø­Ø¸Ø©: ØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù…ØªØ¯ (ØªÙ‚Ø¯ÙŠØ±ÙŠ) Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯.\n`;
      if(lc.retirementHijri) text += `ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ (Ù‡Ø¬Ø±ÙŠ): ${lc.retirementHijri}\n`;
    }

    text += `
${instBlock}
${profitBlock}
${feesBlock}
${note ? `Ù…Ù„Ø§Ø­Ø¸Ø©: ${note}\n` : ''}${privateNotice}
âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø³Ø¨Ø© ØªÙ‚Ø±ÙŠØ¨ÙŠØ©ØŒ ÙˆØ§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø­Ø³Ø¨ Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ù…ÙˆÙ„Ø© ÙˆÙ‚Øª Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…. ğŸ”ºØªÙ†ÙˆÙŠØ©/Ù†Ø­Ù† Ù„Ø³Ù†Ø§ Ø¬Ù‡Ø© ØªÙ…ÙˆÙŠÙ„ÙŠØ©ØŒ ÙˆØ¯ÙˆØ±Ù†Ø§ ÙŠÙ‚ØªØµØ± Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ³Ø§Ø·Ø© ÙˆØªØ±Ø´ÙŠØ­ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ù†ÙˆÙƒ ÙˆØ´Ø±ÙƒØ§Øª Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù…Ø±Ø®Ù‘ØµØ©.. 
${contact}`.trim();

    _clientResultTextCache = text;
    lc._lastClientText = text;

    document.getElementById('clientResultText').value = text;
    renderClientPreviewFromText(text);
  }

  function renderClientPreviewFromText(text){
    const lines = String(text||'').split('\n').map(l=>l.trim()).filter(Boolean);
    if(!lines.length){
      document.getElementById('clientPreviewCard').innerHTML = `<div class="h">Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø³Ø¨Ø© (Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©)</div>`;
      return;
    }
    let html = `<div class="h">${escapeHtml(lines[0])}</div>`;
    html += `<div class="hr"></div>`;
    for(let i=1;i<lines.length;i++){
      const l = lines[i];
      if(l.includes(':')){
        const parts = l.split(':');
        const k = parts.shift();
        const v = parts.join(':').trim();
        html += `<div><span class="k">${escapeHtml(k)}:</span> <span class="v">${escapeHtml(v)}</span></div>`;
      } else {
        html += `<div>${escapeHtml(l)}</div>`;
      }
      if(i===5) html += `<div class="hr"></div>`;
    }
    document.getElementById('clientPreviewCard').innerHTML = html;
  }

  function copyClientResultText(){
    const ta = document.getElementById('clientResultText');
    if(!ta.value){ alert('Ø£Ù†Ø´Ø¦ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø£ÙˆÙ„Ø§Ù‹.'); return; }
    ta.select();
    ta.setSelectionRange(0, 999999);
    document.execCommand('copy');
    alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø© âœ…');
  }

  function shareClientResultOnWhatsApp(){
    const ta = document.getElementById('clientResultText');
    const text = (ta && ta.value) ? ta.value : _clientResultTextCache;
    if(!text){ alert('Ø£Ù†Ø´Ø¦ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø£ÙˆÙ„Ø§Ù‹.'); return; }
    window.open('https://wa.me/?text=' + encodeURIComponent(text), '_blank');
  }

  function saveClientResultAsImage(){
    const preview = document.getElementById('clientPreviewCard');
    const ta = document.getElementById('clientResultText');
    if(!ta.value){
      alert('Ø£Ù†Ø´Ø¦ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø®ØªØµØ±Ø© Ø£ÙˆÙ„Ø§Ù‹.');
      return;
    }

    html2canvas(preview, { scale: 2, backgroundColor:'#ffffff', useCORS:true }).then(canvas=>{
      const MAX_W = 1400;
      let outCanvas = canvas;

      if (canvas.width > MAX_W) {
        const ratio = MAX_W / canvas.width;
        const w = Math.round(canvas.width * ratio);
        const h = Math.round(canvas.height * ratio);

        const tmp = document.createElement('canvas');
        tmp.width = w; tmp.height = h;
        const ctx = tmp.getContext('2d');
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = 'high';
        ctx.drawImage(canvas, 0, 0, w, h);
        outCanvas = tmp;
      }

      const link = document.createElement('a');
      link.download = 'fino-client-result.jpg';
      link.href = outCanvas.toDataURL('image/jpeg', 0.92);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }).catch(err=>{
      console.error(err);
      alert('ØªØ¹Ø°Ø± Ø­ÙØ¸ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙƒØµÙˆØ±Ø©.');
    });
  }

  // ====== Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø³Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¨ÙƒØ± ======
  function calculateEarlySettlement() {
    const financeType = document.getElementById('esFinanceType').value;
    const originalAmount = parseFloat(document.getElementById('esOriginalAmount').value) || 0;
    const totalMonths = parseInt(document.getElementById('esTotalMonths').value) || 0;
    const paidMonths = parseInt(document.getElementById('esPaidMonths').value) || 0;
    const annualRate = parseFloat(document.getElementById('esAnnualRate').value) || 0;
    
    if (!originalAmount || !totalMonths || paidMonths < 0 || !annualRate) {
      alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­');
      return;
    }
    
    if (paidMonths >= totalMonths) {
      alert('Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…Ø³Ø¯Ø¯Ø© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ù…Ø¯Ø© Ø§Ù„ÙƒÙ„ÙŠØ©');
      return;
    }
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ (Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø«Ø§Ø¨Øª)
    const monthlyRate = annualRate / 100 / 12;
    const totalProfit = originalAmount * (annualRate / 100) * (totalMonths / 12);
    const totalWithProfit = originalAmount + totalProfit;
    const monthlyInstallment = totalWithProfit / totalMonths;
    
    // Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù…Ù† Ø§Ù„Ø£ØµÙ„
    const remainingMonths = totalMonths - paidMonths;
    const remainingPrincipal = originalAmount * (remainingMonths / totalMonths);
    
    // ÙƒÙ„ÙØ© Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ø­Ø³Ø¨ Ù†Ø¸Ø§Ù… Ø³Ø§Ù…Ø§
    const penaltyMonths = financeType === 'mortgage' ? 1 : 3;
    const penaltyCost = remainingPrincipal * (annualRate / 100 / 12) * penaltyMonths;
    
    // Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¨ÙƒØ±
    const earlySettlementAmount = remainingPrincipal + penaltyCost;
    
    // Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù„Ùˆ Ø£ÙƒÙ…Ù„
    const remainingProfit = totalProfit * (remainingMonths / totalMonths);
    
    // Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ÙˆÙØ±
    const savedAmount = remainingProfit - penaltyCost;
    const savingPercentage = ((savedAmount / remainingProfit) * 100).toFixed(1);
    
    const resultHtml = `
      <h3 style="margin:0 0 15px; color:#059669;">âœ… Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø³Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¨ÙƒØ±</h3>
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
        <div style="padding:10px; background:#fff; border-radius:10px;">
          <div style="font-size:12px; color:#6b7280;">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù…Ù† Ø§Ù„Ø£ØµÙ„</div>
          <div style="font-size:18px; font-weight:700; color:#111827;">${remainingPrincipal.toLocaleString('ar-SA')} Ø±ÙŠØ§Ù„</div>
        </div>
        <div style="padding:10px; background:#fff; border-radius:10px;">
          <div style="font-size:12px; color:#6b7280;">ÙƒÙ„ÙØ© ${penaltyMonths} Ø£Ø´Ù‡Ø± Ù‚Ø§Ø¯Ù…Ø©</div>
          <div style="font-size:18px; font-weight:700; color:#f59e0b;">${penaltyCost.toLocaleString('ar-SA', {maximumFractionDigits:0})} Ø±ÙŠØ§Ù„</div>
        </div>
      </div>
      <div style="margin-top:15px; padding:15px; background:linear-gradient(135deg,#1e3a8a,#3b82f6); border-radius:12px; color:#fff;">
        <div style="font-size:14px; opacity:0.9;">ğŸ’° Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¨ÙƒØ±</div>
        <div style="font-size:28px; font-weight:900;">${earlySettlementAmount.toLocaleString('ar-SA', {maximumFractionDigits:0})} Ø±ÙŠØ§Ù„</div>
      </div>
      <div style="margin-top:10px; display:grid; grid-template-columns:1fr 1fr; gap:10px;">
        <div style="padding:10px; background:#dcfce7; border-radius:10px;">
          <div style="font-size:12px; color:#166534;">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ÙˆÙØ±</div>
          <div style="font-size:16px; font-weight:700; color:#15803d;">${savedAmount.toLocaleString('ar-SA', {maximumFractionDigits:0})} Ø±ÙŠØ§Ù„</div>
        </div>
        <div style="padding:10px; background:#dbeafe; border-radius:10px;">
          <div style="font-size:12px; color:#1e40af;">Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙˆÙÙŠØ±</div>
          <div style="font-size:16px; font-weight:700; color:#1d4ed8;">${savingPercentage}%</div>
        </div>
      </div>
    `;
    
    document.getElementById('esResult').innerHTML = resultHtml;
    document.getElementById('esResult').style.display = 'block';
  }
  
  // ====== Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª ======
  const RATINGS_KEY = 'stRatings';
  const RATINGS_SETTINGS_KEY = 'stRatingsSettings';
  let ratings = [];
  let ratingsSettings = { showOnHome: false };
  let currentRating = 0;

  function loadRatings() {
    try {
      const s = localStorage.getItem(RATINGS_KEY);
      ratings = s ? JSON.parse(s) : [];
      const ss = localStorage.getItem(RATINGS_SETTINGS_KEY);
      ratingsSettings = ss ? JSON.parse(ss) : { showOnHome: false };
    } catch(e) {
      ratings = [];
      ratingsSettings = { showOnHome: false };
    }
  }

  function saveRatings() {
    localStorage.setItem(RATINGS_KEY, JSON.stringify(ratings));
  }

  function saveRatingsSettings() {
    const showOnHome = document.getElementById('showRatingsOnHome')?.checked || false;
    ratingsSettings = { showOnHome };
    localStorage.setItem(RATINGS_SETTINGS_KEY, JSON.stringify(ratingsSettings));
    updateHomeRatings();
  }

  function setRating(stars) {
    currentRating = stars;
    const starsEl = document.querySelectorAll('#ratingStars .rating-star');
    starsEl.forEach((el, idx) => {
      el.textContent = idx < stars ? 'â˜…' : 'â˜†';
      el.style.color = idx < stars ? '#f59e0b' : '#d1d5db';
    });
  }

  function submitRating() {
    if (currentRating === 0) {
      alert('ÙØ¶Ù„Ø§Ù‹ Ø§Ø®ØªØ± Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø¬ÙˆÙ…');
      return;
    }
    const comment = document.getElementById('ratingComment')?.value || '';
    const name = answers.clientName || 'Ø¹Ù…ÙŠÙ„';
    const rating = {
      name,
      stars: currentRating,
      comment,
      date: new Date().toLocaleDateString('ar-SA'),
      published: false
    };
    ratings.push(rating);
    saveRatings();
    document.getElementById('ratingSuccess').style.display = 'block';
    document.getElementById('ratingSection').style.pointerEvents = 'none';
    document.getElementById('ratingSection').style.opacity = '0.7';
  }

  function renderRatingsTable() {
    const tbody = document.querySelector('#ratingsTable tbody');
    if (!tbody) return;
    tbody.innerHTML = '';
    ratings.forEach((r, idx) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${escapeHtml(r.name)}</td>
        <td>${'â˜…'.repeat(r.stars)}${'â˜†'.repeat(5-r.stars)}</td>
        <td style="max-width:150px; overflow:hidden; text-overflow:ellipsis;">${escapeHtml(r.comment || '-')}</td>
        <td>${r.date}</td>
        <td>${r.published ? 'âœ…' : 'âŒ'}</td>
        <td>
          <button class="btn small secondary" onclick="toggleRatingPublish(${idx})">${r.published ? 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù†Ø´Ø±' : 'Ù†Ø´Ø±'}</button>
          <button class="btn small secondary" onclick="deleteRating(${idx})">Ø­Ø°Ù</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
    document.getElementById('showRatingsOnHome').checked = ratingsSettings.showOnHome;
  }

  function toggleRatingPublish(idx) {
    ratings[idx].published = !ratings[idx].published;
    saveRatings();
    renderRatingsTable();
    updateHomeRatings();
  }

  function deleteRating(idx) {
    if (!confirm('Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…ØŸ')) return;
    ratings.splice(idx, 1);
    saveRatings();
    renderRatingsTable();
    updateHomeRatings();
  }

  function updateHomeRatings() {
    const container = document.getElementById('homeRatings');
    if (!container) return;
    if (!ratingsSettings.showOnHome) {
      container.style.display = 'none';
      return;
    }
    const published = ratings.filter(r => r.published);
    if (published.length === 0) {
      container.style.display = 'none';
      return;
    }
    container.style.display = 'block';
    container.innerHTML = `
      <h3 style="margin:0 0 10px; font-size:16px; color:#111827;">â­ Ø¢Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
      <div style="display:flex; flex-wrap:wrap; gap:10px; justify-content:center;">
        ${published.slice(0, 6).map(r => `
          <div style="background:#f9fafb; border-radius:12px; padding:10px; min-width:150px; text-align:right;">
            <div style="color:#f59e0b;">${'â˜…'.repeat(r.stars)}</div>
            <div style="font-size:13px; color:#374151; margin-top:4px;">${escapeHtml(r.comment || '')}</div>
            <div style="font-size:11px; color:#9ca3af; margin-top:4px;">- ${escapeHtml(r.name)}</div>
          </div>
        `).join('')}
      </div>
    `;
  }

  // ====== Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø®Ø§ØµØ© ======
  const OFFERS_KEY = 'stOffers';
  let offers = [];

  function loadOffers() {
    try {
      const s = localStorage.getItem(OFFERS_KEY);
      offers = s ? JSON.parse(s) : [];
    } catch(e) {
      offers = [];
    }
  }

  function saveOffersData() {
    localStorage.setItem(OFFERS_KEY, JSON.stringify(offers));
  }

  function clearOfferForm() {
    document.getElementById('offerTitle').value = '';
    document.getElementById('offerText').value = '';
    document.getElementById('offerTargetType').value = '';
    document.getElementById('offerMinAmount').value = '';
    document.getElementById('offerEnabled').value = 'true';
    document.getElementById('offerEditIndex').value = '';
  }

  function saveOffer(e) {
    e.preventDefault();
    const title = document.getElementById('offerTitle').value.trim();
    const text = document.getElementById('offerText').value.trim();
    const targetType = document.getElementById('offerTargetType').value;
    const minAmount = parseFloat(document.getElementById('offerMinAmount').value) || 0;
    const enabled = document.getElementById('offerEnabled').value === 'true';
    const editIndex = document.getElementById('offerEditIndex').value;

    if (!title || !text) {
      alert('ÙØ¶Ù„Ø§Ù‹ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù†Øµ');
      return;
    }

    const offer = { title, text, targetType, minAmount, enabled };

    if (editIndex === '') {
      offers.push(offer);
    } else {
      offers[parseInt(editIndex)] = offer;
    }

    saveOffersData();
    renderOffersTable();
    clearOfferForm();
  }

  function renderOffersTable() {
    const tbody = document.querySelector('#offersTable tbody');
    if (!tbody) return;
    tbody.innerHTML = '';
    offers.forEach((o, idx) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${escapeHtml(o.title)}</td>
        <td style="max-width:150px; overflow:hidden; text-overflow:ellipsis;">${escapeHtml(o.text)}</td>
        <td>${o.targetType || 'Ø§Ù„ÙƒÙ„'}</td>
        <td>${o.minAmount ? o.minAmount.toLocaleString() : '-'}</td>
        <td>${o.enabled ? 'Ù…ÙØ¹Ù‘Ù„' : 'Ù…ÙˆÙ‚Ù'}</td>
        <td>
          <button class="btn small secondary" onclick="editOffer(${idx})">ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="btn small secondary" onclick="deleteOffer(${idx})">Ø­Ø°Ù</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  function editOffer(idx) {
    const o = offers[idx];
    document.getElementById('offerTitle').value = o.title;
    document.getElementById('offerText').value = o.text;
    document.getElementById('offerTargetType').value = o.targetType || '';
    document.getElementById('offerMinAmount').value = o.minAmount || '';
    document.getElementById('offerEnabled').value = o.enabled ? 'true' : 'false';
    document.getElementById('offerEditIndex').value = idx;
  }

  function deleteOffer(idx) {
    if (!confirm('Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø±Ø¶ØŸ')) return;
    offers.splice(idx, 1);
    saveOffersData();
    renderOffersTable();
  }

  function getMatchingOffers(financeType, amount) {
    return offers.filter(o => {
      if (!o.enabled) return false;
      if (o.targetType && !financeType.includes(o.targetType.replace('ØªÙ…ÙˆÙŠÙ„ ', '').replace('Ø´Ø±Ø§Ø¡ ', ''))) return false;
      if (o.minAmount && amount < o.minAmount) return false;
      return true;
    });
  }

  // ====== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ³ÙˆÙŠÙ‚ ======
  const MARKETING_KEY = 'stMarketing';
  let marketingSettings = {
    showMarketing: true,
    marketingTitle: 'Ù†Ù†Ø¬Ø² ØªÙ…ÙˆÙŠÙ„Ùƒ Ø¨Ø£Ø³Ø±Ø¹ ÙˆÙ‚Øª!',
    marketingText: 'ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø§Ù„Ø­ÙŠÙ† ÙˆØ®Ù„Ù†Ø§ Ù†Ø³Ø§Ø¹Ø¯Ùƒ ÙÙŠ Ø¥ØªÙ…Ø§Ù… ØªÙ…ÙˆÙŠÙ„Ùƒ Ø¨Ø¯ÙˆÙ† ØªØ¹Ù‚ÙŠØ¯Ø§Øª âš¡ï¸',
    whatsapp: '966506214458',
    showContract: false,
    contractText: 'ğŸ“ Ø¥Ø¨Ø±Ø§Ù… Ø¹Ù‚Ø¯ ØªØ­ÙˆÙŠÙ„ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
    contractLink: '',
    showRating: true,
    showBankQuestion: true
  };

  function loadMarketingSettings() {
    try {
      const s = localStorage.getItem(MARKETING_KEY);
      if (s) marketingSettings = { ...marketingSettings, ...JSON.parse(s) };
    } catch(e) {}
  }

  function saveMarketingSettings() {
    marketingSettings = {
      showMarketing: document.getElementById('showMarketingSection')?.checked ?? true,
      marketingTitle: document.getElementById('marketingTitle')?.value || 'Ù†Ù†Ø¬Ø² ØªÙ…ÙˆÙŠÙ„Ùƒ Ø¨Ø£Ø³Ø±Ø¹ ÙˆÙ‚Øª!',
      marketingText: document.getElementById('marketingText')?.value || '',
      whatsapp: document.getElementById('marketingWhatsapp')?.value || '966506214458',
      showContract: document.getElementById('showContractButton')?.checked ?? false,
      contractText: document.getElementById('contractButtonText')?.value || 'ğŸ“ Ø¥Ø¨Ø±Ø§Ù… Ø¹Ù‚Ø¯ ØªØ­ÙˆÙŠÙ„ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
      contractLink: document.getElementById('contractLink')?.value || '',
      showRating: document.getElementById('showRatingSection')?.checked ?? true,
      showBankQuestion: marketingSettings.showBankQuestion
    };
    localStorage.setItem(MARKETING_KEY, JSON.stringify(marketingSettings));
    alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
  }

  function loadMarketingSettingsToUI() {
    const m = marketingSettings;
    if (document.getElementById('showMarketingSection')) document.getElementById('showMarketingSection').checked = m.showMarketing;
    if (document.getElementById('marketingTitle')) document.getElementById('marketingTitle').value = m.marketingTitle;
    if (document.getElementById('marketingText')) document.getElementById('marketingText').value = m.marketingText;
    if (document.getElementById('marketingWhatsapp')) document.getElementById('marketingWhatsapp').value = m.whatsapp;
    if (document.getElementById('showContractButton')) document.getElementById('showContractButton').checked = m.showContract;
    if (document.getElementById('contractButtonText')) document.getElementById('contractButtonText').value = m.contractText;
    if (document.getElementById('contractLink')) document.getElementById('contractLink').value = m.contractLink;
    if (document.getElementById('showRatingSection')) document.getElementById('showRatingSection').checked = m.showRating;
  }

  // ====== Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø®Ø§ØµØ© ======
  function showSpecialOffers(financeType, amount) {
    const matchingOffers = getMatchingOffers(financeType || '', amount || 0);
    const offersContainer = document.getElementById('offersSection');
    
    if (!offersContainer) {
      // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
      const resultPage = document.getElementById('resultPage');
      if (resultPage && matchingOffers.length > 0) {
        const div = document.createElement('div');
        div.id = 'offersSection';
        div.className = 'card fade-in';
        div.style.marginTop = '12px';
        div.style.background = 'linear-gradient(135deg, #ecfdf5, #d1fae5)';
        div.style.border = '2px solid #10b981';
        resultPage.querySelector('.card')?.after(div);
      }
    }
    
    const container = document.getElementById('offersSection');
    if (!container) return;
    
    if (matchingOffers.length === 0) {
      container.style.display = 'none';
      return;
    }
    
    container.style.display = 'block';
    const clientName = answers.clientName || 'Ø¹Ø²ÙŠØ²Ù†Ø§';
    container.innerHTML = matchingOffers.map(o => `
      <div style="text-align:center; padding:10px;">
        <div style="font-size:24px; margin-bottom:6px;">ğŸ</div>
        <h3 style="margin:0 0 6px; font-size:17px; color:#065f46;">${escapeHtml(o.title)}</h3>
        <p style="font-size:14px; color:#047857; margin:0;">${escapeHtml(o.text.replace(/ÙÙ„Ø§Ù†/g, clientName))}</p>
      </div>
    `).join('<hr style="border:none; border-top:1px dashed #10b981; margin:10px 0;">');
  }
  
  // ====== Ø¹Ø±Ø¶ Ù‚Ø³Ù… Ø§Ù„ØªØ³ÙˆÙŠÙ‚ ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ… ======
  function updateMarketingAndRatingDisplay() {
    const m = marketingSettings;
    
    // Ù‚Ø³Ù… Ø§Ù„ØªØ³ÙˆÙŠÙ‚
    const marketingSection = document.getElementById('marketingSection');
    if (marketingSection) {
      if (m.showMarketing) {
        marketingSection.style.display = 'block';
        marketingSection.innerHTML = `
          <div style="text-align:center;">
            <div style="font-size:24px; margin-bottom:6px;">ğŸš€</div>
            <h3 style="margin:0 0 6px; font-size:17px; color:#92400e;">${escapeHtml(m.marketingTitle)}</h3>
            <p style="font-size:14px; color:#78350f; margin-bottom:10px;">${escapeHtml(m.marketingText)}</p>
            <a href="https://wa.me/${m.whatsapp}" target="_blank" style="display:inline-block; background:linear-gradient(135deg,#25d366,#128c7e); color:#fff; padding:10px 24px; border-radius:25px; font-size:15px; font-weight:bold; text-decoration:none;">ğŸ“² ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</a>
          </div>
        `;
      } else {
        marketingSection.style.display = 'none';
      }
    }
    
    // Ø²Ø± Ø§Ù„Ø¹Ù‚Ø¯
    const contractSection = document.getElementById('contractSection');
    if (contractSection) {
      if (m.showContract && m.contractLink) {
        contractSection.style.display = 'block';
        contractSection.innerHTML = `
          <a href="${escapeHtml(m.contractLink)}" target="_blank" style="display:block; background:linear-gradient(135deg,#3b82f6,#1d4ed8); color:#fff; padding:12px 20px; border-radius:12px; font-size:16px; font-weight:bold; text-decoration:none; text-align:center;">${escapeHtml(m.contractText)}</a>
        `;
      } else {
        contractSection.style.display = 'none';
      }
    }
    
    // Ù‚Ø³Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
    const ratingSection = document.getElementById('ratingSection');
    if (ratingSection) {
      ratingSection.style.display = m.showRating ? 'block' : 'none';
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
      currentRating = 0;
      const starsEl = document.querySelectorAll('#ratingStars .rating-star');
      starsEl.forEach(el => {
        el.textContent = 'â˜†';
        el.style.color = '#d1d5db';
      });
      document.getElementById('ratingComment').value = '';
      document.getElementById('ratingSuccess').style.display = 'none';
      ratingSection.style.pointerEvents = 'auto';
      ratingSection.style.opacity = '1';
    }
  }

  // ====== Ø§Ù„Ø¬Ø²ÙŠØ¦Ø§Øª Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© ======
  function createParticles() {
    const container = document.getElementById('particles');
    if (!container) return;
    
    for (let i = 0; i < 50; i++) {
      const particle = document.createElement('div');
      particle.className = 'particle';
      particle.style.left = Math.random() * 100 + '%';
      particle.style.animationDelay = Math.random() * 20 + 's';
      particle.style.animationDuration = (15 + Math.random() * 10) + 's';
      container.appendChild(particle);
    }
  }
  
  // ====== Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ‚Øª ======
  function updateTimeGreeting() {
    const hour = new Date().getHours();
    const greetingEl = document.getElementById('timeGreeting');
    if (!greetingEl) return;
    
    let greeting = '';
    if (hour >= 5 && hour < 12) {
      greeting = 'ğŸŒ… ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±';
    } else if (hour >= 12 && hour < 17) {
      greeting = 'â˜€ï¸ Ù…Ø³Ø§Ø¡ Ø§Ù„Ù†ÙˆØ±';
    } else if (hour >= 17 && hour < 21) {
      greeting = 'ğŸŒ‡ Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±';
    } else {
      greeting = 'ğŸŒ™ Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ø§Ù„Ù„ÙŠÙ„';
    }
    greetingEl.textContent = greeting;
  }
  
  // ====== Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ======
  function hideSplashScreen() {
    const splash = document.getElementById('splashScreen');
    if (splash) {
      splash.classList.add('hidden');
      setTimeout(() => { splash.style.display = 'none'; }, 500);
    }
  }
  
  // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
  window.onload = function() {
    setTimeout(hideSplashScreen, 1000);
  };

  // ====== ØªØ´ØºÙŠÙ„ ======
  document.addEventListener('DOMContentLoaded', () => {
    // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø¨Ø¹Ø¯ 2.5 Ø«Ø§Ù†ÙŠØ©
    setTimeout(hideSplashScreen, 1500);
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø²ÙŠØ¦Ø§Øª Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©
    createParticles();
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ‚Øª
    updateTimeGreeting();
    
    showPage('landing');

    // (Ø¥Ø¶Ø§ÙØ©) ØªØ­Ù…ÙŠÙ„ Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙ…ÙˆÙŠÙ„ + Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯
    loadFinanceProducts();
    loadRetirementSettings();

    loadBankConfigs();
    renderArchiveTable();
    renderFinanceProductsTable();
    loadRetirementSettingsToUI();
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„ØªØ³ÙˆÙŠÙ‚
    loadRatings();
    loadOffers();
    loadMarketingSettings();
    renderRatingsTable();
    renderOffersTable();
    loadMarketingSettingsToUI();
    updateHomeRatings();

    updateDateTime();
    setInterval(updateDateTime, 1000);
  });
</script>

</body>
</html> 