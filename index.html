<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù…Ù†ØµØ© FINO - ØªØ±Ø´ÙŠØ­ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ</title>

  <!-- Tajawal -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800;900&display=swap" rel="stylesheet">

  <!-- html2canvas (Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙƒØµÙˆØ±Ø© JPG) -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <style>
    *{box-sizing:border-box}
    :root{
      --bg:#f3f4f6;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --brand1:#0f172a;
      --brand2:#1e3a8a;
      --ok:#16a34a;
      --bad:#dc2626;
      --warn:#b45309;
      --line:#e5e7eb;
      --shadow:0 10px 30px rgba(0,0,0,.08);
      --radius:18px;
    }
    body{
      margin:0;
      font-family:'Tajawal',system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
      background:var(--bg);
      color:var(--text);
      text-align:center;
      font-size:18px;
    }
    header{
      position:sticky; top:0; z-index:10;
      background:linear-gradient(135deg,var(--brand1),var(--brand2));
      color:#fff;
      padding:14px 10px;
      box-shadow:0 8px 20px rgba(0,0,0,.12);
    }
    header h1{margin:0;font-size:22px;font-weight:900;letter-spacing:.2px}
    header p{margin:6px 0 0;font-size:14px;opacity:.9}

    .wrap{max-width:980px;margin:18px auto;padding:0 12px}
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
      margin:14px 0;
    }

    .btn{
      appearance:none;border:0;cursor:pointer;
      padding:12px 14px;border-radius:14px;
      font-family:inherit;font-weight:900;font-size:18px;
      background:linear-gradient(135deg,#0ea5e9,#1d4ed8);
      color:#fff; box-shadow:0 10px 20px rgba(29,78,216,.18);
      width:100%;
    }
    .btn:active{transform:translateY(1px)}
    .btn.secondary{
      background:#fff;color:#111827;border:1px solid var(--line);
      box-shadow:none;
    }
    .grid{display:grid;gap:12px}
    @media(min-width:860px){
      .grid.two{grid-template-columns:1fr 1fr}
      .grid.three{grid-template-columns:1fr 1fr 1fr}
    }
    label{display:block;text-align:right;font-weight:800;margin:4px 0 8px}
    input,select{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      font-family:inherit;
      font-size:18px;
      outline:none;
      background:#fff;
    }
    input:focus,select:focus{border-color:#93c5fd;box-shadow:0 0 0 4px rgba(59,130,246,.12)}
    .hint{color:var(--muted);font-size:13px;text-align:right;line-height:1.6}
    .hr{height:1px;background:var(--line);margin:14px 0}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border:1px solid var(--line);
      border-radius:999px;background:#f9fafb;
      font-weight:900;
      margin:6px 4px;
    }
    .muted{color:var(--muted)}
    .row{
      display:flex;justify-content:space-between;gap:10px;
      padding:10px 0;border-bottom:1px dashed #eef2f7;
      text-align:right;
    }
    .row:last-child{border-bottom:0}
    .k{font-weight:900}
    .v{font-weight:900}
    .big{
      font-size:22px;font-weight:900;
      padding:12px;border-radius:16px;
      background:#f8fafc;border:1px solid var(--line);
      text-align:right;
    }
    .big .v{font-size:24px}
    .ok{color:var(--ok)}
    .bad{color:var(--bad)}
    .warn{color:var(--warn)}
    .small{font-size:13px}
    .center{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}

    /* Footer + Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ */
    footer{
      margin:18px 0 22px;
      color:var(--muted);
      font-size:13px;
    }
    .footerbar{
      display:flex;justify-content:center;align-items:center;gap:10px;flex-wrap:wrap;
    }

    /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ (ÙˆØ¨Ø¯Ø§Ø®Ù„Ù‡Ø§ Ø§Ù„Ø¯Ø®ÙˆÙ„) */
    .adminToolsBtn{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:999px;
      border:1px solid var(--line);
      background:#fff;
      font-weight:900;
      cursor:pointer;
      user-select:none;
    }
    .adminToolsBtn .dot{
      width:10px;height:10px;border-radius:50%;
      background:#93c5fd;
      box-shadow:0 0 0 4px rgba(147,197,253,.25);
    }

    /* Modal */
    .modal{
      position:fixed;inset:0;background:rgba(0,0,0,.45);
      display:none;align-items:center;justify-content:center;
      padding:14px;z-index:50;
    }
    .modal.show{display:flex}
    .modal .box{
      width:min(980px,100%);
      background:#fff;border-radius:18px;border:1px solid var(--line);
      box-shadow:0 18px 50px rgba(0,0,0,.25);
      padding:14px;
      text-align:right;
    }
    .modal .head{
      display:flex;justify-content:space-between;align-items:center;gap:12px;
      padding:6px 6px 10px;
    }
    .modal .head h2{margin:0;font-size:18px;font-weight:900}
    .x{
      border:1px solid var(--line);
      background:#fff;border-radius:12px;
      width:44px;height:44px;cursor:pointer;
      font-size:18px;font-weight:900;
    }
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 12px}
    .tab{
      padding:10px 12px;border-radius:999px;border:1px solid var(--line);
      background:#fff;font-weight:900;cursor:pointer;
    }
    .tab.active{background:#eff6ff;border-color:#bfdbfe}
    .table{
      width:100%;border-collapse:separate;border-spacing:0 8px;
      text-align:right;
    }
    .table th{font-size:12px;color:var(--muted);font-weight:900;padding:6px 8px}
    .table td{
      background:#f9fafb;border:1px solid var(--line);
      padding:10px 8px;
    }
    .table td:first-child{border-top-right-radius:14px;border-bottom-right-radius:14px}
    .table td:last-child{border-top-left-radius:14px;border-bottom-left-radius:14px}
    .miniBtn{
      padding:10px 12px;border-radius:12px;border:1px solid var(--line);
      background:#fff;font-weight:900;cursor:pointer;
    }
    .miniBtn.danger{border-color:#fecaca;background:#fff5f5;color:#991b1b}
    .miniBtn.primary{border-color:#bfdbfe;background:#eff6ff}
    .right{display:flex;gap:8px;justify-content:flex-end;flex-wrap:wrap}
    .hide{display:none!important}

    /* Ù†ØªÙŠØ¬Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø­ÙØ¸ Ø¨ØµÙˆØ±Ø© */
    #resultShot{
      background:#fff; /* Ù…Ù‡Ù… Ù„Ù„Ù€ JPG */
      border-radius:18px;
      border:1px solid var(--line);
      padding:14px;
    }
    .brandLine{
      display:flex;justify-content:space-between;align-items:center;gap:10px;
      flex-wrap:wrap;
    }
    .brandBadge{
      padding:8px 10px;border-radius:999px;
      border:1px solid var(--line);
      background:#f8fafc;font-weight:900;
    }
  </style>
</head>

<body>
  <header>
    <h1>FINO â€” ØªØ±Ø´ÙŠØ­ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ</h1>
    <p>Ø­Ø§Ø³Ø¨Ø© Ø³Ø±ÙŠØ¹Ø© + ØªØ±Ø´ÙŠØ­ Ø£ÙØ¶Ù„ Ø¹Ø±Ø¶ (ØªÙ‚Ø±ÙŠØ¨ÙŠ) Ø­Ø³Ø¨ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ</p>
  </header>

  <div class="wrap">

    <!-- Start -->
    <div class="card" id="startCard">
      <div class="center">
        <span class="pill">âš¡ Ø³Ø±ÙŠØ¹</span>
        <span class="pill">ğŸ”’ Ø®ØµÙˆØµÙŠØ©</span>
        <span class="pill">ğŸ“Œ ØªÙ‚Ø¯ÙŠØ±ÙŠ</span>
      </div>
      <div class="hr"></div>
      <button class="btn" id="startBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø­Ø³Ø¨Ø©</button>
      <div class="hint" style="margin-top:10px">
        ØªÙ†ÙˆÙŠÙ‡: Ù„Ø³Ù†Ø§ Ø¬Ù‡Ø© ØªÙ…ÙˆÙŠÙ„ÙŠØ©ØŒ ÙˆØ¯ÙˆØ±Ù†Ø§ ÙŠÙ‚ØªØµØ± Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ³Ø§Ø·Ø© ÙˆØªØ±Ø´ÙŠØ­ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø¹Ø¨Ø± Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø±Ø®Ù‘ØµØ©.
      </div>
    </div>

    <!-- Form -->
    <div class="card hide" id="formCard">
      <div class="grid two">
        <div>
          <label>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ ØªØ±ÙŠØ¯ Ø­Ø³Ø¨ØªÙ‡:</label>
          <select id="loanType">
            <option value="mortgage">ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ</option>
            <option value="personal">ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ Ø£Ùˆ ØªÙ…ÙˆÙŠÙ„ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ</option>
            <option value="debt_personal">Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© (Ø´Ø®ØµÙŠ)</option>
            <option value="debt_mortgage">Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© (Ø¹Ù‚Ø§Ø±ÙŠ)</option>
          </select>
        </div>

        <div>
          <label>Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…</label>
          <input id="clientName" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯" />
          <div class="hint">Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„Ø§Ø³Ù… ÙÙŠ Ø§Ù„Ù†ØªÙŠØ¬Ø©: â€œÙ…Ø±Ø­Ø¨Ø§Ù‹ ÙˆÙ…Ø³Ù‡Ù„Ø§ ÙŠØ§ â€¦â€</div>
        </div>

        <div>
          <label>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ (Ø±ÙŠØ§Ù„)</label>
          <input id="salary" type="number" inputmode="numeric" placeholder="Ù…Ø«Ø§Ù„: 12000" />
        </div>

        <div>
          <label>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ© (Ø±ÙŠØ§Ù„)</label>
          <input id="commitments" type="number" inputmode="numeric" placeholder="Ù…Ø«Ø§Ù„: 2500" value="0" />
          <div class="hint">Ø¥Ù† Ù…Ø§ Ø¹Ù†Ø¯Ùƒ Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§ØªØ±ÙƒÙ‡ 0</div>
        </div>

        <div>
          <label>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ¸ÙŠÙØ©</label>
          <select id="jobType">
            <option value="civil">Ù…Ø¯Ù†ÙŠ</option>
            <option value="military">Ø¹Ø³ÙƒØ±ÙŠ</option>
            <option value="private_gov">Ø®Ø§Øµ Ø´Ø¨Ù‡ Ø­ÙƒÙˆÙ…ÙŠ</option>
            <option value="private_ok">Ø®Ø§Øµ Ù…Ø¹ØªÙ…Ø¯</option>
            <option value="private_no">Ø®Ø§Øµ ØºÙŠØ± Ù…Ø¹ØªÙ…Ø¯</option>
          </select>
          <div class="hint" id="jobWarn" style="display:none">
            <span class="bad">ØªÙ†Ø¨ÙŠÙ‡:</span> Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø®Ø§Øµ Ø¬Ù…ÙŠØ¹Ø§Ù‹ Ù„Ø§Ø¨Ø¯ Ø§Ø¹ØªÙ…Ø§Ø¯Ù‡ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ù…ÙˆÙ„Ø©.
          </div>
        </div>

        <div id="monthsWrap">
          <label>Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ (Ø¨Ø§Ù„Ø£Ø´Ù‡Ø±)</label>
          <select id="months">
            <!-- ÙŠØ¹Ø¨Ù‘Ù‰ ØªÙ„Ù‚Ø§Ø¦ÙŠ -->
          </select>
          <div class="hint" id="monthsHint"></div>
        </div>
      </div>

      <div class="hr"></div>

      <!-- Mortgage options -->
      <div id="mortgageOptions" class="hide">
        <div class="grid two">
          <div>
            <label>Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ</label>
            <select id="mortgageSupport">
              <option value="supported">Ù…Ø¯Ø¹ÙˆÙ…</option>
              <option value="unsupported">ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…</option>
            </select>
          </div>
          <div>
            <label>Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø© Ù…Ù† Ø³ÙƒÙ†ÙŠØŸ</label>
            <select id="sakaniDown">
              <option value="yes">Ù†Ø¹Ù…</option>
              <option value="no">Ù„Ø§</option>
            </select>
            <div class="hint">Ø¥Ø°Ø§ ÙƒØ§Ù† â€œÙ…Ø¯Ø¹ÙˆÙ…â€ + Ø§Ø®ØªØ±Øª â€œÙ„Ø§â€ ÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø´Ù‡Ø±ÙŠ (Ø­Ø³Ø¨ Ø¬Ø¯ÙˆÙ„Ùƒ) **Ø¨Ø¯ÙˆÙ† Ø¥Ø¶Ø§ÙØªÙ‡ Ø¹Ù„Ù‰ Ø§Ù„ØµØ§ÙÙŠ**.</div>
          </div>

          <div>
            <label>Ù‡Ù„ Ø£Ù†Øª Ù…Ø³ØªÙÙŠØ¯ Ù…Ù† â€œØ§Ø¹ØªØ²Ø§Ø²â€ (Ù„Ù„Ø¹Ø³ÙƒØ±ÙŠ)ØŸ</label>
            <select id="itizaz">
              <option value="no">Ù„Ø§</option>
              <option value="yes">Ù†Ø¹Ù…</option>
            </select>
            <div class="hint">
              Ø§Ø¹ØªØ²Ø§Ø²: ÙŠÙØ¹Ø±Ø¶ ÙƒØ¯Ø¹Ù… Ù…Ø³ØªÙ‚Ù„ (Ø§ÙØªØ±Ø§Ø¶ÙŠ 160,000) ÙˆÙ„Ø§ ÙŠØªØ¹Ø§Ø±Ø¶ Ù…Ø¹ Ø¯Ø¹Ù… Ø³ÙƒÙ†ÙŠ.
              <div class="bad small" style="margin-top:6px">
                ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù…Ù† Ù„Ø¯ÙŠÙ‡ Ø§Ø¹ØªØ²Ø§Ø²: Ø¯Ø¹Ù… ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯ÙØ§Ø¹ ØªØ¨Ø¯Ø£ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø¨Ø¹Ø¯ Ø³Ù†ØªÙŠÙ† ÙˆÙ„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ù„Ù‚Ø³Ø· Ù‡Ù†Ø§ â€” ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø¬Ù‡Ø© Ø¹Ù…Ù„Ùƒ Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„ØªÙØ§ØµÙŠÙ„.
              </div>
            </div>
          </div>

          <div>
            <label>Ù‚ÙŠÙ…Ø© Ø¯Ø¹Ù… â€œØ³ÙƒÙ†ÙŠâ€ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ (ØºÙŠØ± Ø´Ù‡Ø±ÙŠ) Ø¥Ù† ÙˆØ¬Ø¯ (Ø±ÙŠØ§Ù„)</label>
            <input id="sakaniLump" type="number" inputmode="numeric" placeholder="Ù…Ø«Ø§Ù„: 100000" value="0" />
            <div class="hint">Ù‡Ø°Ø§ Ø¯Ø¹Ù… ØºÙŠØ± Ø´Ù‡Ø±ÙŠ (Ù…Ø¨Ù„Øº)ØŒ ÙŠØ¹Ø±Ø¶ Ù…Ù†ÙØµÙ„ ÙˆÙŠÙ…ÙƒÙ† Ø¬Ù…Ø¹Ù‡ ÙÙŠ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø¹Ù… (ØºÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ).</div>
          </div>
        </div>
      </div>

      <!-- Personal / Debt options -->
      <div id="personalOptions" class="hide">
        <div class="grid two">
          <div>
            <label>Ø±Ø³ÙˆÙ… Ø¥Ø¯Ø§Ø±ÙŠØ© (Ø±ÙŠØ§Ù„) - ØªÙ‚Ø¯ÙŠØ±ÙŠ</label>
            <input id="adminFees" type="number" inputmode="numeric" placeholder="Ù…Ø«Ø§Ù„: 5000" value="0" />
            <div class="hint">Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© ØªÙØ¹Ø±Ø¶ ÙƒÙ†Øµ ØµØºÙŠØ±: â€œØ¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©â€.</div>
          </div>
          <div>
            <label>Ù†Ø³Ø¨Ø© Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© Ù„Ù„Ø±Ø³ÙˆÙ… (%)</label>
            <input id="vatPct" type="number" inputmode="numeric" value="15" />
          </div>
        </div>
      </div>

      <div class="hr"></div>
      <button class="btn" id="calcBtn">Ø§Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
      <div class="hint" style="margin-top:10px">
        Ø§Ù„Ù†ØªÙŠØ¬Ø© ØªÙ‚Ø±ÙŠØ¨ÙŠØ© ÙˆØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¬Ù‡Ø§Øª â€” ÙˆÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ù†Ø³Ø¨ Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø¯Ø¹Ù… Ù…Ù† â€œØ£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„â€.
      </div>
    </div>

    <!-- Result -->
    <div class="card hide" id="resultCard">
      <div id="resultShot">
        <div class="brandLine">
          <div class="brandBadge">FINO</div>
          <div class="brandBadge" id="todayLine"></div>
        </div>
        <div class="hr"></div>

        <div id="welcomeLine" class="big" style="background:#eff6ff;border-color:#bfdbfe">
          <div class="k" style="color:#1e3a8a">Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙˆÙ…Ø³Ù‡Ù„Ø§</div>
          <div class="v" style="color:#1e3a8a" id="welcomeName">ÙŠØ§ â€¦</div>
        </div>

        <div class="hr"></div>

        <div id="cannotBox" class="hide" style="padding:12px;border-radius:16px;border:1px solid #fecaca;background:#fff5f5;text-align:right">
          <div class="bad" style="font-weight:900;font-size:20px">Ù†Ø¹ØªØ°Ø± Ù…Ù†Ùƒ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙ…ÙˆÙŠÙ„Ùƒ</div>
          <div class="muted small" style="margin-top:6px">Ø§Ù„Ø³Ø¨Ø¨: Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…ØªØ§Ø­Ø© Ø³Ø§Ù„Ø¨Ø© Ø£Ùˆ ØºÙŠØ± Ù…Ù†Ø§Ø³Ø¨Ø© Ø­Ø³Ø¨ Ø¥Ø¯Ø®Ø§Ù„Ø§ØªÙƒ.</div>
        </div>

        <div id="okBox">
          <div class="row">
            <div class="k">Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„</div>
            <div class="v" id="rType">â€”</div>
          </div>
          <div class="row">
            <div class="k">Ø£ÙØ¶Ù„ Ø¬Ù‡Ø© (ØªØ±Ø´ÙŠØ­)</div>
            <div class="v" id="rBest">â€”</div>
          </div>
          <div class="row">
            <div class="k">Ø§Ù„Ù†Ø³Ø¨Ø©/Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø³Ù†ÙˆÙŠ (ØªÙ‚Ø±ÙŠØ¨ÙŠ)</div>
            <div class="v" id="rRate">â€”</div>
          </div>
          <div class="row">
            <div class="k">Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ (ØªÙ‚Ø±ÙŠØ¨ÙŠ)</div>
            <div class="v" id="rInst">â€”</div>
          </div>
          <div class="row">
            <div class="k">Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„</div>
            <div class="v" id="rMonths">â€”</div>
          </div>

          <div class="hr"></div>

          <!-- Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„ÙˆØ§Ø¶Ø­ -->
          <div class="big">
            <div class="k" style="color:#0f172a">ØªÙ…ÙˆÙŠÙ„Ùƒ Ø§Ù„ØµØ§ÙÙŠ Ø¨Ø¹Ø¯ Ø®ØµÙ… Ø§Ù„Ø±Ø³ÙˆÙ…</div>
            <div class="v ok" id="rNet">â€”</div>
            <div class="hint" style="margin-top:6px">
              * Ù‡Ø°Ø§ Ø§Ù„ØµØ§ÙÙŠ Ù„Ø§ ÙŠØ´Ù…Ù„ Ø£ÙŠ Ø¯Ø¹Ù… Ø´Ù‡Ø±ÙŠ (ÙŠØ¹Ø±Ø¶ Ù…Ù†ÙØµÙ„).
            </div>
          </div>

          <div class="hr"></div>

          <!-- Ø¯Ø¹Ù… Ø­ÙƒÙˆÙ…ÙŠ Ø´Ù‡Ø±ÙŠ: ÙŠØ¹Ø±Ø¶ ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† Ø¥Ø¶Ø§ÙØ© -->
          <div class="row" id="monthlySupportRow" style="display:none">
            <div class="k">Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠ Ø§Ù„Ø´Ù‡Ø±ÙŠ (ØªÙ‚Ø±ÙŠØ¨ÙŠ)</div>
            <div class="v" id="rMonthlySupport">â€”</div>
          </div>

          <div class="row" id="itizazRow" style="display:none">
            <div class="k">Ø¯Ø¹Ù… Ø§Ø¹ØªØ²Ø§Ø² (Ù„Ù„Ø¹Ø³ÙƒØ±ÙŠ) â€” Ù…Ø³ØªÙ‚Ù„</div>
            <div class="v" id="rItizaz">â€”</div>
          </div>

          <div class="row" id="sakaniLumpRow" style="display:none">
            <div class="k">Ø¯Ø¹Ù… Ø³ÙƒÙ†ÙŠ (ØºÙŠØ± Ø´Ù‡Ø±ÙŠ) â€” Ù…Ø³ØªÙ‚Ù„</div>
            <div class="v" id="rSakaniLump">â€”</div>
          </div>

          <div class="row" id="totalAidRow" style="display:none">
            <div class="k">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø¹Ù… (ØºÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ) Ø§Ù„Ù…Ø¶Ø§Ù</div>
            <div class="v ok" id="rAidTotal">â€”</div>
          </div>

          <div class="row" id="netPlusAidRow" style="display:none">
            <div class="k">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠ (ØµØ§ÙÙŠ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ + Ø¯Ø¹Ù… ØºÙŠØ± Ø´Ù‡Ø±ÙŠ)</div>
            <div class="v ok" id="rNetPlusAid">â€”</div>
          </div>

          <div class="hr"></div>

          <div class="row">
            <div class="k">Ø§Ù„Ø±Ø¨Ø­ Ø¯ÙˆÙ† Ø§Ù„Ø±Ø³ÙˆÙ…</div>
            <div class="v bad" id="rProfitNoFees">â€”</div>
          </div>
          <div class="row">
            <div class="k">Ø§Ù„Ø±Ø¨Ø­ Ù…Ø¹ Ø§Ù„Ø±Ø³ÙˆÙ…</div>
            <div class="v bad" id="rProfitWithFees">â€”</div>
          </div>

          <div class="hint" style="margin-top:10px;text-align:right">
            <span class="small muted">Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø§Ø¯Ø§Ø±ÙŠØ©</span>
          </div>

          <div id="jobRedNote" class="hide" style="margin-top:10px;padding:10px;border-radius:14px;border:1px solid #fde68a;background:#fffbeb;text-align:right">
            <div class="warn" style="font-weight:900">ØªÙ†Ø¨ÙŠÙ‡:</div>
            <div class="muted small">Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø®Ø§Øµ Ø¬Ù…ÙŠØ¹Ø§Ù‹ Ù„Ø§Ø¨Ø¯ Ø§Ø¹ØªÙ…Ø§Ø¯Ù‡ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ù…ÙˆÙ„Ø©.</div>
          </div>
        </div>
      </div>

      <div class="hr"></div>

      <div class="grid two">
        <button class="btn" id="saveJpgBtn">Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙƒØµÙˆØ±Ø© JPG</button>
        <button class="btn secondary" id="resetBtn">ğŸ” Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø¨Ø©</button>
      </div>
      <div class="hint" style="margin-top:10px">
        * Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¶Ø¨ÙˆØ· Ø¨Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ© ÙˆØ®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡ Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©.
      </div>
    </div>

    <footer>
      <div class="footerbar">
        <div class="adminToolsBtn" id="adminToolsBtn" title="Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„">
          <span class="dot"></span>
          ğŸ§° Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„
          <span class="muted small">(ÙŠØªØ¶Ù…Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„)</span>
        </div>
        <div>Â© Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± â€” FINO</div>
      </div>
    </footer>

  </div>

  <!-- Modal: Admin Tools (ÙˆÙÙŠÙ‡ Ø§Ù„Ø¯Ø®ÙˆÙ„) -->
  <div class="modal" id="adminModal">
    <div class="box">
      <div class="head">
        <h2>ğŸ§° Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h2>
        <button class="x" id="closeAdmin">âœ•</button>
      </div>

      <!-- Login (Ø¯Ø§Ø®Ù„ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„) -->
      <div id="adminLoginBox">
        <div class="card" style="margin:0">
          <div style="font-weight:900;margin-bottom:8px">ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</div>
          <div class="hint">Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„ÙØªØ­ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ¹Ø¯ÙŠÙ„. (Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: <b>9999</b>)</div>
          <div class="grid two" style="margin-top:10px">
            <div>
              <input id="adminPin" type="password" inputmode="numeric" placeholder="Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„" />
            </div>
            <div>
              <button class="btn" id="adminLoginBtn" style="height:48px">Ø¯Ø®ÙˆÙ„</button>
            </div>
          </div>
          <div id="adminLoginErr" class="bad small" style="display:none;text-align:right;margin-top:8px;font-weight:900">
            Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­.
          </div>
          <div class="hint" style="margin-top:10px">
            ØªÙ†Ø¨ÙŠÙ‡: Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ ÙÙ‚Ø·.
          </div>
        </div>
      </div>

      <!-- Tools -->
      <div id="adminToolsBox" class="hide">
        <div class="tabs">
          <div class="tab active" data-tab="offers">Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¬Ù‡Ø§Øª</div>
          <div class="tab" data-tab="support">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø´Ù‡Ø±ÙŠ</div>
          <div class="tab" data-tab="settings">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
        </div>

        <!-- Offers -->
        <div id="tab_offers">
          <div class="hint">ØªÙ‚Ø¯Ø± ØªØ¹Ø¯Ù„ Ø§Ù„Ù†Ø³Ø¨ Ø£Ùˆ ØªØ¶ÙŠÙ/ØªØ­Ø°Ù Ø¹Ø±ÙˆØ¶ØŒ ÙˆÙŠØªÙ… Ø­ÙØ¸Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.</div>
          <div class="hr"></div>

          <div class="grid three">
            <div>
              <label>Ø§Ù„Ø¬Ù‡Ø©</label>
              <input id="oName" placeholder="Ù…Ø«Ø§Ù„: Ø¨Ù†Ùƒ Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ" />
            </div>
            <div>
              <label>Ø§Ù„Ù†ÙˆØ¹</label>
              <select id="oType">
                <option value="mortgage">ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ</option>
                <option value="personal">ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ/Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ</option>
                <option value="debt_personal">Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© (Ø´Ø®ØµÙŠ)</option>
                <option value="debt_mortgage">Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© (Ø¹Ù‚Ø§Ø±ÙŠ)</option>
              </select>
            </div>
            <div>
              <label>Ù†Ø³Ø¨Ø© Ø³Ù†ÙˆÙŠØ© %</label>
              <input id="oRate" type="number" inputmode="decimal" placeholder="Ù…Ø«Ø§Ù„: 5.5" />
            </div>
          </div>

          <div class="right" style="margin-top:10px">
            <button class="miniBtn primary" id="addOfferBtn">â• Ø¥Ø¶Ø§ÙØ©/Ø­ÙØ¸</button>
            <button class="miniBtn" id="clearOfferFormBtn">Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„</button>
          </div>

          <div class="hr"></div>

          <table class="table" id="offersTable">
            <thead>
              <tr>
                <th>Ø§Ù„Ø¬Ù‡Ø©</th>
                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                <th>Ø§Ù„Ù†Ø³Ø¨Ø© %</th>
                <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- Support table -->
        <div id="tab_support" class="hide">
          <div class="hint">
            Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙŠÙØ³ØªØ®Ø¯Ù… Ø¹Ù†Ø¯Ù…Ø§: (ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ â€œÙ…Ø¯Ø¹ÙˆÙ…â€) + (Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø© Ù…Ù† Ø³ÙƒÙ†ÙŠ = â€œÙ„Ø§â€).<br>
            **Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø´Ù‡Ø±ÙŠ ÙŠÙØ¹Ø±Ø¶ ÙÙŠ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙ‚Ø· ÙˆÙ„Ø§ ÙŠÙØ¶Ø§Ù Ø¹Ù„Ù‰ Ø§Ù„ØµØ§ÙÙŠ**.
          </div>
          <div class="hr"></div>

          <div class="grid three">
            <div>
              <label>Ù…Ù† Ø±Ø§ØªØ¨</label>
              <input id="sFrom" type="number" inputmode="numeric" placeholder="Ù…Ø«Ø§Ù„: 0" />
            </div>
            <div>
              <label>Ø¥Ù„Ù‰ Ø±Ø§ØªØ¨</label>
              <input id="sTo" type="number" inputmode="numeric" placeholder="Ù…Ø«Ø§Ù„: 9999" />
            </div>
            <div>
              <label>Ø¯Ø¹Ù… Ø´Ù‡Ø±ÙŠ (Ø±ÙŠØ§Ù„)</label>
              <input id="sAmt" type="number" inputmode="numeric" placeholder="Ù…Ø«Ø§Ù„: 1000" />
            </div>
          </div>

          <div class="right" style="margin-top:10px">
            <button class="miniBtn primary" id="addSupportRowBtn">â• Ø¥Ø¶Ø§ÙØ©/Ø­ÙØ¸</button>
            <button class="miniBtn" id="resetSupportDefaultBtn">Ø¥Ø±Ø¬Ø§Ø¹ Ø§ÙØªØ±Ø§Ø¶ÙŠ</button>
          </div>

          <div class="hr"></div>

          <table class="table" id="supportTable">
            <thead>
              <tr>
                <th>Ù…Ù†</th>
                <th>Ø¥Ù„Ù‰</th>
                <th>Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø´Ù‡Ø±ÙŠ</th>
                <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- Settings -->
        <div id="tab_settings" class="hide">
          <div class="grid two">
            <div class="card" style="margin:0">
              <div style="font-weight:900;margin-bottom:6px">ğŸ”‘ ØªØºÙŠÙŠØ± Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
              <div class="hint">Ø¥Ø°Ø§ ØªØ¨ÙŠ ØªØºÙŠÙ‘Ø± Ø±Ù…Ø² 9999.</div>
              <div class="grid two" style="margin-top:10px">
                <input id="newPin" type="password" inputmode="numeric" placeholder="Ø±Ù…Ø² Ø¬Ø¯ÙŠØ¯" />
                <button class="miniBtn primary" id="savePinBtn">Ø­ÙØ¸</button>
              </div>
              <div id="pinSaved" class="ok small" style="display:none;margin-top:8px;font-weight:900">ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø±Ù…Ø².</div>
            </div>

            <div class="card" style="margin:0">
              <div style="font-weight:900;margin-bottom:6px">ğŸ§¹ ØªØµÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
              <div class="hint">ÙŠØ±Ø¬Ø¹ Ø§Ù„Ø¹Ø±ÙˆØ¶/Ø§Ù„Ø¯Ø¹Ù… Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ.</div>
              <div class="right" style="margin-top:10px">
                <button class="miniBtn danger" id="wipeAllBtn">ØªØµÙÙŠØ±</button>
              </div>
              <div class="hint" style="margin-top:8px">
                * ÙŠØªÙ… Ø§Ù„ØªØµÙÙŠØ± Ø¯Ø§Ø®Ù„ Ø¬Ù‡Ø§Ø²Ùƒ ÙÙ‚Ø· (localStorage).
              </div>
            </div>
          </div>
        </div>

      </div><!-- /adminToolsBox -->
    </div>
  </div>

<script>
/* ==========================
   Helpers
========================== */
const fmt = (n)=> {
  if (n===null || n===undefined || isNaN(n)) return "â€”";
  return Math.round(n).toLocaleString("ar-SA") + " Ø±ÙŠØ§Ù„";
};
const pct = (n)=> (isNaN(n) ? "â€”" : (Number(n).toFixed(2) + "%"));
const byId = (id)=> document.getElementById(id);

function todayText(){
  const d = new Date();
  const days = ["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ø³Ø¨Øª"];
  return `${days[d.getDay()]} ${d.getFullYear()}/${String(d.getMonth()+1).padStart(2,"0")}/${String(d.getDate()).padStart(2,"0")} â€” ${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}`;
}

/* ==========================
   Storage (Offers & Support & Pin)
========================== */
const LS_KEYS = {
  OFFERS:"fino_offers_v1",
  SUPPORT:"fino_support_v1",
  PIN:"fino_admin_pin_v1"
};

// Defaults
const defaultOffers = [
  {id:cryptoId(), name:"Ø¨Ù†Ùƒ Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ", type:"mortgage", rate:5.65},
  {id:cryptoId(), name:"Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ (SNB)", type:"mortgage", rate:5.75},
  {id:cryptoId(), name:"Ø¨Ù†Ùƒ Ø§Ù„Ø¥Ù†Ù…Ø§Ø¡", type:"mortgage", rate:5.85},
  {id:cryptoId(), name:"Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶", type:"mortgage", rate:5.95},
  {id:cryptoId(), name:"SABB", type:"mortgage", rate:6.10},
  {id:cryptoId(), name:"Ø¨Ù†Ùƒ Ø§Ù„Ø¨Ù„Ø§Ø¯", type:"personal", rate:6.25},
  {id:cryptoId(), name:"Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ (SNB)", type:"personal", rate:6.10},
  {id:cryptoId(), name:"Ø´Ø±ÙƒØ© Ø¥Ù…ÙƒØ§Ù† Ù„Ù„ØªÙ…ÙˆÙŠÙ„", type:"personal", rate:6.90},
  {id:cryptoId(), name:"Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© (Ø´Ø®ØµÙŠ) - Ø¨Ù†Ùƒ Ø§Ù„Ø¨Ù„Ø§Ø¯", type:"debt_personal", rate:6.10},
  {id:cryptoId(), name:"Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© (Ø¹Ù‚Ø§Ø±ÙŠ) - Ø¬Ù‡Ø©", type:"debt_mortgage", rate:5.95}
];

const defaultSupport = [
  // Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ø¹Ø¯Ù„Ù‡ Ø­Ø³Ø¨ Ø¬Ø¯ÙˆÙ„Ùƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù…Ù† Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„)
  {id:cryptoId(), from:0, to:7999, amt:416},
  {id:cryptoId(), from:8000, to:9999, amt:833},
  {id:cryptoId(), from:10000, to:11999, amt:1250},
  {id:cryptoId(), from:12000, to:14999, amt:1666},
  {id:cryptoId(), from:15000, to:999999, amt:0}
];

function cryptoId(){
  return (crypto?.randomUUID?.() || ("id_"+Math.random().toString(16).slice(2)));
}

function loadOffers(){
  try{
    const v = JSON.parse(localStorage.getItem(LS_KEYS.OFFERS));
    return Array.isArray(v) && v.length ? v : defaultOffers;
  }catch(e){ return defaultOffers; }
}
function saveOffers(arr){ localStorage.setItem(LS_KEYS.OFFERS, JSON.stringify(arr)); }

function loadSupport(){
  try{
    const v = JSON.parse(localStorage.getItem(LS_KEYS.SUPPORT));
    return Array.isArray(v) && v.length ? v : defaultSupport;
  }catch(e){ return defaultSupport; }
}
function saveSupport(arr){ localStorage.setItem(LS_KEYS.SUPPORT, JSON.stringify(arr)); }

function loadPin(){
  return localStorage.getItem(LS_KEYS.PIN) || "9999";
}
function savePin(pin){
  localStorage.setItem(LS_KEYS.PIN, pin);
}

/* ==========================
   App State
========================== */
let OFFERS = loadOffers();
let SUPPORT = loadSupport();
let editingOfferId = null;
let editingSupportId = null;

/* ==========================
   UI: Init
========================== */
byId("todayLine").textContent = todayText();

const startBtn = byId("startBtn");
const startCard = byId("startCard");
const formCard = byId("formCard");
const resultCard = byId("resultCard");

const loanType = byId("loanType");
const months = byId("months");
const monthsHint = byId("monthsHint");
const mortgageOptions = byId("mortgageOptions");
const personalOptions = byId("personalOptions");

function fillMonths(type){
  months.innerHTML = "";
  let max = 360;
  let def = 240;

  if (type === "personal" || type === "debt_personal"){
    max = 60;
    def = 60;
  }else if(type === "debt_mortgage"){
    max = 360;
    def = 240;
  }else{
    max = 360;
    def = 240;
  }

  for(let i=1;i<=max;i++){
    const op = document.createElement("option");
    op.value = i;
    op.textContent = i + " Ø´Ù‡Ø±";
    if (i===def) op.selected = true;
    months.appendChild(op);
  }

  monthsHint.textContent =
    (type === "personal" || type === "debt_personal")
      ? "Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø´Ø®ØµÙŠ 60 Ø´Ù‡Ø±."
      : "Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø¹Ù‚Ø§Ø±ÙŠ 360 Ø´Ù‡Ø±.";
}

function toggleOptions(){
  const t = loanType.value;
  mortgageOptions.classList.toggle("hide", t !== "mortgage" && t !== "debt_mortgage");
  personalOptions.classList.toggle("hide", t === "mortgage" || t === "debt_mortgage");
}

fillMonths(loanType.value);
toggleOptions();

startBtn.addEventListener("click", ()=>{
  startCard.classList.add("hide");
  formCard.classList.remove("hide");
});

loanType.addEventListener("change", ()=>{
  fillMonths(loanType.value);
  toggleOptions();
});

byId("jobType").addEventListener("change", ()=>{
  const v = byId("jobType").value;
  byId("jobWarn").style.display = (v !== "civil" && v !== "military") ? "block" : "none";
});

/* ==========================
   Core Calculation (ØªÙ‚Ø¯ÙŠØ±ÙŠ)
========================== */
function getMonthlySupport(salary){
  // ÙŠØ¨Ø­Ø« ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯Ø¹Ù…
  for(const r of SUPPORT){
    if (salary >= r.from && salary <= r.to) return Number(r.amt)||0;
  }
  return 0;
}

function pickBestOffer(type){
  const list = OFFERS.filter(o => o.type === type);
  if(!list.length) return null;
  // Ø£Ù‚Ù„ Ù†Ø³Ø¨Ø© = Ø£ÙØ¶Ù„
  return list.slice().sort((a,b)=>(Number(a.rate)-Number(b.rate)))[0];
}

// ØªÙ‚Ø¯ÙŠØ± ØªÙ…ÙˆÙŠÙ„ Ù…Ù† Ù‚Ø³Ø·: (ØªÙ‚Ø±ÙŠØ¨ÙŠ) PV of annuity
function estimateFinanceFromInstallment(installment, annualRatePct, months){
  const r = (Number(annualRatePct)/100)/12;
  const n = Number(months);
  if (installment <= 0 || n <= 0) return 0;
  if (r <= 0) return installment * n;
  const pv = installment * (1 - Math.pow(1+r, -n)) / r;
  return pv;
}

function estimateProfit(totalPaid, principal){
  return Math.max(0, totalPaid - principal);
}

function typeLabel(t){
  if(t==="mortgage") return "ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ";
  if(t==="personal") return "ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ/Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ";
  if(t==="debt_personal") return "Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© (Ø´Ø®ØµÙŠ)";
  if(t==="debt_mortgage") return "Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© (Ø¹Ù‚Ø§Ø±ÙŠ)";
  return "â€”";
}

/* ==========================
   Result Rendering
========================== */
const calcBtn = byId("calcBtn");
calcBtn.addEventListener("click", ()=>{
  const name = (byId("clientName").value || "").trim() || "Ø¹Ø²ÙŠØ²Ù†Ø§";
  const t = loanType.value;

  const salary = Number(byId("salary").value || 0);
  const commitments = Number(byId("commitments").value || 0);
  const nMonths = Number(months.value || 0);

  // Job note in result
  const job = byId("jobType").value;
  byId("jobRedNote").classList.toggle("hide", (job==="civil" || job==="military"));

  // Show greeting
  byId("welcomeName").textContent = "ÙŠØ§ " + name;

  // Pick offer
  const best = pickBestOffer(t) || {name:"â€”", rate:0};

  // Deduction policy (ØªÙ‚Ø±ÙŠØ¨ÙŠ)
  let allowedPct = 0.55;
  if (t==="mortgage" || t==="debt_mortgage"){
    // 65% Ø¥Ø°Ø§ Ø§Ù„Ø±Ø§ØªØ¨ >=15000 Ø£Ùˆ (Ù…Ø¯Ø¹ÙˆÙ… + Ø¯ÙØ¹Ø© Ø³ÙƒÙ†ÙŠ = Ù„Ø§)
    const ms = (t==="mortgage") ? byId("mortgageSupport").value : "unsupported";
    const sak = (t==="mortgage") ? byId("sakaniDown").value : "yes";
    if (salary >= 15000) allowedPct = 0.65;
    else if (ms==="supported" && sak==="no") allowedPct = 0.65;
    else allowedPct = 0.55;
  }else{
    // Ø´Ø®ØµÙŠ: 33.33% Ø³Ù‚Ù Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ø®ØµÙŠØŒ ÙˆØ¥Ø°Ø§ Ø¹Ù†Ø¯Ù‡ Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ù†Ø³ØªØ®Ø¯Ù… 45% Ù„Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
    allowedPct = (commitments > 0) ? 0.45 : 0.3333;
  }

  // Available installment
  let maxInstall = Math.max(0, salary * allowedPct);
  // ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ: Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ø®ØµÙŠ Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ² 33.33% Ù…Ù† Ø§Ù„Ø±Ø§ØªØ¨ Ø­ØªÙ‰ Ù„Ùˆ 45% Ø¥Ø¬Ù…Ø§Ù„ÙŠ
  let personalCap = salary * 0.3333;

  let availableAfterCommit = maxInstall - commitments;
  if (t==="personal" || t==="debt_personal"){
    // Ø§Ù„Ù…ØªØ§Ø­ Ù„Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ø®ØµÙŠ Ù‡Ùˆ Ø§Ù„Ø£Ù‚Ù„ Ø¨ÙŠÙ† (Ø¨Ø¹Ø¯ Ø®ØµÙ… Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª) Ùˆ (33.33% Ø³Ù‚Ù Ø§Ù„Ø´Ø®ØµÙŠ)
    availableAfterCommit = Math.min(availableAfterCommit, personalCap);
  }

  // If negative or zero -> cannot
  const cannot = (salary <= 0 || nMonths <= 0 || availableAfterCommit <= 0);

  // Monthly support (ONLY DISPLAY, NOT ADD TO NET)
  let monthlySupport = 0;
  let showMonthlySupport = false;
  if (t==="mortgage"){
    const ms = byId("mortgageSupport").value;
    const sak = byId("sakaniDown").value;
    if (ms==="supported" && sak==="no"){
      monthlySupport = getMonthlySupport(salary);
      showMonthlySupport = true;
    }
  }

  // Itizaz / Sakani lump
  let itizazVal = 0;
  let sakaniLump = 0;
  if (t==="mortgage"){
    sakaniLump = Number(byId("sakaniLump").value || 0);
    const it = byId("itizaz").value;
    itizazVal = (it==="yes") ? 160000 : 0;
  }

  // Fees (for non-mortgage we show fees + VAT)
  const fees = Number(byId("adminFees").value || 0);
  const vatPct = Number(byId("vatPct").value || 15);
  const vat = fees * (vatPct/100);
  const feesWithVat = fees + vat;

  // Principal estimate
  const principal = cannot ? 0 : estimateFinanceFromInstallment(availableAfterCommit, best.rate, nMonths);
  const totalPaid = cannot ? 0 : (availableAfterCommit * nMonths);
  const profitNoFees = cannot ? 0 : estimateProfit(totalPaid, principal);
  const profitWithFees = cannot ? 0 : (profitNoFees + feesWithVat);

  // Net after fees (this is the big line)
  let net = principal;
  // Ø®ØµÙ… Ø§Ù„Ø±Ø³ÙˆÙ… ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ/Ø´Ø±Ø§Ø¡ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø§Ù„Ø´Ø®ØµÙŠ
  if (t==="personal" || t==="debt_personal"){
    net = Math.max(0, principal - feesWithVat);
  }

  // Aid totals (NON-monthly only)
  const aidTotal = (itizazVal + sakaniLump);
  const showAid = (aidTotal > 0);

  // Update UI
  byId("rType").textContent = typeLabel(t);
  byId("rBest").textContent = best.name || "â€”";
  byId("rRate").textContent = pct(best.rate || 0);
  byId("rInst").textContent = fmt(availableAfterCommit);
  byId("rMonths").textContent = nMonths + " Ø´Ù‡Ø±";
  byId("rNet").textContent = fmt(net);

  // Monthly support row (DO NOT ADD TO NET)
  const msRow = byId("monthlySupportRow");
  msRow.style.display = showMonthlySupport ? "flex" : "none";
  byId("rMonthlySupport").textContent = showMonthlySupport ? fmt(monthlySupport) : "â€”";

  // Itizaz / Sakani lump rows
  byId("itizazRow").style.display = (itizazVal > 0) ? "flex" : "none";
  byId("rItizaz").textContent = fmt(itizazVal);

  byId("sakaniLumpRow").style.display = (sakaniLump > 0) ? "flex" : "none";
  byId("rSakaniLump").textContent = fmt(sakaniLump);

  byId("totalAidRow").style.display = showAid ? "flex" : "none";
  byId("rAidTotal").textContent = showAid ? fmt(aidTotal) : "â€”";

  byId("netPlusAidRow").style.display = showAid ? "flex" : "none";
  byId("rNetPlusAid").textContent = showAid ? fmt(net + aidTotal) : "â€”";

  byId("rProfitNoFees").textContent = fmt(profitNoFees);
  byId("rProfitWithFees").textContent = fmt(profitWithFees);

  // cannot handling
  byId("cannotBox").classList.toggle("hide", !cannot);
  byId("okBox").classList.toggle("hide", cannot);

  // Show result
  formCard.classList.add("hide");
  resultCard.classList.remove("hide");
});

/* ==========================
   Save JPG
========================== */
byId("saveJpgBtn").addEventListener("click", async ()=>{
  const node = byId("resultShot");
  const canvas = await html2canvas(node, {
    scale: 3,
    backgroundColor: "#ffffff",
    useCORS: true
  });
  const jpg = canvas.toDataURL("image/jpeg", 0.95);

  const a = document.createElement("a");
  a.href = jpg;
  a.download = "FINO-result.jpg";
  document.body.appendChild(a);
  a.click();
  a.remove();
});

byId("resetBtn").addEventListener("click", ()=>{
  resultCard.classList.add("hide");
  startCard.classList.remove("hide");
  // Ø±Ø¬Ù‘Ø¹ Ø§Ù„ÙÙˆØ±Ù… Ù…Ø®ÙÙŠ
  formCard.classList.add("hide");
});

/* ==========================
   Admin Tools (LOGIN INSIDE Tools Icon)
========================== */
const adminToolsBtn = byId("adminToolsBtn");
const adminModal = byId("adminModal");
const closeAdmin = byId("closeAdmin");
const adminLoginBox = byId("adminLoginBox");
const adminToolsBox = byId("adminToolsBox");
const adminLoginBtn = byId("adminLoginBtn");
const adminLoginErr = byId("adminLoginErr");

adminToolsBtn.addEventListener("click", ()=>{
  adminModal.classList.add("show");
  // always start at login
  adminLoginBox.classList.remove("hide");
  adminToolsBox.classList.add("hide");
  adminLoginErr.style.display="none";
  byId("adminPin").value = "";
});

closeAdmin.addEventListener("click", ()=> adminModal.classList.remove("show"));
adminModal.addEventListener("click", (e)=>{
  if(e.target === adminModal) adminModal.classList.remove("show");
});

adminLoginBtn.addEventListener("click", ()=>{
  const pin = byId("adminPin").value.trim();
  const real = loadPin();
  if(pin !== real){
    adminLoginErr.style.display="block";
    return;
  }
  adminLoginErr.style.display="none";
  adminLoginBox.classList.add("hide");
  adminToolsBox.classList.remove("hide");
  // render tables
  renderOffers();
  renderSupport();
});

/* Tabs */
document.querySelectorAll(".tab").forEach(t=>{
  t.addEventListener("click", ()=>{
    document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
    t.classList.add("active");
    const key = t.getAttribute("data-tab");
    byId("tab_offers").classList.toggle("hide", key!=="offers");
    byId("tab_support").classList.toggle("hide", key!=="support");
    byId("tab_settings").classList.toggle("hide", key!=="settings");
  });
});

/* ==========================
   Admin: Offers
========================== */
function offerTypeLabel(t){
  if(t==="mortgage") return "Ø¹Ù‚Ø§Ø±ÙŠ";
  if(t==="personal") return "Ø´Ø®ØµÙŠ/Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ";
  if(t==="debt_personal") return "Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© (Ø´Ø®ØµÙŠ)";
  if(t==="debt_mortgage") return "Ø´Ø±Ø§Ø¡ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© (Ø¹Ù‚Ø§Ø±ÙŠ)";
  return t;
}

function renderOffers(){
  const tbody = byId("offersTable").querySelector("tbody");
  tbody.innerHTML = "";
  OFFERS.forEach(o=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${escapeHtml(o.name)}</td>
      <td>${offerTypeLabel(o.type)}</td>
      <td>${Number(o.rate).toFixed(2)}%</td>
      <td>
        <div class="right">
          <button class="miniBtn primary" data-act="edit" data-id="${o.id}">ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="miniBtn danger" data-act="del" data-id="${o.id}">Ø­Ø°Ù</button>
        </div>
      </td>
    `;
    tbody.appendChild(tr);
  });

  tbody.querySelectorAll("button").forEach(b=>{
    b.addEventListener("click", ()=>{
      const act = b.getAttribute("data-act");
      const id = b.getAttribute("data-id");
      const item = OFFERS.find(x=>x.id===id);
      if(!item) return;

      if(act==="del"){
        OFFERS = OFFERS.filter(x=>x.id!==id);
        saveOffers(OFFERS);
        renderOffers();
        return;
      }

      if(act==="edit"){
        editingOfferId = id;
        byId("oName").value = item.name;
        byId("oType").value = item.type;
        byId("oRate").value = item.rate;
      }
    });
  });
}

byId("addOfferBtn").addEventListener("click", ()=>{
  const name = byId("oName").value.trim();
  const type = byId("oType").value;
  const rate = Number(byId("oRate").value || 0);

  if(!name || rate<=0){
    alert("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø© ÙˆÙ†Ø³Ø¨Ø© ØµØ­ÙŠØ­Ø©.");
    return;
  }

  if(editingOfferId){
    OFFERS = OFFERS.map(o => o.id===editingOfferId ? {...o, name, type, rate} : o);
    editingOfferId = null;
  }else{
    OFFERS.unshift({id:cryptoId(), name, type, rate});
  }
  saveOffers(OFFERS);
  renderOffers();
  byId("oName").value = "";
  byId("oRate").value = "";
});

byId("clearOfferFormBtn").addEventListener("click", ()=>{
  editingOfferId = null;
  byId("oName").value = "";
  byId("oRate").value = "";
});

/* ==========================
   Admin: Support Table
========================== */
function renderSupport(){
  const tbody = byId("supportTable").querySelector("tbody");
  tbody.innerHTML = "";
  SUPPORT
    .slice()
    .sort((a,b)=> (a.from-b.from))
    .forEach(r=>{
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${Number(r.from).toLocaleString("ar-SA")}</td>
        <td>${Number(r.to).toLocaleString("ar-SA")}</td>
        <td>${Number(r.amt).toLocaleString("ar-SA")} Ø±ÙŠØ§Ù„</td>
        <td>
          <div class="right">
            <button class="miniBtn primary" data-act="edit" data-id="${r.id}">ØªØ¹Ø¯ÙŠÙ„</button>
            <button class="miniBtn danger" data-act="del" data-id="${r.id}">Ø­Ø°Ù</button>
          </div>
        </td>
      `;
      tbody.appendChild(tr);
    });

  tbody.querySelectorAll("button").forEach(b=>{
    b.addEventListener("click", ()=>{
      const act = b.getAttribute("data-act");
      const id = b.getAttribute("data-id");
      const item = SUPPORT.find(x=>x.id===id);
      if(!item) return;

      if(act==="del"){
        SUPPORT = SUPPORT.filter(x=>x.id!==id);
        saveSupport(SUPPORT);
        renderSupport();
        return;
      }
      if(act==="edit"){
        editingSupportId = id;
        byId("sFrom").value = item.from;
        byId("sTo").value = item.to;
        byId("sAmt").value = item.amt;
      }
    });
  });
}

byId("addSupportRowBtn").addEventListener("click", ()=>{
  const from = Number(byId("sFrom").value);
  const to = Number(byId("sTo").value);
  const amt = Number(byId("sAmt").value);

  if(isNaN(from) || isNaN(to) || isNaN(amt) || to < from){
    alert("ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù‚ÙŠÙ…: (Ù…Ù†) Ø£Ù‚Ù„ Ù…Ù† Ø£Ùˆ ÙŠØ³Ø§ÙˆÙŠ (Ø¥Ù„Ù‰) ÙˆØ§Ù„Ø¯Ø¹Ù… Ø±Ù‚Ù… ØµØ­ÙŠØ­.");
    return;
  }

  if(editingSupportId){
    SUPPORT = SUPPORT.map(r => r.id===editingSupportId ? {...r, from, to, amt} : r);
    editingSupportId = null;
  }else{
    SUPPORT.push({id:cryptoId(), from, to, amt});
  }

  saveSupport(SUPPORT);
  renderSupport();

  byId("sFrom").value = "";
  byId("sTo").value = "";
  byId("sAmt").value = "";
});

byId("resetSupportDefaultBtn").addEventListener("click", ()=>{
  SUPPORT = defaultSupport.map(x=>({...x, id:cryptoId()}));
  saveSupport(SUPPORT);
  renderSupport();
});

/* ==========================
   Admin: Settings
========================== */
byId("savePinBtn").addEventListener("click", ()=>{
  const p = byId("newPin").value.trim();
  if(!/^\d{4,10}$/.test(p)){
    alert("Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø· (4 Ø¥Ù„Ù‰ 10 Ø£Ø±Ù‚Ø§Ù…).");
    return;
  }
  savePin(p);
  byId("pinSaved").style.display="block";
  setTimeout(()=> byId("pinSaved").style.display="none", 1400);
  byId("newPin").value = "";
});

byId("wipeAllBtn").addEventListener("click", ()=>{
  if(!confirm("ØªØ£ÙƒÙŠØ¯ ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø±ÙˆØ¶ + Ø§Ù„Ø¯Ø¹Ù… + Ø§Ù„Ø±Ù…Ø²ØŸ")) return;
  localStorage.removeItem(LS_KEYS.OFFERS);
  localStorage.removeItem(LS_KEYS.SUPPORT);
  localStorage.removeItem(LS_KEYS.PIN);
  OFFERS = loadOffers();
  SUPPORT = loadSupport();
  renderOffers();
  renderSupport();
  alert("ØªÙ… Ø§Ù„ØªØµÙÙŠØ±.");
});

/* ==========================
   Utilities
========================== */
function escapeHtml(s){
  return String(s)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
</script>
</body>
</html>